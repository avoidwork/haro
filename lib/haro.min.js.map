{"version":3,"file":"haro.min.js","sources":["haro.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","global","blob","arg","obj","undefined","Blob","type","e","BlobBuilder","MSBlobBuilder","WebKitBlobBuilder","MozBlobBuilder","append","getBlob","clone","JSON","parse","stringify","concatURI","left","right","replace","regex","querystring","endslash","keyIndex","data","delimiter","pattern","keys","split","sort","result","map","String","RegExp","toLowerCase","join","delIndex","index","indexes","forEach","idx","get","value","o","has","size","iterate","fn","call","merge","a","b","c","d","Array","concat","patch","ogdata","arguments","overwrite","v","k","push","op","path","s","Math","random","toString","substring","setIndexValue","set","Set","add","setIndex","indice","toObjekt","_transform","input","Map","uuid","substr","r","floor","factory","config","Haro","functions","webWorker","worker","URL","createObjectURL","server","process","nextTick","Promise","require","fetch","deferred","tuple","Worker","adapter","_this","this","adapters","method","credentials","headers","accept","content-type","id","logging","registry","source","total","uri","versions","versioning","reindex","batch","args","next","all","then","defer","resolve","reject","_this2","lload","del","hash","toArray","toObject","request","body","promise","clear","console","log","_len","_key","apply","Error","_this3","indexOf","shift","pop","splice","storage","success","error","message","stack","transform","entries","where","_this4","ctx","output","max","offset","lmax","loffset","list","nth","_this5","cmd","_this6","datum","_this7","cfg","toUpperCase","res","status","_headers","_this8","_this9","rgex","test","seen","lindex","lset","lkey","_this10","override","ldata","luri","xdata","err","sync","frozen","freeze","_this11","_this12","_len2","_key2","deferreds","_this13","Allow","allow","reduce","val","func","_this14","values","version","exports","module","define","haro","window"],"mappings":"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","sourcesContent":["/**\n * Har≈ç is a modern immutable DataStore using Maps, Sets, Promises, & Tuples\n *\n * @author Jason Mulligan <jason.mulligan@avoidwork.com>\n * @copyright 2015\n * @license BSD-3-Clause\n * @link http://haro.rocks\n * @version 1.6.2\n */\n\"use strict\";\n\nvar _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n(function (global) {\n\tvar server = typeof process !== \"undefined\" && typeof process.nextTick === \"function\";\n\tvar Promise = !server ? global.Promise : require(\"es6-promise\").Promise;\n\tvar Map = !server ? global.Map : require(\"es6-map\");\n\tvar Set = !server ? global.Set : require(\"es6-set\");\n\tvar fetch = !server ? global.fetch : require(\"node-fetch\");\n\tvar deferred = !server ? global.deferred : require(\"tiny-defer\");\n\tvar tuple = !server ? global.tuple : require(\"tiny-tuple\");\n\tvar r = [8, 9, \"a\", \"b\"];\n\tvar regex = {\n\t\tquerystring: /\\?.*/,\n\t\tendslash: /\\/$/\n\t};\n\tvar webWorker = typeof Blob !== \"undefined\" && typeof Worker !== \"undefined\";\n\tvar adapter = {};\n\n\tfunction blob(arg) {\n\t\tvar obj = undefined;\n\n\t\ttry {\n\t\t\tobj = new Blob([arg], { type: \"application/javascript\" });\n\t\t} catch (e) {\n\t\t\tif (!global.BlobBuilder) {\n\t\t\t\tglobal.BlobBuilder = global.MSBlobBuilder || global.WebKitBlobBuilder || global.MozBlobBuilder;\n\t\t\t}\n\n\t\t\tobj = new global.BlobBuilder().append(arg).getBlob();\n\t\t}\n\n\t\treturn obj;\n\t}\n\n\tfunction clone(arg) {\n\t\treturn JSON.parse(JSON.stringify(arg));\n\t}\n\n\tfunction concatURI(left, right) {\n\t\treturn left.replace(regex.querystring, \"\").replace(regex.endslash, \"\") + (right ? \"/\" + right : \"\");\n\t}\n\n\tfunction keyIndex(key, data, delimiter, pattern) {\n\t\tvar keys = key.split(delimiter).sort(),\n\t\t    result = undefined;\n\n\t\tif (keys.length > 1) {\n\t\t\tresult = keys.map(function (i) {\n\t\t\t\treturn String(data[i]).replace(new RegExp(pattern, \"g\"), \"\").toLowerCase();\n\t\t\t}).join(delimiter);\n\t\t} else {\n\t\t\tresult = data[key];\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tfunction delIndex(index, indexes, delimiter, key, data, pattern) {\n\t\tindex.forEach(function (i) {\n\t\t\tvar idx = indexes.get(i),\n\t\t\t    value = keyIndex(i, data, delimiter, pattern),\n\t\t\t    o = undefined;\n\n\t\t\tif (idx.has(value)) {\n\t\t\t\to = idx.get(value);\n\t\t\t\to[\"delete\"](key);\n\n\t\t\t\tif (o.size === 0) {\n\t\t\t\t\tidx[\"delete\"](value);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction iterate(obj, fn) {\n\t\tif (obj instanceof Object) {\n\t\t\tObject.keys(obj).forEach(function (i) {\n\t\t\t\tfn.call(obj, obj[i], i);\n\t\t\t});\n\t\t} else {\n\t\t\tobj.forEach(fn);\n\t\t}\n\t}\n\n\tfunction merge(a, b) {\n\t\tvar c = a !== undefined ? clone(a) : a,\n\t\t    d = b !== undefined ? clone(b) : b;\n\n\t\tif (c instanceof Object && d instanceof Object) {\n\t\t\tObject.keys(d).forEach(function (i) {\n\t\t\t\tif (c[i] instanceof Object && d[i] instanceof Object) {\n\t\t\t\t\tc[i] = merge(c[i], d[i]);\n\t\t\t\t} else if (c[i] instanceof Array && d[i] instanceof Array) {\n\t\t\t\t\tc[i] = c[i].concat(d[i]);\n\t\t\t\t} else {\n\t\t\t\t\tc[i] = d[i];\n\t\t\t\t}\n\t\t\t});\n\t\t} else if (c instanceof Array && d instanceof Array) {\n\t\t\tc = c.concat(d);\n\t\t} else {\n\t\t\tc = d;\n\t\t}\n\n\t\treturn c;\n\t}\n\n\tfunction patch() {\n\t\tvar ogdata = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n\t\tvar data = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\t\tvar key = arguments.length <= 2 || arguments[2] === undefined ? \"\" : arguments[2];\n\t\tvar overwrite = arguments.length <= 3 || arguments[3] === undefined ? false : arguments[3];\n\n\t\tvar result = [];\n\n\t\tif (overwrite) {\n\t\t\titerate(ogdata, function (v, k) {\n\t\t\t\tif (k !== key && data[k] === undefined) {\n\t\t\t\t\tresult.push({ op: \"remove\", path: \"/\" + k });\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\titerate(data, function (v, k) {\n\t\t\tif (k !== key && ogdata[k] === undefined) {\n\t\t\t\tresult.push({ op: \"add\", path: \"/\" + k, value: v });\n\t\t\t} else if (JSON.stringify(ogdata[k]) !== JSON.stringify(v)) {\n\t\t\t\tresult.push({ op: \"replace\", path: \"/\" + k, value: v });\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tfunction s() {\n\t\treturn ((1 + Math.random()) * 0x10000 | 0).toString(16).substring(1);\n\t}\n\n\tfunction setIndexValue(index, key, value) {\n\t\tif (!index.has(key)) {\n\t\t\tindex.set(key, new Set());\n\t\t}\n\n\t\tindex.get(key).add(value);\n\t}\n\n\tfunction setIndex(index, indexes, delimiter, key, data, indice, pattern) {\n\t\tif (!indice) {\n\t\t\tindex.forEach(function (i) {\n\t\t\t\tsetIndexValue(indexes.get(i), keyIndex(i, data, delimiter, pattern), key);\n\t\t\t});\n\t\t} else {\n\t\t\tsetIndexValue(indexes.get(indice), keyIndex(indice, data, delimiter, pattern), key);\n\t\t}\n\t}\n\n\tfunction toObjekt(arg) {\n\t\tvar result = {};\n\n\t\targ.forEach(function (value, key) {\n\t\t\tresult[key] = value;\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tfunction _transform(input) {\n\t\tvar result = undefined;\n\n\t\tswitch (true) {\n\t\t\tcase input instanceof Map:\n\t\t\t\tresult = {};\n\t\t\t\tinput.forEach(function (value, key) {\n\t\t\t\t\tresult[key] = _transform(value);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase input instanceof Set:\n\t\t\t\tresult = [];\n\t\t\t\tinput.forEach(function (i) {\n\t\t\t\t\tresult.push(_transform(i));\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase input instanceof Array:\n\t\t\t\tresult = new Set();\n\t\t\t\tinput.forEach(function (i) {\n\t\t\t\t\tresult.add(_transform(i));\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase input instanceof Object:\n\t\t\t\tresult = new Map();\n\t\t\t\tObject.keys(input).forEach(function (i) {\n\t\t\t\t\tresult.set(i, _transform(input[i]));\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tresult = input;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tfunction uuid() {\n\t\treturn s() + s() + \"-\" + s() + \"-4\" + s().substr(0, 3) + \"-\" + r[Math.floor(Math.random() * 4)] + s().substr(0, 3) + \"-\" + s() + s() + s();\n\t}\n\n\tvar Haro = (function () {\n\t\tfunction Haro(data) {\n\t\t\tvar _this = this;\n\n\t\t\tvar config = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n\t\t\t_classCallCheck(this, Haro);\n\n\t\t\tthis.adapters = {};\n\t\t\tthis.data = new Map();\n\t\t\tthis.delimiter = \"|\";\n\t\t\tthis.config = {\n\t\t\t\tmethod: \"get\",\n\t\t\t\tcredentials: false,\n\t\t\t\theaders: {\n\t\t\t\t\taccept: \"application/json\",\n\t\t\t\t\t\"content-type\": \"application/json\"\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.id = uuid();\n\t\t\tthis.index = [];\n\t\t\tthis.indexes = new Map();\n\t\t\tthis.key = \"\";\n\t\t\tthis.logging = true;\n\t\t\tthis.patch = false;\n\t\t\tthis.pattern = \"\\\\s*|\\\\t*\";\n\t\t\tthis.registry = [];\n\t\t\tthis.source = \"\";\n\t\t\tthis.total = 0;\n\t\t\tthis.uri = \"\";\n\t\t\tthis.worker = undefined;\n\t\t\tthis.versions = new Map();\n\t\t\tthis.versioning = true;\n\n\t\t\tObject.keys(config).forEach(function (i) {\n\t\t\t\t_this[i] = merge(_this[i], config[i]);\n\t\t\t});\n\n\t\t\tthis.reindex();\n\n\t\t\tif (data) {\n\t\t\t\tthis.batch(data, \"set\");\n\t\t\t}\n\t\t}\n\n\t\t_createClass(Haro, [{\n\t\t\tkey: \"batch\",\n\t\t\tvalue: function batch(args, type) {\n\t\t\t\tvar _this2 = this;\n\n\t\t\t\tvar lload = arguments.length <= 2 || arguments[2] === undefined ? false : arguments[2];\n\n\t\t\t\tvar defer = deferred(),\n\t\t\t\t    del = type === \"del\",\n\t\t\t\t    data = undefined,\n\t\t\t\t    fn = undefined,\n\t\t\t\t    hash = undefined;\n\n\t\t\t\tfunction next() {\n\t\t\t\t\tPromise.all(args.map(fn)).then(defer.resolve, defer.reject);\n\t\t\t\t}\n\n\t\t\t\tif (del) {\n\t\t\t\t\tfn = function (i) {\n\t\t\t\t\t\treturn _this2.del(i, true);\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tfn = function (i) {\n\t\t\t\t\t\treturn _this2.set(null, i, true, true, lload);\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (this.patch) {\n\t\t\t\t\tif (del) {\n\t\t\t\t\t\tdata = patch(this.toArray().map(function (i) {\n\t\t\t\t\t\t\treturn i[_this2.key];\n\t\t\t\t\t\t}), args, this.key, true);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata = [];\n\t\t\t\t\t\thash = {};\n\t\t\t\t\t\targs.forEach(function (i) {\n\t\t\t\t\t\t\tvar key = i[_this2.key];\n\n\t\t\t\t\t\t\tif (key) {\n\t\t\t\t\t\t\t\thash[key] = i;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdata.push({ op: \"add\", path: \"/\", value: i });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tdata = data.concat(patch(this.toObject(), hash, this.key, true));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data.length > 0) {\n\t\t\t\t\t\tthis.request(concatURI(this.uri, null), {\n\t\t\t\t\t\t\tmethod: \"patch\",\n\t\t\t\t\t\t\tbody: JSON.stringify(data)\n\t\t\t\t\t\t}).then(function () {\n\t\t\t\t\t\t\tnext();\n\t\t\t\t\t\t}, defer.reject);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdefer.resolve();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tnext();\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"clear\",\n\t\t\tvalue: function clear() {\n\t\t\t\tthis.total = 0;\n\t\t\t\tthis.registry = [];\n\t\t\t\tthis.data.clear();\n\t\t\t\tthis.indexes.clear();\n\t\t\t\tthis.versions.clear();\n\n\t\t\t\tif (this.logging) {\n\t\t\t\t\tconsole.log(\"Cleared\", this.id);\n\t\t\t\t}\n\n\t\t\t\treturn this.reindex();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"cmd\",\n\t\t\tvalue: function cmd(type) {\n\t\t\t\tvar defer = deferred();\n\n\t\t\t\tif (!this.adapters[type] || !adapter[type]) {\n\t\t\t\t\tdefer.reject(new Error(type + \" not configured for persistent storage\"));\n\t\t\t\t} else {\n\t\t\t\t\tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n\t\t\t\t\t\targs[_key - 1] = arguments[_key];\n\t\t\t\t\t}\n\n\t\t\t\t\tadapter[type].apply(this, [this].concat(args)).then(defer.resolve, defer.reject);\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"del\",\n\t\t\tvalue: function del(key) {\n\t\t\t\tvar _this3 = this;\n\n\t\t\t\tvar batch = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];\n\n\t\t\t\tvar defer = deferred(),\n\t\t\t\t    next = undefined;\n\n\t\t\t\tnext = function () {\n\t\t\t\t\tvar index = _this3.registry.indexOf(key);\n\n\t\t\t\t\tif (index > -1) {\n\t\t\t\t\t\tif (index === 0) {\n\t\t\t\t\t\t\t_this3.registry.shift();\n\t\t\t\t\t\t} else if (index === _this3.registry.length - 1) {\n\t\t\t\t\t\t\t_this3.registry.pop();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t_this3.registry.splice(index, 1);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdelIndex(_this3.index, _this3.indexes, _this3.delimiter, key, _this3.data.get(key), _this3.pattern);\n\t\t\t\t\t\t_this3.data[\"delete\"](key);\n\t\t\t\t\t\t--_this3.total;\n\n\t\t\t\t\t\tif (_this3.versioning) {\n\t\t\t\t\t\t\t_this3.versions[\"delete\"](key);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_this3.storage(\"remove\", key).then(function (success) {\n\t\t\t\t\t\t\tif (success && _this3.logging) {\n\t\t\t\t\t\t\t\tconsole.log(\"Deleted\", key, \"from persistent storage\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\tif (_this3.logging) {\n\t\t\t\t\t\t\t\tconsole.error(\"Error deleting\", key, \"from persistent storage:\", e.message || e.stack || e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tdefer.resolve();\n\t\t\t\t};\n\n\t\t\t\tif (this.data.has(key)) {\n\t\t\t\t\tif (!batch && this.uri) {\n\t\t\t\t\t\tif (this.patch) {\n\t\t\t\t\t\t\tthis.request(concatURI(this.uri, null), {\n\t\t\t\t\t\t\t\tmethod: \"patch\",\n\t\t\t\t\t\t\t\tbody: JSON.stringify([{ op: \"remove\", path: \"/\" + key }])\n\t\t\t\t\t\t\t}).then(next, function (e) {\n\t\t\t\t\t\t\t\tif (e[1] === 405) {\n\t\t\t\t\t\t\t\t\t_this3.patch = false;\n\t\t\t\t\t\t\t\t\t_this3.request(concatURI(_this3.uri, key), {\n\t\t\t\t\t\t\t\t\t\tmethod: \"delete\"\n\t\t\t\t\t\t\t\t\t}).then(next, defer.reject);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.request(concatURI(this.uri, key), {\n\t\t\t\t\t\t\t\tmethod: \"delete\"\n\t\t\t\t\t\t\t}).then(next, defer.reject);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnext();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdefer.reject(new Error(\"Record not found\"));\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"dump\",\n\t\t\tvalue: function dump() {\n\t\t\t\tvar type = arguments.length <= 0 || arguments[0] === undefined ? \"records\" : arguments[0];\n\n\t\t\t\tvar result = undefined;\n\n\t\t\t\tif (type === \"records\") {\n\t\t\t\t\tresult = this.toArray(null, false);\n\t\t\t\t} else {\n\t\t\t\t\tresult = this.transform(this.indexes);\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"entries\",\n\t\t\tvalue: function entries() {\n\t\t\t\treturn this.data.entries();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"find\",\n\t\t\tvalue: function find(where) {\n\t\t\t\tvar _this4 = this;\n\n\t\t\t\tvar key = Object.keys(where).sort().join(this.delimiter),\n\t\t\t\t    value = keyIndex(key, where, this.delimiter),\n\t\t\t\t    result = [];\n\n\t\t\t\tif (this.indexes.has(key)) {\n\t\t\t\t\t(this.indexes.get(key).get(value) || new Set()).forEach(function (i) {\n\t\t\t\t\t\tresult.push(_this4.get(i));\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn tuple.apply(tuple, result);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"filter\",\n\t\t\tvalue: function filter(fn) {\n\t\t\t\tvar result = [];\n\n\t\t\t\tthis.forEach(function (value, key) {\n\t\t\t\t\tif (fn(value, key) === true) {\n\t\t\t\t\t\tresult.push(tuple(key, value));\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn tuple.apply(tuple, result);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"forEach\",\n\t\t\tvalue: function forEach(fn, ctx) {\n\t\t\t\tthis.data.forEach(function (value, key) {\n\t\t\t\t\tfn(clone(value), clone(key));\n\t\t\t\t}, ctx);\n\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"get\",\n\t\t\tvalue: function get(key) {\n\t\t\t\tvar output = undefined;\n\n\t\t\t\tif (this.data.has(key)) {\n\t\t\t\t\toutput = tuple(key, this.data.get(key));\n\t\t\t\t}\n\n\t\t\t\treturn output;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"has\",\n\t\t\tvalue: function has(key) {\n\t\t\t\treturn this.data.has(key);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"keys\",\n\t\t\tvalue: function keys() {\n\t\t\t\treturn this.data.keys();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"limit\",\n\t\t\tvalue: function limit(max) {\n\t\t\t\tvar offset = arguments.length <= 1 || arguments[1] === undefined ? 0 : arguments[1];\n\n\t\t\t\tvar lmax = max,\n\t\t\t\t    loffset = offset,\n\t\t\t\t    list = [],\n\t\t\t\t    i = undefined,\n\t\t\t\t    k = undefined,\n\t\t\t\t    nth = undefined;\n\n\t\t\t\tif (lmax === undefined) {\n\t\t\t\t\tlmax = -1;\n\t\t\t\t}\n\n\t\t\t\ti = loffset;\n\t\t\t\tnth = loffset + lmax;\n\n\t\t\t\tif (i < 0 || i >= nth) {\n\t\t\t\t\tthrow new Error(\"Invalid range\");\n\t\t\t\t}\n\n\t\t\t\tdo {\n\t\t\t\t\tk = this.registry[i];\n\n\t\t\t\t\tif (k) {\n\t\t\t\t\t\tlist.push(this.get(k));\n\t\t\t\t\t}\n\t\t\t\t} while (++i < nth);\n\n\t\t\t\treturn tuple.apply(tuple, list);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"load\",\n\t\t\tvalue: function load() {\n\t\t\t\tvar _this5 = this;\n\n\t\t\t\tvar type = arguments.length <= 0 || arguments[0] === undefined ? \"mongo\" : arguments[0];\n\t\t\t\tvar key = arguments.length <= 1 || arguments[1] === undefined ? undefined : arguments[1];\n\n\t\t\t\tvar batch = key === undefined,\n\t\t\t\t    id = !batch ? key : this.id;\n\n\t\t\t\tif (batch) {\n\t\t\t\t\tthis.clear();\n\t\t\t\t}\n\n\t\t\t\treturn this.cmd(type, \"get\", key).then(function (arg) {\n\t\t\t\t\tif (_this5.logging) {\n\t\t\t\t\t\tconsole.log(\"Loaded\", id, \"from\", type, \"persistent storage\");\n\t\t\t\t\t}\n\n\t\t\t\t\treturn batch ? _this5.batch(arg, \"set\", true) : _this5.set(key, arg, true, true, true);\n\t\t\t\t}, function (e) {\n\t\t\t\t\tif (_this5.logging) {\n\t\t\t\t\t\tconsole.error(\"Error loading\", id, \"from\", type, \"persistent storage:\", e.message || e.stack || e);\n\t\t\t\t\t}\n\n\t\t\t\t\tthrow e;\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"map\",\n\t\t\tvalue: function map(fn) {\n\t\t\t\tvar result = [];\n\n\t\t\t\tthis.forEach(function (value, key) {\n\t\t\t\t\tresult.push(fn(value, key));\n\t\t\t\t});\n\n\t\t\t\treturn tuple.apply(tuple, result);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"override\",\n\t\t\tvalue: function override(data) {\n\t\t\t\tvar _this6 = this;\n\n\t\t\t\tvar type = arguments.length <= 1 || arguments[1] === undefined ? \"records\" : arguments[1];\n\t\t\t\tvar fn = arguments.length <= 2 || arguments[2] === undefined ? undefined : arguments[2];\n\n\t\t\t\tvar defer = deferred();\n\n\t\t\t\tif (type === \"indexes\") {\n\t\t\t\t\tthis.indexes = this.transform(data, fn);\n\t\t\t\t\tdefer.resolve(true);\n\t\t\t\t} else if (type === \"records\") {\n\t\t\t\t\tthis.data = new Map();\n\t\t\t\t\tthis.registry = [];\n\t\t\t\t\tdata.forEach(function (datum) {\n\t\t\t\t\t\tvar key = datum[_this6.key] || uuid();\n\n\t\t\t\t\t\t_this6.data.set(key, datum);\n\t\t\t\t\t\t_this6.registry.push(key);\n\t\t\t\t\t});\n\t\t\t\t\tthis.total = this.data.size;\n\t\t\t\t\tdefer.resolve(true);\n\t\t\t\t} else {\n\t\t\t\t\tdefer.reject(new Error(\"Invalid type\"));\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"register\",\n\t\t\tvalue: function register(key, fn) {\n\t\t\t\tadapter[key] = fn;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"reindex\",\n\t\t\tvalue: function reindex(index) {\n\t\t\t\tvar _this7 = this;\n\n\t\t\t\tif (!index) {\n\t\t\t\t\tthis.indexes.clear();\n\t\t\t\t\tthis.index.forEach(function (i) {\n\t\t\t\t\t\t_this7.indexes.set(i, new Map());\n\t\t\t\t\t});\n\t\t\t\t\tthis.forEach(function (data, key) {\n\t\t\t\t\t\t_this7.index.forEach(function (i) {\n\t\t\t\t\t\t\tsetIndex(_this7.index, _this7.indexes, _this7.delimiter, key, data, i, _this7.pattern);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.indexes.set(index, new Map());\n\t\t\t\t\tthis.forEach(function (data, key) {\n\t\t\t\t\t\tsetIndex(_this7.index, _this7.indexes, _this7.delimiter, key, data, index, _this7.pattern);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"request\",\n\t\t\tvalue: function request(input) {\n\t\t\t\tvar config = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n\t\t\t\tvar defer = deferred(),\n\t\t\t\t    cfg = merge(this.config, config);\n\n\t\t\t\tcfg.method = cfg.method.toUpperCase();\n\n\t\t\t\tfetch(input, cfg).then(function (res) {\n\t\t\t\t\tvar status = res.status,\n\t\t\t\t\t    headers = undefined;\n\n\t\t\t\t\tif (res.headers._headers) {\n\t\t\t\t\t\theaders = {};\n\t\t\t\t\t\tObject.keys(res.headers._headers).forEach(function (i) {\n\t\t\t\t\t\t\theaders[i] = res.headers._headers[i].join(\", \");\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\theaders = toObjekt(res.headers);\n\t\t\t\t\t}\n\n\t\t\t\t\tres[res.headers.get(\"content-type\").indexOf(\"application/json\") > -1 ? \"json\" : \"text\"]().then(function (arg) {\n\t\t\t\t\t\tdefer[status < 200 || status >= 400 ? \"reject\" : \"resolve\"](tuple(arg, status, headers));\n\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\tdefer.reject(tuple(e.message, status, headers));\n\t\t\t\t\t});\n\t\t\t\t}, function (e) {\n\t\t\t\t\tdefer.reject(tuple(e.message, 0, {}));\n\t\t\t\t});\n\n\t\t\t\treturn defer.promise;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"save\",\n\t\t\tvalue: function save() {\n\t\t\t\tvar _this8 = this;\n\n\t\t\t\tvar type = arguments.length <= 0 || arguments[0] === undefined ? \"mongo\" : arguments[0];\n\n\t\t\t\treturn this.cmd(type, \"set\").then(function (arg) {\n\t\t\t\t\tif (_this8.logging) {\n\t\t\t\t\t\tconsole.log(\"Saved\", _this8.id, \"to\", type, \"persistent storage\");\n\t\t\t\t\t}\n\n\t\t\t\t\treturn arg;\n\t\t\t\t}, function (e) {\n\t\t\t\t\tif (_this8.logging) {\n\t\t\t\t\t\tconsole.error(\"Error saving \", _this8.id, \"to\", type, \"persistent storage:\", e.message || e.stack || e);\n\t\t\t\t\t}\n\n\t\t\t\t\tthrow e;\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"search\",\n\t\t\tvalue: function search(value, index) {\n\t\t\t\tvar _this9 = this;\n\n\t\t\t\tvar result = [],\n\t\t\t\t    fn = typeof value === \"function\",\n\t\t\t\t    rgex = value && typeof value.test === \"function\",\n\t\t\t\t    seen = new Set(),\n\t\t\t\t    lindex = undefined,\n\t\t\t\t    indexes = undefined;\n\n\t\t\t\tif (value) {\n\t\t\t\t\tlindex = clone(index || this.index);\n\n\t\t\t\t\tif (lindex instanceof Array) {\n\t\t\t\t\t\tindexes = lindex;\n\t\t\t\t\t} else if (typeof lindex === \"string\") {\n\t\t\t\t\t\tindexes = [lindex];\n\t\t\t\t\t}\n\n\t\t\t\t\tindexes.forEach(function (i) {\n\t\t\t\t\t\tvar idx = _this9.indexes.get(i);\n\n\t\t\t\t\t\tif (idx) {\n\t\t\t\t\t\t\tidx.forEach(function (lset, lkey) {\n\t\t\t\t\t\t\t\tswitch (true) {\n\t\t\t\t\t\t\t\t\tcase fn && value(lkey, i):\n\t\t\t\t\t\t\t\t\tcase rgex && value.test(lkey):\n\t\t\t\t\t\t\t\t\tcase lkey === value:\n\t\t\t\t\t\t\t\t\t\tlset.forEach(function (key) {\n\t\t\t\t\t\t\t\t\t\t\tif (!seen.has(key)) {\n\t\t\t\t\t\t\t\t\t\t\t\tseen.add(key);\n\t\t\t\t\t\t\t\t\t\t\t\tresult.push(_this9.get(key));\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\tvoid 0;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn tuple.apply(tuple, result);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"set\",\n\t\t\tvalue: function set(key, data) {\n\t\t\t\tvar batch = arguments.length <= 2 || arguments[2] === undefined ? false : arguments[2];\n\n\t\t\t\tvar _this10 = this;\n\n\t\t\t\tvar override = arguments.length <= 3 || arguments[3] === undefined ? false : arguments[3];\n\t\t\t\tvar lload = arguments.length <= 4 || arguments[4] === undefined ? false : arguments[4];\n\n\t\t\t\tvar defer = deferred(),\n\t\t\t\t    method = \"post\",\n\t\t\t\t    ldata = clone(data),\n\t\t\t\t    lkey = key,\n\t\t\t\t    body = undefined,\n\t\t\t\t    ogdata = undefined,\n\t\t\t\t    luri = undefined;\n\n\t\t\t\tvar next = function next(arg) {\n\t\t\t\t\tvar xdata = arg ? arg[0] : {};\n\n\t\t\t\t\tif (lkey === null) {\n\t\t\t\t\t\tif (_this10.key) {\n\t\t\t\t\t\t\tif (_this10.source) {\n\t\t\t\t\t\t\t\t_this10.source.split(\".\").forEach(function (i) {\n\t\t\t\t\t\t\t\t\txdata = xdata[i] || {};\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlkey = xdata[_this10.key] || ldata[_this10.key] || uuid();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlkey = uuid();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (method === \"post\") {\n\t\t\t\t\t\t_this10.registry[_this10.total] = lkey;\n\t\t\t\t\t\t++_this10.total;\n\n\t\t\t\t\t\tif (_this10.versioning) {\n\t\t\t\t\t\t\t_this10.versions.set(lkey, new Set());\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (_this10.versioning) {\n\t\t\t\t\t\t\t_this10.versions.get(lkey).add(tuple(ogdata));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdelIndex(_this10.index, _this10.indexes, _this10.delimiter, lkey, ogdata, _this10.pattern);\n\t\t\t\t\t}\n\n\t\t\t\t\t_this10.data.set(lkey, ldata);\n\t\t\t\t\tsetIndex(_this10.index, _this10.indexes, _this10.delimiter, lkey, ldata, null, _this10.pattern);\n\t\t\t\t\tdefer.resolve(_this10.get(lkey));\n\n\t\t\t\t\tif (!lload) {\n\t\t\t\t\t\t_this10.storage(\"set\", lkey, ldata).then(function (success) {\n\t\t\t\t\t\t\tif (success && _this10.logging) {\n\t\t\t\t\t\t\t\tconsole.log(\"Saved\", lkey, \"to persistent storage\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\tif (_this10.logging) {\n\t\t\t\t\t\t\t\tconsole.error(\"Error saving\", lkey, \"to persistent storage:\", e.message || e.stack || e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tif (lkey === undefined || lkey === null) {\n\t\t\t\t\tlkey = null;\n\t\t\t\t} else if (this.data.has(lkey)) {\n\t\t\t\t\tmethod = \"put\";\n\t\t\t\t\togdata = this.data.get(lkey);\n\n\t\t\t\t\tif (!override) {\n\t\t\t\t\t\tldata = merge(ogdata, ldata);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!batch && this.uri) {\n\t\t\t\t\tluri = concatURI(this.uri, lkey);\n\n\t\t\t\t\tif (this.patch) {\n\t\t\t\t\t\tif (method === \"post\") {\n\t\t\t\t\t\t\tbody = [{ op: \"add\", path: \"/\", value: ldata }];\n\t\t\t\t\t\t} else if (override) {\n\t\t\t\t\t\t\tbody = [{ op: \"replace\", path: \"/\", value: ldata }];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbody = patch(ogdata, ldata, this.key);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.request(luri, {\n\t\t\t\t\t\t\tmethod: \"patch\",\n\t\t\t\t\t\t\tbody: JSON.stringify(body)\n\t\t\t\t\t\t}).then(next, function (e) {\n\t\t\t\t\t\t\tif (e[1] === 405) {\n\t\t\t\t\t\t\t\t_this10.patch = false;\n\t\t\t\t\t\t\t\t_this10.request(luri, {\n\t\t\t\t\t\t\t\t\tmethod: method,\n\t\t\t\t\t\t\t\t\tbody: JSON.stringify(ldata)\n\t\t\t\t\t\t\t\t}).then(next, function (err) {\n\t\t\t\t\t\t\t\t\tdefer.reject(err);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.request(luri, {\n\t\t\t\t\t\t\tmethod: method,\n\t\t\t\t\t\t\tbody: JSON.stringify(ldata)\n\t\t\t\t\t\t}).then(next, function (e) {\n\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tnext();\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"setUri\",\n\t\t\tvalue: function setUri(uri) {\n\t\t\t\tvar clear = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];\n\n\t\t\t\tvar defer = deferred();\n\n\t\t\t\tthis.uri = uri;\n\n\t\t\t\tif (this.uri) {\n\t\t\t\t\tthis.sync(clear).then(defer.resolve, defer.reject);\n\t\t\t\t} else {\n\t\t\t\t\tdefer.resolve([]);\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"sort\",\n\t\t\tvalue: function sort(fn) {\n\t\t\t\tvar frozen = arguments.length <= 1 || arguments[1] === undefined ? true : arguments[1];\n\n\t\t\t\tvar result = undefined;\n\n\t\t\t\tif (frozen) {\n\t\t\t\t\tresult = Object.freeze(this.toArray(null, false).sort(fn).map(function (i) {\n\t\t\t\t\t\treturn Object.freeze(i);\n\t\t\t\t\t}));\n\t\t\t\t} else {\n\t\t\t\t\tresult = this.toArray(null, false).sort(fn);\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"sortBy\",\n\t\t\tvalue: function sortBy(index) {\n\t\t\t\tvar _this11 = this;\n\n\t\t\t\tvar result = [],\n\t\t\t\t    keys = [],\n\t\t\t\t    lindex = undefined;\n\n\t\t\t\tif (!this.indexes.has(index)) {\n\t\t\t\t\tthis.index.push(index);\n\t\t\t\t\tthis.reindex(index);\n\t\t\t\t}\n\n\t\t\t\tlindex = this.indexes.get(index);\n\t\t\t\tlindex.forEach(function (idx, key) {\n\t\t\t\t\tkeys.push(key);\n\t\t\t\t});\n\n\t\t\t\tkeys.sort().forEach(function (i) {\n\t\t\t\t\tlindex.get(i).forEach(function (key) {\n\t\t\t\t\t\tresult.push(_this11.get(key));\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\treturn tuple.apply(tuple, result);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"storage\",\n\t\t\tvalue: function storage() {\n\t\t\t\tvar _this12 = this;\n\n\t\t\t\tfor (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n\t\t\t\t\targs[_key2] = arguments[_key2];\n\t\t\t\t}\n\n\t\t\t\tvar defer = deferred(),\n\t\t\t\t    deferreds = [];\n\n\t\t\t\tObject.keys(this.adapters).forEach(function (i) {\n\t\t\t\t\tdeferreds.push(_this12.cmd.apply(_this12, [i].concat(args)));\n\t\t\t\t});\n\n\t\t\t\tif (deferreds.length > 0) {\n\t\t\t\t\tPromise.all(deferreds).then(function () {\n\t\t\t\t\t\tdefer.resolve(true);\n\t\t\t\t\t}, defer.reject);\n\t\t\t\t} else {\n\t\t\t\t\tdefer.resolve(false);\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"sync\",\n\t\t\tvalue: function sync() {\n\t\t\t\tvar _this13 = this;\n\n\t\t\t\tvar clear = arguments.length <= 0 || arguments[0] === undefined ? false : arguments[0];\n\n\t\t\t\tvar defer = deferred();\n\n\t\t\t\tthis.request(this.uri).then(function (arg) {\n\t\t\t\t\tvar data = arg[0];\n\n\t\t\t\t\t_this13.patch = (arg[2].Allow || arg[2].allow || \"\").indexOf(\"PATCH\") > -1;\n\n\t\t\t\t\tif (_this13.source) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t_this13.source.split(\".\").forEach(function (i) {\n\t\t\t\t\t\t\t\tdata = data[i];\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\treturn defer.reject(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (clear) {\n\t\t\t\t\t\t_this13.clear();\n\t\t\t\t\t}\n\n\t\t\t\t\t_this13.batch(data, \"set\").then(defer.resolve, defer.reject);\n\t\t\t\t}, function (e) {\n\t\t\t\t\tdefer.reject(e[0] || e);\n\t\t\t\t});\n\n\t\t\t\treturn defer.promise;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"toArray\",\n\t\t\tvalue: function toArray(data) {\n\t\t\t\tvar frozen = arguments.length <= 1 || arguments[1] === undefined ? true : arguments[1];\n\n\t\t\t\tvar key = this.key,\n\t\t\t\t    fn = undefined,\n\t\t\t\t    result = undefined;\n\n\t\t\t\tif (data) {\n\t\t\t\t\tfn = (function () {\n\t\t\t\t\t\tif (key) {\n\t\t\t\t\t\t\treturn function (a, b) {\n\t\t\t\t\t\t\t\tvar obj = clone(b[1]);\n\n\t\t\t\t\t\t\t\tif (obj[key] === undefined) {\n\t\t\t\t\t\t\t\t\tobj[key] = clone(b[0]);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\ta.push(obj);\n\n\t\t\t\t\t\t\t\treturn a;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn function (a, b) {\n\t\t\t\t\t\t\t\ta.push(clone(b[1]));\n\n\t\t\t\t\t\t\t\treturn a;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t})();\n\t\t\t\t\tresult = data.reduce(fn, []);\n\t\t\t\t} else {\n\t\t\t\t\tfn = (function () {\n\t\t\t\t\t\tif (key) {\n\t\t\t\t\t\t\treturn function (val, id) {\n\t\t\t\t\t\t\t\tvar obj = clone(val);\n\n\t\t\t\t\t\t\t\tif (obj[key] === undefined) {\n\t\t\t\t\t\t\t\t\tobj[key] = clone(id);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tresult.push(obj);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn function (val) {\n\t\t\t\t\t\t\t\tresult.push(clone(val));\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t})();\n\t\t\t\t\tresult = [];\n\t\t\t\t\tthis.forEach(fn);\n\t\t\t\t}\n\n\t\t\t\treturn frozen ? Object.freeze(result) : result;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"toObject\",\n\t\t\tvalue: function toObject(data) {\n\t\t\t\tvar frozen = arguments.length <= 1 || arguments[1] === undefined ? true : arguments[1];\n\n\t\t\t\tvar func = undefined;\n\n\t\t\t\tif (frozen) {\n\t\t\t\t\tfunc = function (arg) {\n\t\t\t\t\t\treturn arg;\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tfunc = function (arg) {\n\t\t\t\t\t\treturn clone(arg);\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn func(!data ? toObjekt(this) : data.reduce(function (a, b) {\n\t\t\t\t\ta[b[0]] = b[1];\n\n\t\t\t\t\treturn a;\n\t\t\t\t}, {}));\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"transform\",\n\t\t\tvalue: function transform(input, fn) {\n\t\t\t\treturn typeof fn === \"function\" ? fn(input) : _transform(input);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"unload\",\n\t\t\tvalue: function unload() {\n\t\t\t\tvar _this14 = this;\n\n\t\t\t\tvar type = arguments.length <= 0 || arguments[0] === undefined ? \"mongo\" : arguments[0];\n\t\t\t\tvar key = arguments.length <= 1 || arguments[1] === undefined ? undefined : arguments[1];\n\n\t\t\t\tvar id = key !== undefined ? key : this.id;\n\n\t\t\t\treturn this.cmd(type, \"remove\", key).then(function (arg) {\n\t\t\t\t\tif (_this14.logging) {\n\t\t\t\t\t\tconsole.log(\"Unloaded\", id, \"from\", type, \"persistent storage\");\n\t\t\t\t\t}\n\n\t\t\t\t\treturn arg;\n\t\t\t\t}, function (e) {\n\t\t\t\t\tif (_this14.logging) {\n\t\t\t\t\t\tconsole.error(\"Error unloading\", id, \"from\", type, \"persistent storage:\", e.message || e.stack || e);\n\t\t\t\t\t}\n\n\t\t\t\t\tthrow e;\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"unregister\",\n\t\t\tvalue: function unregister(key) {\n\t\t\t\tdelete adapter[key];\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"values\",\n\t\t\tvalue: function values() {\n\t\t\t\treturn this.data.values();\n\t\t\t}\n\t\t}]);\n\n\t\treturn Haro;\n\t})();\n\n\tfunction factory() {\n\t\tvar data = arguments.length <= 0 || arguments[0] === undefined ? null : arguments[0];\n\t\tvar config = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\t\tvar indexes = arguments.length <= 2 || arguments[2] === undefined ? [] : arguments[2];\n\n\t\tvar obj = new Haro(data, config, indexes),\n\t\t    functions = undefined;\n\n\t\tif (webWorker) {\n\t\t\tfunctions = [clone.toString(), keyIndex.toString(), iterate.toString(), merge.toString(), setIndexValue.toString(), setIndex.toString(), _transform.toString()];\n\n\t\t\ttry {\n\t\t\t\tobj.worker = global.URL.createObjectURL(blob(functions.join(\"\\n\")));\n\t\t\t} catch (e) {\n\t\t\t\tobj.worker = null;\n\t\t\t}\n\t\t}\n\n\t\treturn obj;\n\t}\n\n\tfactory.version = \"1.6.2\";\n\n\t// Node, AMD & window supported\n\tif (typeof exports !== \"undefined\") {\n\t\tmodule.exports = factory;\n\t} else if (typeof define === \"function\") {\n\t\tdefine(function () {\n\t\t\treturn factory;\n\t\t});\n\t} else {\n\t\tglobal.haro = factory;\n\t}\n})(typeof global !== \"undefined\" ? global : window);\n"]}