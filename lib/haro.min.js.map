{"version":3,"sources":["haro.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","global","cast","input","result","Map","forEach","value","Set","push","Array","isArray","add","keys","set","blob","arg","obj","Blob","type","e","BlobBuilder","MSBlobBuilder","WebKitBlobBuilder","MozBlobBuilder","append","getBlob","clone","JSON","parse","stringify","concatURI","left","right","replace","regex","querystring","endslash","keyIndex","data","delimiter","pattern","split","sort","map","String","RegExp","toLowerCase","join","delIndex","index","indexes","idx","get","o","has","delete","size","createIndexes","records","lkey","undefined","lindex","each","fn","nth","iterate","call","merge","a","b","concat","joinData","id","on","ids","include","arguments","reverse","x","comp","c","filter","error","errorMsg","v","k","onmessage","ev","cmd","postMessage","patch","ogdata","overwrite","op","path","s","Math","random","toString","substring","setIndexValue","setIndex","indice","lidx","toObjekt","uuid","substr","r","floor","factory","config","Haro","functions","webWorker","server","worker","Function","URL","createObjectURL","process","nextTick","Promise","require","fetch","deferred","tuple","Worker","webWorkerError","adapter","_this","this","adapters","method","credentials","headers","accept","content-type","loading","logging","registry","source","total","uri","versions","versioning","reindex","batch","args","next","all","then","defer","resolve","reject","_this2","lload","del","hash","toArray","toObject","request","body","promise","larg","apply","onbatch","console","log","onerror","clear","onclear","_len","_key","Error","_this3","indexOf","shift","pop","splice","storage","success","message","stack","ondelete","transform","entries","where","_this4","raw","ctx","output","other","offload","find","max","offset","lmax","loffset","list","_this5","payload","useWorker","_this6","datum","_this7","cfg","toUpperCase","res","status","_headers","_this8","_this9","rgex","test","seen","lset","_this10","override","ldata","luri","xdata","onset","sync","frozen","freeze","_this11","_this12","_len2","_key2","deferreds","_this13","Allow","allow","onsync","reduce","val","func","_this14","values","err","terminate","version","exports","module","define","amd","haro","window"],"mappings":"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","file":"haro.min.js","sourcesContent":["/**\r\n * Harō is a modern immutable DataStore using Maps, Sets, Promises, & Tuples\r\n *\r\n * @author Jason Mulligan <jason.mulligan@avoidwork.com>\r\n * @copyright 2016\r\n * @license BSD-3-Clause\r\n * @link http://haro.rocks\r\n * @version 1.9.13\r\n */\n\"use strict\";\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n(function (global) {\n\tvar server = typeof process !== \"undefined\" && typeof process.nextTick === \"function\";\n\tvar Promise = global.Promise || require(\"es6-promise\").Promise;\n\tvar Map = global.Map || require(\"es6-map\");\n\tvar Set = global.Set || require(\"es6-set\");\n\tvar fetch = global.fetch || require(\"node-fetch\");\n\tvar deferred = global.deferred || require(\"tiny-defer\");\n\tvar tuple = global.tuple || require(\"tiny-tuple\");\n\tvar Blob = global.Blob || require(\"Blob\");\n\tvar Worker = global.Worker || require(\"tiny-worker\");\n\tvar r = [8, 9, \"a\", \"b\"];\n\tvar regex = {\n\t\tquerystring: /\\?.*/,\n\t\tendslash: /\\/$/\n\t};\n\tvar webWorker = typeof Blob !== \"undefined\" && typeof Worker !== \"undefined\";\n\tvar webWorkerError = \"Web Worker not supported\";\n\tvar adapter = {};\n\n\tfunction cast(input) {\n\t\tvar result = void 0;\n\n\t\tswitch (true) {\n\t\t\tcase input instanceof Map:\n\t\t\t\tresult = {};\n\t\t\t\tinput.forEach(function (value, key) {\n\t\t\t\t\tresult[key] = cast(value);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase input instanceof Set:\n\t\t\t\tresult = [];\n\t\t\t\tinput.forEach(function (i) {\n\t\t\t\t\tresult.push(cast(i));\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase Array.isArray(input):\n\t\t\t\tresult = new Set();\n\t\t\t\tinput.forEach(function (i) {\n\t\t\t\t\tresult.add(cast(i));\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase input instanceof Object:\n\t\t\t\tresult = new Map();\n\t\t\t\tObject.keys(input).forEach(function (i) {\n\t\t\t\t\tresult.set(i, cast(input[i]));\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tresult = input;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tfunction blob(arg) {\n\t\tvar obj = void 0;\n\n\t\ttry {\n\t\t\tobj = new Blob([arg], { type: \"application/javascript\" });\n\t\t} catch (e) {\n\t\t\tif (!global.BlobBuilder) {\n\t\t\t\tglobal.BlobBuilder = global.MSBlobBuilder || global.WebKitBlobBuilder || global.MozBlobBuilder;\n\t\t\t}\n\n\t\t\tobj = new global.BlobBuilder().append(arg).getBlob();\n\t\t}\n\n\t\treturn obj;\n\t}\n\n\tfunction clone(arg) {\n\t\treturn JSON.parse(JSON.stringify(arg));\n\t}\n\n\tfunction concatURI(left, right) {\n\t\treturn left.replace(regex.querystring, \"\").replace(regex.endslash, \"\") + (right ? \"/\" + right : \"\");\n\t}\n\n\tfunction keyIndex(key, data, delimiter, pattern) {\n\t\tvar keys = key.split(delimiter).sort(),\n\t\t    result = void 0;\n\n\t\tif (keys.length > 1) {\n\t\t\tresult = keys.map(function (i) {\n\t\t\t\treturn String(data[i]).replace(new RegExp(pattern, \"g\"), \"\").toLowerCase();\n\t\t\t}).join(delimiter);\n\t\t} else {\n\t\t\tresult = data[key];\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tfunction delIndex(index, indexes, delimiter, key, data, pattern) {\n\t\tindex.forEach(function (i) {\n\t\t\tvar idx = indexes.get(i),\n\t\t\t    value = keyIndex(i, data, delimiter, pattern),\n\t\t\t    o = void 0;\n\n\t\t\tif (idx.has(value)) {\n\t\t\t\to = idx.get(value);\n\t\t\t\to.delete(key);\n\n\t\t\t\tif (o.size === 0) {\n\t\t\t\t\to = null;\n\t\t\t\t\tidx.delete(value);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction createIndexes(records, indexes, key, delimiter, pattern) {\n\t\tvar result = {};\n\n\t\tindexes.forEach(function (i) {\n\t\t\tresult[i] = {};\n\t\t});\n\n\t\trecords.forEach(function (i) {\n\t\t\tvar lkey = i[key];\n\n\t\t\tif (lkey !== undefined) {\n\t\t\t\tindexes.forEach(function (index) {\n\t\t\t\t\tvar lindex = keyIndex(index, i, delimiter, pattern);\n\n\t\t\t\t\tif (result[index][lindex] === undefined) {\n\t\t\t\t\t\tresult[index][lindex] = [];\n\t\t\t\t\t}\n\n\t\t\t\t\tresult[index][lindex].push(lkey);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tfunction each(arg, fn) {\n\t\tvar i = -1,\n\t\t    nth = arg.length;\n\n\t\twhile (++i < nth) {\n\t\t\tif (fn(arg[i]) === false) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction iterate(obj, fn) {\n\t\tif (obj instanceof Object) {\n\t\t\tObject.keys(obj).forEach(function (i) {\n\t\t\t\tfn.call(obj, obj[i], i);\n\t\t\t});\n\t\t} else {\n\t\t\tobj.forEach(fn);\n\t\t}\n\t}\n\n\tfunction merge(a, b) {\n\t\tif (a instanceof Object && b instanceof Object) {\n\t\t\tObject.keys(b).forEach(function (i) {\n\t\t\t\tif (a[i] instanceof Object && b[i] instanceof Object) {\n\t\t\t\t\ta[i] = merge(a[i], b[i]);\n\t\t\t\t} else if (Array.isArray(a[i]) && Array.isArray(b[i])) {\n\t\t\t\t\ta[i] = a[i].concat(b[i]);\n\t\t\t\t} else {\n\t\t\t\t\ta[i] = b[i];\n\t\t\t\t}\n\t\t\t});\n\t\t} else if (Array.isArray(a) && Array.isArray(b)) {\n\t\t\ta = a.concat(b);\n\t\t} else {\n\t\t\ta = b;\n\t\t}\n\n\t\treturn a;\n\t}\n\n\tfunction joinData(id, a, b, key, on) {\n\t\tvar type = arguments.length <= 5 || arguments[5] === undefined ? \"inner\" : arguments[5];\n\n\t\tvar error = false,\n\t\t    result = [],\n\t\t    errorMsg = void 0;\n\n\t\tfunction join(left, right, ids) {\n\t\t\tvar include = arguments.length <= 3 || arguments[3] === undefined ? false : arguments[3];\n\t\t\tvar reverse = arguments.length <= 4 || arguments[4] === undefined ? false : arguments[4];\n\n\t\t\tvar keys = Object.keys(right[0]),\n\t\t\t    fn = void 0;\n\n\t\t\tfn = !reverse ? function (x, i) {\n\t\t\t\treturn x[on] === i[key];\n\t\t\t} : function (x, i) {\n\t\t\t\treturn x[key] === i[on];\n\t\t\t};\n\n\t\t\teach(left, function (i) {\n\t\t\t\tvar comp = {},\n\t\t\t\t    c = void 0;\n\n\t\t\t\tc = right.filter(function (x) {\n\t\t\t\t\treturn fn(x, i);\n\t\t\t\t});\n\n\t\t\t\tif (c.length > 1) {\n\t\t\t\t\terror = true;\n\t\t\t\t\terrorMsg = \"More than one record found on \" + i[on];\n\t\t\t\t\treturn false;\n\t\t\t\t} else if (c.length === 1) {\n\t\t\t\t\t[i, c[0]].forEach(function (x, idx) {\n\t\t\t\t\t\titerate(x, function (v, k) {\n\t\t\t\t\t\t\tcomp[ids[idx] + \"_\" + k] = v;\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t} else if (include) {\n\t\t\t\t\titerate(i, function (v, k) {\n\t\t\t\t\t\tcomp[ids[0] + \"_\" + k] = v;\n\t\t\t\t\t});\n\n\t\t\t\t\tkeys.forEach(function (k) {\n\t\t\t\t\t\tcomp[ids[1] + \"_\" + k] = null;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (Object.keys(comp).length > 0) {\n\t\t\t\t\tresult.push(comp);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (type === \"inner\") {\n\t\t\tjoin(a, b, id);\n\t\t}\n\n\t\tif (type === \"left\") {\n\t\t\tjoin(a, b, id, true);\n\t\t}\n\n\t\tif (type === \"right\") {\n\t\t\tjoin(b, a, clone(id).reverse(), true, true);\n\t\t}\n\n\t\treturn !error ? result : errorMsg;\n\t}\n\n\tfunction onmessage(ev) {\n\t\tvar data = JSON.parse(ev.data),\n\t\t    cmd = data.cmd,\n\t\t    result = void 0;\n\n\t\tif (cmd === \"index\") {\n\t\t\tresult = createIndexes(data.records, data.index, data.key, data.delimiter, data.pattern);\n\t\t}\n\n\t\tif (cmd === \"join\") {\n\t\t\tresult = joinData(data.ids, data.records[0], data.records[1], data.key, data.on, data.type);\n\t\t}\n\n\t\tpostMessage(JSON.stringify(result));\n\t}\n\n\tfunction patch() {\n\t\tvar ogdata = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n\t\tvar data = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\t\tvar key = arguments.length <= 2 || arguments[2] === undefined ? \"\" : arguments[2];\n\t\tvar overwrite = arguments.length <= 3 || arguments[3] === undefined ? false : arguments[3];\n\n\t\tvar result = [];\n\n\t\tif (overwrite) {\n\t\t\titerate(ogdata, function (v, k) {\n\t\t\t\tif (k !== key && data[k] === undefined) {\n\t\t\t\t\tresult.push({ op: \"remove\", path: \"/\" + k });\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\titerate(data, function (v, k) {\n\t\t\tif (k !== key && ogdata[k] === undefined) {\n\t\t\t\tresult.push({ op: \"add\", path: \"/\" + k, value: v });\n\t\t\t} else if (JSON.stringify(ogdata[k]) !== JSON.stringify(v)) {\n\t\t\t\tresult.push({ op: \"replace\", path: \"/\" + k, value: v });\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tfunction s() {\n\t\treturn ((Math.random() + 1) * 0x10000 | 0).toString(16).substring(1);\n\t}\n\n\tfunction setIndexValue(index, key, value) {\n\t\tif (!index.has(key)) {\n\t\t\tindex.set(key, new Set());\n\t\t}\n\n\t\tindex.get(key).add(value);\n\t}\n\n\tfunction setIndex(index, indexes, delimiter, key, data, indice, pattern) {\n\t\tvar idx = void 0;\n\n\t\tif (!indice) {\n\t\t\tindex.forEach(function (i) {\n\t\t\t\tvar lidx = keyIndex(i, data, delimiter, pattern);\n\n\t\t\t\tif (lidx !== undefined && lidx !== null) {\n\t\t\t\t\tsetIndexValue(indexes.get(i), lidx, key);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tidx = keyIndex(indice, data, delimiter, pattern);\n\n\t\t\tif (idx !== undefined && idx !== null) {\n\t\t\t\tsetIndexValue(indexes.get(indice), idx, key);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction toObjekt(arg) {\n\t\tvar result = {};\n\n\t\targ.forEach(function (value, key) {\n\t\t\tresult[key] = value;\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tfunction uuid() {\n\t\treturn s() + s() + \"-\" + s() + \"-4\" + s().substr(0, 3) + \"-\" + r[Math.floor(Math.random() * 4)] + s().substr(0, 3) + \"-\" + s() + s() + s();\n\t}\n\n\tvar Haro = function () {\n\t\tfunction Haro(data) {\n\t\t\tvar _this = this;\n\n\t\t\tvar config = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n\t\t\t_classCallCheck(this, Haro);\n\n\t\t\tthis.adapters = {};\n\t\t\tthis.data = new Map();\n\t\t\tthis.delimiter = \"|\";\n\t\t\tthis.config = {\n\t\t\t\tmethod: \"get\",\n\t\t\t\tcredentials: false,\n\t\t\t\theaders: {\n\t\t\t\t\taccept: \"application/json\",\n\t\t\t\t\t\"content-type\": \"application/json\"\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.id = uuid();\n\t\t\tthis.index = [];\n\t\t\tthis.indexes = new Map();\n\t\t\tthis.key = \"\";\n\t\t\tthis.loading = false;\n\t\t\tthis.logging = true;\n\t\t\tthis.patch = false;\n\t\t\tthis.pattern = \"\\\\s*|\\\\t*\";\n\t\t\tthis.registry = [];\n\t\t\tthis.source = \"\";\n\t\t\tthis.total = 0;\n\t\t\tthis.uri = \"\";\n\t\t\tthis.worker = null;\n\t\t\tthis.versions = new Map();\n\t\t\tthis.versioning = true;\n\n\t\t\tObject.keys(config).forEach(function (i) {\n\t\t\t\t_this[i] = merge(_this[i], config[i]);\n\t\t\t});\n\n\t\t\tthis.reindex();\n\n\t\t\tif (data) {\n\t\t\t\tthis.batch(data, \"set\");\n\t\t\t}\n\t\t}\n\n\t\t_createClass(Haro, [{\n\t\t\tkey: \"batch\",\n\t\t\tvalue: function batch(args, type) {\n\t\t\t\tvar _this2 = this;\n\n\t\t\t\tvar lload = arguments.length <= 2 || arguments[2] === undefined ? false : arguments[2];\n\n\t\t\t\tvar defer = deferred(),\n\t\t\t\t    del = type === \"del\",\n\t\t\t\t    data = void 0,\n\t\t\t\t    fn = void 0,\n\t\t\t\t    hash = void 0;\n\n\t\t\t\tfunction next() {\n\t\t\t\t\tPromise.all(args.map(fn)).then(defer.resolve, defer.reject);\n\t\t\t\t}\n\n\t\t\t\tthis.loading = true;\n\n\t\t\t\tif (del) {\n\t\t\t\t\tfn = function fn(i) {\n\t\t\t\t\t\treturn _this2.del(i, true);\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tfn = function fn(i) {\n\t\t\t\t\t\treturn _this2.set(null, i, true, true, lload);\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (this.patch) {\n\t\t\t\t\tif (del) {\n\t\t\t\t\t\tdata = patch(this.toArray().map(function (i) {\n\t\t\t\t\t\t\treturn i[_this2.key];\n\t\t\t\t\t\t}), args, this.key, true);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata = [];\n\t\t\t\t\t\thash = {};\n\t\t\t\t\t\targs.forEach(function (i) {\n\t\t\t\t\t\t\tvar key = i[_this2.key];\n\n\t\t\t\t\t\t\tif (key) {\n\t\t\t\t\t\t\t\thash[key] = i;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdata.push({ op: \"add\", path: \"/\", value: i });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tdata = data.concat(patch(this.toObject(), hash, this.key, true));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data.length > 0) {\n\t\t\t\t\t\tthis.request(concatURI(this.uri, null), {\n\t\t\t\t\t\t\tmethod: \"patch\",\n\t\t\t\t\t\t\tbody: JSON.stringify(data)\n\t\t\t\t\t\t}).then(function () {\n\t\t\t\t\t\t\tnext();\n\t\t\t\t\t\t}, defer.reject);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdefer.resolve();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tnext();\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise.then(function (arg) {\n\t\t\t\t\tvar larg = tuple.apply(tuple, arg);\n\n\t\t\t\t\t_this2.loading = false;\n\t\t\t\t\t_this2.onbatch(type, larg);\n\n\t\t\t\t\tif (_this2.logging) {\n\t\t\t\t\t\tconsole.log(\"Batch inserted data into\", _this2.id);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn larg;\n\t\t\t\t}, function (e) {\n\t\t\t\t\t_this2.loading = false;\n\t\t\t\t\t_this2.onerror(\"batch\", e);\n\t\t\t\t\tthrow e;\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"clear\",\n\t\t\tvalue: function clear() {\n\t\t\t\tthis.total = 0;\n\t\t\t\tthis.registry.length = 0;\n\t\t\t\tthis.data.clear();\n\t\t\t\tthis.indexes.clear();\n\t\t\t\tthis.versions.clear();\n\t\t\t\tthis.reindex().onclear();\n\n\t\t\t\tif (this.logging) {\n\t\t\t\t\tconsole.log(\"Cleared\", this.id);\n\t\t\t\t}\n\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"cmd\",\n\t\t\tvalue: function cmd(type) {\n\t\t\t\tvar defer = deferred();\n\n\t\t\t\tif (!this.adapters[type] || !adapter[type]) {\n\t\t\t\t\tdefer.reject(new Error(type + \" not configured for persistent storage\"));\n\t\t\t\t} else {\n\t\t\t\t\tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n\t\t\t\t\t\targs[_key - 1] = arguments[_key];\n\t\t\t\t\t}\n\n\t\t\t\t\tadapter[type].apply(this, [this].concat(args)).then(defer.resolve, defer.reject);\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"del\",\n\t\t\tvalue: function del(key) {\n\t\t\t\tvar _this3 = this;\n\n\t\t\t\tvar batch = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];\n\n\t\t\t\tvar defer = deferred(),\n\t\t\t\t    next = void 0;\n\n\t\t\t\tnext = function next() {\n\t\t\t\t\tvar index = _this3.registry.indexOf(key);\n\n\t\t\t\t\tif (index > -1) {\n\t\t\t\t\t\tif (index === 0) {\n\t\t\t\t\t\t\t_this3.registry.shift();\n\t\t\t\t\t\t} else if (index === _this3.registry.length - 1) {\n\t\t\t\t\t\t\t_this3.registry.pop();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t_this3.registry.splice(index, 1);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdelIndex(_this3.index, _this3.indexes, _this3.delimiter, key, _this3.data.get(key), _this3.pattern);\n\t\t\t\t\t\t_this3.data.delete(key);\n\t\t\t\t\t\t--_this3.total;\n\n\t\t\t\t\t\tif (_this3.versioning) {\n\t\t\t\t\t\t\t_this3.versions.delete(key);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_this3.storage(\"remove\", key).then(function (success) {\n\t\t\t\t\t\t\tif (success && _this3.logging) {\n\t\t\t\t\t\t\t\tconsole.log(\"Deleted\", key, \"from persistent storage\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\tif (_this3.logging) {\n\t\t\t\t\t\t\t\tconsole.error(\"Error deleting\", key, \"from persistent storage:\", e.message || e.stack || e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tdefer.resolve(key);\n\t\t\t\t};\n\n\t\t\t\tif (this.data.has(key)) {\n\t\t\t\t\tif (!batch) {\n\t\t\t\t\t\tthis.loading = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!batch && this.uri) {\n\t\t\t\t\t\tif (this.patch) {\n\t\t\t\t\t\t\tthis.request(concatURI(this.uri, null), {\n\t\t\t\t\t\t\t\tmethod: \"patch\",\n\t\t\t\t\t\t\t\tbody: JSON.stringify([{ op: \"remove\", path: \"/\" + key }])\n\t\t\t\t\t\t\t}).then(next, function (e) {\n\t\t\t\t\t\t\t\tif (e[1] === 405) {\n\t\t\t\t\t\t\t\t\t_this3.patch = false;\n\t\t\t\t\t\t\t\t\t_this3.request(concatURI(_this3.uri, key), {\n\t\t\t\t\t\t\t\t\t\tmethod: \"delete\"\n\t\t\t\t\t\t\t\t\t}).then(next, defer.reject);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.request(concatURI(this.uri, key), {\n\t\t\t\t\t\t\t\tmethod: \"delete\"\n\t\t\t\t\t\t\t}).then(next, defer.reject);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnext();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdefer.reject(new Error(\"Record not found\"));\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise.then(function (arg) {\n\t\t\t\t\tif (!batch) {\n\t\t\t\t\t\t_this3.loading = false;\n\t\t\t\t\t}\n\n\t\t\t\t\t_this3.ondelete(arg);\n\n\t\t\t\t\treturn arg;\n\t\t\t\t}, function (e) {\n\t\t\t\t\tif (!batch) {\n\t\t\t\t\t\t_this3.loading = false;\n\t\t\t\t\t}\n\n\t\t\t\t\t_this3.onerror(\"delete\", e);\n\t\t\t\t\tthrow e;\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"dump\",\n\t\t\tvalue: function dump() {\n\t\t\t\tvar type = arguments.length <= 0 || arguments[0] === undefined ? \"records\" : arguments[0];\n\n\t\t\t\tvar result = void 0;\n\n\t\t\t\tif (type === \"records\") {\n\t\t\t\t\tresult = this.toArray(null, false);\n\t\t\t\t} else {\n\t\t\t\t\tresult = this.transform(this.indexes);\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"entries\",\n\t\t\tvalue: function entries() {\n\t\t\t\treturn this.data.entries();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"find\",\n\t\t\tvalue: function find(where) {\n\t\t\t\tvar _this4 = this;\n\n\t\t\t\tvar raw = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];\n\n\t\t\t\tvar key = Object.keys(where).sort().join(this.delimiter),\n\t\t\t\t    value = keyIndex(key, where, this.delimiter),\n\t\t\t\t    result = [];\n\n\t\t\t\tif (this.indexes.has(key)) {\n\t\t\t\t\t(this.indexes.get(key).get(value) || new Set()).forEach(function (i) {\n\t\t\t\t\t\tresult.push(_this4.get(i, raw));\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn !raw ? tuple.apply(tuple, result) : clone(result);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"filter\",\n\t\t\tvalue: function filter(fn) {\n\t\t\t\tvar result = [];\n\n\t\t\t\tthis.forEach(function (value, key) {\n\t\t\t\t\tif (fn(value, key) === true) {\n\t\t\t\t\t\tresult.push(tuple(key, value));\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn tuple.apply(tuple, result);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"forEach\",\n\t\t\tvalue: function forEach(fn, ctx) {\n\t\t\t\tthis.data.forEach(function (value, key) {\n\t\t\t\t\tfn(clone(value), clone(key));\n\t\t\t\t}, ctx);\n\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"get\",\n\t\t\tvalue: function get(key) {\n\t\t\t\tvar raw = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];\n\n\t\t\t\tvar output = void 0;\n\n\t\t\t\tif (this.data.has(key)) {\n\t\t\t\t\toutput = !raw ? tuple(key, this.data.get(key)) : clone(this.data.get(key));\n\t\t\t\t}\n\n\t\t\t\treturn output;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"has\",\n\t\t\tvalue: function has(key) {\n\t\t\t\treturn this.data.has(key);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"join\",\n\t\t\tvalue: function join(other) {\n\t\t\t\tvar on = arguments.length <= 1 || arguments[1] === undefined ? this.key : arguments[1];\n\t\t\t\tvar type = arguments.length <= 2 || arguments[2] === undefined ? \"inner\" : arguments[2];\n\t\t\t\tvar where = arguments.length <= 3 || arguments[3] === undefined ? [] : arguments[3];\n\n\t\t\t\tvar defer = deferred(),\n\t\t\t\t    promise = void 0;\n\n\t\t\t\tif (other.total > 0) {\n\t\t\t\t\tif (where.length > 0) {\n\t\t\t\t\t\tpromise = this.offload([[this.id, other.id], this.find(where[0], true), !where[1] ? other.toArray(null, true) : other.find(where[1], true), this.key, on, type], \"join\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpromise = this.offload([[this.id, other.id], this.toArray(null, true), other.toArray(null, true), this.key, on, type], \"join\");\n\t\t\t\t\t}\n\n\t\t\t\t\tpromise.then(function (result) {\n\t\t\t\t\t\tif (typeof result === \"string\") {\n\t\t\t\t\t\t\tdefer.reject(new Error(result));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdefer.resolve(result);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, defer.reject);\n\t\t\t\t} else {\n\t\t\t\t\tdefer.resolve([]);\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"keys\",\n\t\t\tvalue: function keys() {\n\t\t\t\treturn this.data.keys();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"limit\",\n\t\t\tvalue: function limit(max) {\n\t\t\t\tvar offset = arguments.length <= 1 || arguments[1] === undefined ? 0 : arguments[1];\n\n\t\t\t\tvar lmax = max,\n\t\t\t\t    loffset = offset,\n\t\t\t\t    list = [],\n\t\t\t\t    i = void 0,\n\t\t\t\t    k = void 0,\n\t\t\t\t    nth = void 0;\n\n\t\t\t\tif (lmax === undefined) {\n\t\t\t\t\tlmax = -1;\n\t\t\t\t}\n\n\t\t\t\ti = loffset;\n\t\t\t\tnth = loffset + lmax;\n\n\t\t\t\tif (i < 0 || i >= nth) {\n\t\t\t\t\tthrow new Error(\"Invalid range\");\n\t\t\t\t}\n\n\t\t\t\tdo {\n\t\t\t\t\tk = this.registry[i];\n\n\t\t\t\t\tif (k) {\n\t\t\t\t\t\tlist.push(this.get(k));\n\t\t\t\t\t}\n\t\t\t\t} while (++i < nth);\n\n\t\t\t\treturn tuple.apply(tuple, list);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"load\",\n\t\t\tvalue: function load() {\n\t\t\t\tvar _this5 = this;\n\n\t\t\t\tvar type = arguments.length <= 0 || arguments[0] === undefined ? \"mongo\" : arguments[0];\n\t\t\t\tvar key = arguments.length <= 1 || arguments[1] === undefined ? undefined : arguments[1];\n\n\t\t\t\tvar batch = key === undefined,\n\t\t\t\t    id = !batch ? key : this.id;\n\n\t\t\t\tif (batch) {\n\t\t\t\t\tthis.clear();\n\t\t\t\t}\n\n\t\t\t\treturn this.cmd(type, \"get\", key).then(function (arg) {\n\t\t\t\t\tif (_this5.logging) {\n\t\t\t\t\t\tconsole.log(\"Loaded\", id, \"from\", type, \"persistent storage\");\n\t\t\t\t\t}\n\n\t\t\t\t\treturn batch ? _this5.batch(arg, \"set\", true) : _this5.set(key, arg, true, true, true);\n\t\t\t\t}, function (e) {\n\t\t\t\t\tif (_this5.logging) {\n\t\t\t\t\t\tconsole.error(\"Error loading\", id, \"from\", type, \"persistent storage:\", e.message || e.stack || e);\n\t\t\t\t\t}\n\n\t\t\t\t\tthrow e;\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"map\",\n\t\t\tvalue: function map(fn) {\n\t\t\t\tvar result = [];\n\n\t\t\t\tthis.forEach(function (value, key) {\n\t\t\t\t\tresult.push(fn(value, key));\n\t\t\t\t});\n\n\t\t\t\treturn tuple.apply(tuple, result);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"offload\",\n\t\t\tvalue: function offload(data) {\n\t\t\t\tvar cmd = arguments.length <= 1 || arguments[1] === undefined ? \"index\" : arguments[1];\n\t\t\t\tvar index = arguments.length <= 2 || arguments[2] === undefined ? this.index : arguments[2];\n\n\t\t\t\tvar defer = deferred(),\n\t\t\t\t    payload = void 0,\n\t\t\t\t    obj = void 0;\n\n\t\t\t\tif (this.worker) {\n\t\t\t\t\tobj = this.useWorker(defer);\n\n\t\t\t\t\tif (obj) {\n\t\t\t\t\t\tif (cmd === \"index\") {\n\t\t\t\t\t\t\tpayload = {\n\t\t\t\t\t\t\t\tcmd: cmd,\n\t\t\t\t\t\t\t\tindex: index,\n\t\t\t\t\t\t\t\trecords: data,\n\t\t\t\t\t\t\t\tkey: this.key,\n\t\t\t\t\t\t\t\tdelimiter: this.delimiter,\n\t\t\t\t\t\t\t\tpattern: this.pattern\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (cmd === \"join\") {\n\t\t\t\t\t\t\tpayload = {\n\t\t\t\t\t\t\t\tcmd: cmd,\n\t\t\t\t\t\t\t\tids: data[0],\n\t\t\t\t\t\t\t\trecords: [data[1], data[2]],\n\t\t\t\t\t\t\t\tkey: data[3],\n\t\t\t\t\t\t\t\ton: data[4],\n\t\t\t\t\t\t\t\ttype: data[5]\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tobj.postMessage(JSON.stringify(payload));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdefer.reject(new Error(webWorkerError));\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"onbatch\",\n\t\t\tvalue: function onbatch() {}\n\t\t}, {\n\t\t\tkey: \"onclear\",\n\t\t\tvalue: function onclear() {}\n\t\t}, {\n\t\t\tkey: \"ondelete\",\n\t\t\tvalue: function ondelete() {}\n\t\t}, {\n\t\t\tkey: \"onerror\",\n\t\t\tvalue: function onerror() {}\n\t\t}, {\n\t\t\tkey: \"onset\",\n\t\t\tvalue: function onset() {}\n\t\t}, {\n\t\t\tkey: \"onsync\",\n\t\t\tvalue: function onsync() {}\n\t\t}, {\n\t\t\tkey: \"override\",\n\t\t\tvalue: function override(data) {\n\t\t\t\tvar _this6 = this;\n\n\t\t\t\tvar type = arguments.length <= 1 || arguments[1] === undefined ? \"records\" : arguments[1];\n\t\t\t\tvar fn = arguments.length <= 2 || arguments[2] === undefined ? undefined : arguments[2];\n\n\t\t\t\tvar defer = deferred();\n\n\t\t\t\tif (type === \"indexes\") {\n\t\t\t\t\tthis.indexes = this.transform(data, fn);\n\t\t\t\t\tdefer.resolve(true);\n\t\t\t\t} else if (type === \"records\") {\n\t\t\t\t\tthis.data = new Map();\n\t\t\t\t\tthis.registry = [];\n\t\t\t\t\tdata.forEach(function (datum) {\n\t\t\t\t\t\tvar key = datum[_this6.key] || uuid();\n\n\t\t\t\t\t\t_this6.data.set(key, datum);\n\t\t\t\t\t\t_this6.registry.push(key);\n\t\t\t\t\t});\n\t\t\t\t\tthis.total = this.data.size;\n\t\t\t\t\tdefer.resolve(true);\n\t\t\t\t} else {\n\t\t\t\t\tdefer.reject(new Error(\"Invalid type\"));\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"register\",\n\t\t\tvalue: function register(key, fn) {\n\t\t\t\tadapter[key] = fn;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"reindex\",\n\t\t\tvalue: function reindex(index) {\n\t\t\t\tvar _this7 = this;\n\n\t\t\t\tif (!index) {\n\t\t\t\t\tthis.indexes.clear();\n\t\t\t\t\tthis.index.forEach(function (i) {\n\t\t\t\t\t\t_this7.indexes.set(i, new Map());\n\t\t\t\t\t});\n\t\t\t\t\tthis.forEach(function (data, key) {\n\t\t\t\t\t\t_this7.index.forEach(function (i) {\n\t\t\t\t\t\t\tsetIndex(_this7.index, _this7.indexes, _this7.delimiter, key, data, i, _this7.pattern);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.indexes.set(index, new Map());\n\t\t\t\t\tthis.forEach(function (data, key) {\n\t\t\t\t\t\tsetIndex(_this7.index, _this7.indexes, _this7.delimiter, key, data, index, _this7.pattern);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"request\",\n\t\t\tvalue: function request(input) {\n\t\t\t\tvar config = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n\t\t\t\tvar defer = deferred(),\n\t\t\t\t    cfg = merge(this.config, config);\n\n\t\t\t\tcfg.method = cfg.method.toUpperCase();\n\n\t\t\t\tfetch(input, cfg).then(function (res) {\n\t\t\t\t\tvar status = res.status,\n\t\t\t\t\t    headers = void 0;\n\n\t\t\t\t\tif (res.headers._headers) {\n\t\t\t\t\t\theaders = {};\n\t\t\t\t\t\tObject.keys(res.headers._headers).forEach(function (i) {\n\t\t\t\t\t\t\theaders[i] = res.headers._headers[i].join(\", \");\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\theaders = toObjekt(res.headers);\n\t\t\t\t\t}\n\n\t\t\t\t\tres[res.headers.get(\"content-type\").indexOf(\"application/json\") > -1 ? \"json\" : \"text\"]().then(function (arg) {\n\t\t\t\t\t\tdefer[status < 200 || status >= 400 ? \"reject\" : \"resolve\"](tuple(arg, status, headers));\n\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\tdefer.reject(tuple(e.message, status, headers));\n\t\t\t\t\t});\n\t\t\t\t}, function (e) {\n\t\t\t\t\tdefer.reject(tuple(e.message, 0, {}));\n\t\t\t\t});\n\n\t\t\t\treturn defer.promise;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"save\",\n\t\t\tvalue: function save() {\n\t\t\t\tvar _this8 = this;\n\n\t\t\t\tvar type = arguments.length <= 0 || arguments[0] === undefined ? \"mongo\" : arguments[0];\n\n\t\t\t\treturn this.cmd(type, \"set\").then(function (arg) {\n\t\t\t\t\tif (_this8.logging) {\n\t\t\t\t\t\tconsole.log(\"Saved\", _this8.id, \"to\", type, \"persistent storage\");\n\t\t\t\t\t}\n\n\t\t\t\t\treturn arg;\n\t\t\t\t}, function (e) {\n\t\t\t\t\tif (_this8.logging) {\n\t\t\t\t\t\tconsole.error(\"Error saving \", _this8.id, \"to\", type, \"persistent storage:\", e.message || e.stack || e);\n\t\t\t\t\t}\n\n\t\t\t\t\tthrow e;\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"search\",\n\t\t\tvalue: function search(value, index) {\n\t\t\t\tvar _this9 = this;\n\n\t\t\t\tvar raw = arguments.length <= 2 || arguments[2] === undefined ? false : arguments[2];\n\n\t\t\t\tvar result = [],\n\t\t\t\t    fn = typeof value === \"function\",\n\t\t\t\t    rgex = value && typeof value.test === \"function\",\n\t\t\t\t    seen = new Set(),\n\t\t\t\t    lindex = void 0,\n\t\t\t\t    indexes = void 0;\n\n\t\t\t\tif (value) {\n\t\t\t\t\tlindex = clone(index || this.index);\n\n\t\t\t\t\tif (Array.isArray(lindex)) {\n\t\t\t\t\t\tindexes = lindex;\n\t\t\t\t\t} else if (typeof lindex === \"string\") {\n\t\t\t\t\t\tindexes = [lindex];\n\t\t\t\t\t}\n\n\t\t\t\t\tindexes.forEach(function (i) {\n\t\t\t\t\t\tvar idx = _this9.indexes.get(i);\n\n\t\t\t\t\t\tif (idx) {\n\t\t\t\t\t\t\tidx.forEach(function (lset, lkey) {\n\t\t\t\t\t\t\t\tswitch (true) {\n\t\t\t\t\t\t\t\t\tcase fn && value(lkey, i):\n\t\t\t\t\t\t\t\t\tcase rgex && value.test(Array.isArray(lkey) ? lkey.join(\", \") : lkey):\n\t\t\t\t\t\t\t\t\tcase lkey === value:\n\t\t\t\t\t\t\t\t\t\tlset.forEach(function (key) {\n\t\t\t\t\t\t\t\t\t\t\tif (!seen.has(key)) {\n\t\t\t\t\t\t\t\t\t\t\t\tseen.add(key);\n\t\t\t\t\t\t\t\t\t\t\t\tresult.push(_this9.get(key, raw));\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\tvoid 0;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn !raw ? tuple.apply(tuple, result) : clone(result);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"set\",\n\t\t\tvalue: function set(key, data) {\n\t\t\t\tvar batch = arguments.length <= 2 || arguments[2] === undefined ? false : arguments[2];\n\n\t\t\t\tvar _this10 = this;\n\n\t\t\t\tvar override = arguments.length <= 3 || arguments[3] === undefined ? false : arguments[3];\n\t\t\t\tvar lload = arguments.length <= 4 || arguments[4] === undefined ? false : arguments[4];\n\n\t\t\t\tvar defer = deferred(),\n\t\t\t\t    method = \"post\",\n\t\t\t\t    ldata = clone(data),\n\t\t\t\t    lkey = key,\n\t\t\t\t    body = void 0,\n\t\t\t\t    ogdata = void 0,\n\t\t\t\t    luri = void 0;\n\n\t\t\t\tvar next = function next(arg) {\n\t\t\t\t\tvar xdata = arg ? arg[0] : {};\n\n\t\t\t\t\tif (lkey === null) {\n\t\t\t\t\t\tif (_this10.key) {\n\t\t\t\t\t\t\tif (_this10.source) {\n\t\t\t\t\t\t\t\t_this10.source.split(\".\").forEach(function (i) {\n\t\t\t\t\t\t\t\t\txdata = xdata[i] || {};\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlkey = xdata[_this10.key] || ldata[_this10.key] || uuid();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlkey = uuid();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (method === \"post\") {\n\t\t\t\t\t\t_this10.registry[_this10.total] = lkey;\n\t\t\t\t\t\t++_this10.total;\n\n\t\t\t\t\t\tif (_this10.versioning) {\n\t\t\t\t\t\t\t_this10.versions.set(lkey, new Set());\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (_this10.versioning) {\n\t\t\t\t\t\t\t_this10.versions.get(lkey).add(tuple(ogdata));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdelIndex(_this10.index, _this10.indexes, _this10.delimiter, lkey, ogdata, _this10.pattern);\n\t\t\t\t\t}\n\n\t\t\t\t\t_this10.data.set(lkey, ldata);\n\t\t\t\t\tsetIndex(_this10.index, _this10.indexes, _this10.delimiter, lkey, ldata, null, _this10.pattern);\n\t\t\t\t\tdefer.resolve(_this10.get(lkey));\n\n\t\t\t\t\tif (!lload) {\n\t\t\t\t\t\t_this10.storage(\"set\", lkey, ldata).then(function (success) {\n\t\t\t\t\t\t\tif (success && _this10.logging) {\n\t\t\t\t\t\t\t\tconsole.log(\"Saved\", lkey, \"to persistent storage\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\tif (_this10.logging) {\n\t\t\t\t\t\t\t\tconsole.error(\"Error saving\", lkey, \"to persistent storage:\", e.message || e.stack || e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tif (lkey === undefined || lkey === null) {\n\t\t\t\t\tlkey = ldata[this.key] || null;\n\t\t\t\t}\n\n\t\t\t\tif (lkey && this.data.has(lkey)) {\n\t\t\t\t\tmethod = \"put\";\n\t\t\t\t\togdata = this.data.get(lkey);\n\n\t\t\t\t\tif (!override) {\n\t\t\t\t\t\tldata = merge(ogdata, ldata);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!batch) {\n\t\t\t\t\tthis.loading = true;\n\t\t\t\t}\n\n\t\t\t\tif (!batch && this.uri) {\n\t\t\t\t\tluri = concatURI(this.uri, lkey);\n\n\t\t\t\t\tif (this.patch) {\n\t\t\t\t\t\tif (method === \"post\") {\n\t\t\t\t\t\t\tbody = [{ op: \"add\", path: \"/\", value: ldata }];\n\t\t\t\t\t\t} else if (override) {\n\t\t\t\t\t\t\tbody = [{ op: \"replace\", path: \"/\", value: ldata }];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbody = patch(ogdata, ldata, this.key);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.request(luri, {\n\t\t\t\t\t\t\tmethod: \"patch\",\n\t\t\t\t\t\t\tbody: JSON.stringify(body)\n\t\t\t\t\t\t}).then(next, function (e) {\n\t\t\t\t\t\t\tif (e[1] === 405) {\n\t\t\t\t\t\t\t\t_this10.patch = false;\n\t\t\t\t\t\t\t\t_this10.request(luri, {\n\t\t\t\t\t\t\t\t\tmethod: method,\n\t\t\t\t\t\t\t\t\tbody: JSON.stringify(ldata)\n\t\t\t\t\t\t\t\t}).then(next, defer.reject);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.request(luri, {\n\t\t\t\t\t\t\tmethod: method,\n\t\t\t\t\t\t\tbody: JSON.stringify(ldata)\n\t\t\t\t\t\t}).then(next, defer.reject);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tnext();\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise.then(function (arg) {\n\t\t\t\t\tif (!batch) {\n\t\t\t\t\t\t_this10.loading = false;\n\t\t\t\t\t}\n\n\t\t\t\t\t_this10.onset(arg);\n\n\t\t\t\t\treturn arg;\n\t\t\t\t}, function (e) {\n\t\t\t\t\tif (!batch) {\n\t\t\t\t\t\t_this10.loading = false;\n\t\t\t\t\t}\n\n\t\t\t\t\t_this10.onerror(\"set\", e);\n\t\t\t\t\tthrow e;\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"setUri\",\n\t\t\tvalue: function setUri(uri) {\n\t\t\t\tvar clear = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];\n\n\t\t\t\tvar defer = deferred();\n\n\t\t\t\tthis.uri = uri;\n\n\t\t\t\tif (this.uri) {\n\t\t\t\t\tthis.sync(clear).then(defer.resolve, defer.reject);\n\t\t\t\t} else {\n\t\t\t\t\tdefer.resolve([]);\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"sort\",\n\t\t\tvalue: function sort(fn) {\n\t\t\t\tvar frozen = arguments.length <= 1 || arguments[1] === undefined ? true : arguments[1];\n\n\t\t\t\tvar result = void 0;\n\n\t\t\t\tif (frozen) {\n\t\t\t\t\tresult = Object.freeze(this.toArray(null, false).sort(fn).map(function (i) {\n\t\t\t\t\t\treturn Object.freeze(i);\n\t\t\t\t\t}));\n\t\t\t\t} else {\n\t\t\t\t\tresult = this.toArray(null, false).sort(fn);\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"sortBy\",\n\t\t\tvalue: function sortBy(index) {\n\t\t\t\tvar _this11 = this;\n\n\t\t\t\tvar result = [],\n\t\t\t\t    keys = [],\n\t\t\t\t    lindex = void 0;\n\n\t\t\t\tif (!this.indexes.has(index)) {\n\t\t\t\t\tthis.index.push(index);\n\t\t\t\t\tthis.reindex(index);\n\t\t\t\t}\n\n\t\t\t\tlindex = this.indexes.get(index);\n\t\t\t\tlindex.forEach(function (idx, key) {\n\t\t\t\t\tkeys.push(key);\n\t\t\t\t});\n\n\t\t\t\tkeys.sort().forEach(function (i) {\n\t\t\t\t\tlindex.get(i).forEach(function (key) {\n\t\t\t\t\t\tresult.push(_this11.get(key));\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\treturn tuple.apply(tuple, result);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"storage\",\n\t\t\tvalue: function storage() {\n\t\t\t\tvar _this12 = this;\n\n\t\t\t\tfor (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n\t\t\t\t\targs[_key2] = arguments[_key2];\n\t\t\t\t}\n\n\t\t\t\tvar defer = deferred(),\n\t\t\t\t    deferreds = [];\n\n\t\t\t\tObject.keys(this.adapters).forEach(function (i) {\n\t\t\t\t\tdeferreds.push(_this12.cmd.apply(_this12, [i].concat(args)));\n\t\t\t\t});\n\n\t\t\t\tif (deferreds.length > 0) {\n\t\t\t\t\tPromise.all(deferreds).then(function () {\n\t\t\t\t\t\tdefer.resolve(true);\n\t\t\t\t\t}, defer.reject);\n\t\t\t\t} else {\n\t\t\t\t\tdefer.resolve(false);\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"sync\",\n\t\t\tvalue: function sync() {\n\t\t\t\tvar _this13 = this;\n\n\t\t\t\tvar clear = arguments.length <= 0 || arguments[0] === undefined ? false : arguments[0];\n\n\t\t\t\tvar defer = deferred();\n\n\t\t\t\tthis.request(this.uri).then(function (arg) {\n\t\t\t\t\tvar data = arg[0];\n\n\t\t\t\t\t_this13.patch = (arg[2].Allow || arg[2].allow || \"\").indexOf(\"PATCH\") > -1;\n\n\t\t\t\t\tif (_this13.source) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t_this13.source.split(\".\").forEach(function (i) {\n\t\t\t\t\t\t\t\tdata = data[i];\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\treturn defer.reject(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (clear) {\n\t\t\t\t\t\t_this13.clear();\n\t\t\t\t\t}\n\n\t\t\t\t\t_this13.batch(data, \"set\").then(defer.resolve, defer.reject);\n\t\t\t\t}, function (e) {\n\t\t\t\t\tdefer.reject(e[0] || e);\n\t\t\t\t});\n\n\t\t\t\treturn defer.promise.then(function (arg) {\n\t\t\t\t\tvar larg = tuple.apply(tuple, arg);\n\n\t\t\t\t\t_this13.onsync(larg);\n\n\t\t\t\t\treturn larg;\n\t\t\t\t}, function (e) {\n\t\t\t\t\t_this13.onerror(\"sync\", e);\n\t\t\t\t\tthrow e;\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"toArray\",\n\t\t\tvalue: function toArray(data) {\n\t\t\t\tvar frozen = arguments.length <= 1 || arguments[1] === undefined ? true : arguments[1];\n\n\t\t\t\tvar key = this.key,\n\t\t\t\t    fn = void 0,\n\t\t\t\t    result = void 0;\n\n\t\t\t\tif (data) {\n\t\t\t\t\tfn = function () {\n\t\t\t\t\t\tif (key) {\n\t\t\t\t\t\t\treturn function (a, b) {\n\t\t\t\t\t\t\t\tvar obj = clone(b[1]);\n\n\t\t\t\t\t\t\t\tif (obj[key] === undefined) {\n\t\t\t\t\t\t\t\t\tobj[key] = clone(b[0]);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\ta.push(obj);\n\n\t\t\t\t\t\t\t\treturn a;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn function (a, b) {\n\t\t\t\t\t\t\t\ta.push(clone(b[1]));\n\n\t\t\t\t\t\t\t\treturn a;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t}();\n\t\t\t\t\tresult = data.reduce(fn, []);\n\t\t\t\t} else {\n\t\t\t\t\tfn = function () {\n\t\t\t\t\t\tif (key) {\n\t\t\t\t\t\t\treturn function (val, id) {\n\t\t\t\t\t\t\t\tvar obj = clone(val);\n\n\t\t\t\t\t\t\t\tif (obj[key] === undefined) {\n\t\t\t\t\t\t\t\t\tobj[key] = clone(id);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tresult.push(obj);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn function (val) {\n\t\t\t\t\t\t\t\tresult.push(clone(val));\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t}();\n\t\t\t\t\tresult = [];\n\t\t\t\t\tthis.forEach(fn);\n\t\t\t\t}\n\n\t\t\t\treturn frozen ? Object.freeze(result) : result;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"toObject\",\n\t\t\tvalue: function toObject(data) {\n\t\t\t\tvar frozen = arguments.length <= 1 || arguments[1] === undefined ? true : arguments[1];\n\n\t\t\t\tvar func = void 0;\n\n\t\t\t\tif (frozen) {\n\t\t\t\t\tfunc = function func(arg) {\n\t\t\t\t\t\treturn arg;\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tfunc = function func(arg) {\n\t\t\t\t\t\treturn clone(arg);\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn func(!data ? toObjekt(this) : data.reduce(function (a, b) {\n\t\t\t\t\ta[b[0]] = b[1];\n\n\t\t\t\t\treturn a;\n\t\t\t\t}, {}));\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"transform\",\n\t\t\tvalue: function transform(input, fn) {\n\t\t\t\treturn typeof fn === \"function\" ? fn(input) : cast(input);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"unload\",\n\t\t\tvalue: function unload() {\n\t\t\t\tvar _this14 = this;\n\n\t\t\t\tvar type = arguments.length <= 0 || arguments[0] === undefined ? \"mongo\" : arguments[0];\n\t\t\t\tvar key = arguments.length <= 1 || arguments[1] === undefined ? undefined : arguments[1];\n\n\t\t\t\tvar id = key !== undefined ? key : this.id;\n\n\t\t\t\treturn this.cmd(type, \"remove\", key).then(function (arg) {\n\t\t\t\t\tif (_this14.logging) {\n\t\t\t\t\t\tconsole.log(\"Unloaded\", id, \"from\", type, \"persistent storage\");\n\t\t\t\t\t}\n\n\t\t\t\t\treturn arg;\n\t\t\t\t}, function (e) {\n\t\t\t\t\tif (_this14.logging) {\n\t\t\t\t\t\tconsole.error(\"Error unloading\", id, \"from\", type, \"persistent storage:\", e.message || e.stack || e);\n\t\t\t\t\t}\n\n\t\t\t\t\tthrow e;\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"unregister\",\n\t\t\tvalue: function unregister(key) {\n\t\t\t\tdelete adapter[key];\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"values\",\n\t\t\tvalue: function values() {\n\t\t\t\treturn this.data.values();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"useWorker\",\n\t\t\tvalue: function useWorker(defer) {\n\t\t\t\tvar obj = void 0;\n\n\t\t\t\tif (this.worker) {\n\t\t\t\t\tobj = new Worker(this.worker);\n\t\t\t\t\tobj.onerror = function (err) {\n\t\t\t\t\t\tdefer.reject(err);\n\t\t\t\t\t\tobj.terminate();\n\t\t\t\t\t};\n\n\t\t\t\t\tobj.onmessage = function (ev) {\n\t\t\t\t\t\tdefer.resolve(JSON.parse(ev.data));\n\t\t\t\t\t\tobj.terminate();\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tdefer.reject(new Error(webWorkerError));\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t}\n\t\t}]);\n\n\t\treturn Haro;\n\t}();\n\n\tfunction factory() {\n\t\tvar data = arguments.length <= 0 || arguments[0] === undefined ? null : arguments[0];\n\t\tvar config = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\t\tvar indexes = arguments.length <= 2 || arguments[2] === undefined ? [] : arguments[2];\n\n\t\tvar obj = new Haro(data, config, indexes),\n\t\t    functions = void 0;\n\n\t\tif (webWorker) {\n\t\t\tfunctions = [cast.toString(), clone.toString(), createIndexes.toString(), each.toString(), iterate.toString(), joinData.toString(), keyIndex.toString(), setIndexValue.toString(), setIndex.toString(), (!server ? \"\" : \"self.\") + \"onmessage = \" + onmessage.toString() + \";\"];\n\n\t\t\ttry {\n\t\t\t\tobj.worker = !server ? global.URL.createObjectURL(blob(functions.join(\"\\n\"))) : new Function(functions.join(\"\\n\"));\n\t\t\t} catch (e) {\n\t\t\t\tobj.worker = null;\n\t\t\t}\n\t\t}\n\n\t\treturn obj;\n\t}\n\n\tfactory.transform = cast;\n\tfactory.version = \"1.9.13\";\n\n\t// Node, AMD & window supported\n\tif (typeof exports !== \"undefined\") {\n\t\tmodule.exports = factory;\n\t} else if (typeof define === \"function\" && define.amd) {\n\t\tdefine(function () {\n\t\t\treturn factory;\n\t\t});\n\t} else {\n\t\tglobal.haro = factory;\n\t}\n})(typeof window !== \"undefined\" ? window : global);\n"]}