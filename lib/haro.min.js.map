{"version":3,"sources":["haro.js"],"names":["global","has","a","b","each","arr","fn","item","entries","cast","input","result","Map","forEach","value","key","Set","Array","from","isArray","Object","keys","map","i","blob","arg","Blob","type","clone","JSON","parse","stringify","concatURI","left","right","replace","regex","querystring","endslash","keyIndex","data","delimiter","pattern","indexOf","split","sort","localeCompare","toString","RegExp","toLowerCase","join","delIndex","index","indexes","idx","get","o","delete","size","createIndexes","records","lkey","lindex","push","iterate","obj","call","merge","concat","joinData","id","on","ids","include","reverse","x","comp","c","filter","valid","length","error","errorMsg","v","k","createPatch","ogdata","overwrite","op","path","s","Math","random","substring","setIndex","indice","includes","d","set","add","lidx","toObjekt","frozen","freeze","uuid","substr","r","floor","factory","config","Haro","webWorker","worker","URL","createObjectURL","functions","Function","batch","node","process","nextTick","Promise","fetch","require","Worker","json","webWorkerError","adapter","ev","cmd","postMessage","constructor","adapters","debounce","logging","patch","source","versioning","debounced","method","credentials","headers","accept","total","uri","versions","defineProperty","enumerable","reindex","args","lazyLoad","beforeBatch","del","all","onbatch","log","e","onerror","beforeClear","beforeDelete","beforeRequest","beforeSet","beforeSync","clear","onclear","Error","apply","crawl","retry","og","exec","ondelete","storage","then","success","message","stack","clearTimeout","setTimeout","transmit","err","dump","toArray","transform","first","second","handler","find","where","raw","list","reduce","ctx","other","offload","limit","offset","max","registry","slice","load","console","resolve","reject","useWorker","payload","onrequest","onset","onsync","override","datum","accumulator","next","register","indices","request","cfg","toUpperCase","body","res","ok","status","_headers","pair","test","save","search","rgex","lset","values","setUri","sync","sortBy","deferreds","Allow","allow","toObject","unload","unregister","terminate","onmessage","predicate","version","exports","define","amd","haro","module","window"],"mappings":"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","file":"unknown","sourcesContent":["/**\r\n * Harō is a modern immutable DataStore\r\n *\r\n * @author Jason Mulligan <jason.mulligan@avoidwork.com>\r\n * @copyright 2019\r\n * @license BSD-3-Clause\r\n * @version 4.6.1\r\n */\r\n\r\n\r\n(function (global) {\r\n\tconst node = typeof process !== \"undefined\" && typeof process.nextTick === \"function\",\r\n\t\tPromise = global.Promise,\r\n\t\tMap = global.Map,\r\n\t\tSet = global.Set,\r\n\t\tfetch = global.fetch || (node ? require(\"node-fetch\") : void 0),\r\n\t\tBlob = global.Blob,\r\n\t\tWorker = global.Worker || (node ? require(\"tiny-worker\") : void 0),\r\n\t\tr = [8, 9, \"a\", \"b\"],\r\n\t\tregex = {\r\n\t\t\tquerystring: /\\?.*/,\r\n\t\t\tendslash: /\\/$/,\r\n\t\t\tjson: /^application\\/json/\r\n\t\t},\r\n\t\twebWorker = typeof Worker !== \"undefined\",\r\n\t\twebWorkerError = \"Web Worker not supported\",\r\n\t\tadapter = {};\r\n\r\n\tfunction has (a, b) {\r\n\t\treturn b in a;\r\n\t}\r\n\r\n\tfunction each (arr, fn) {\r\n\t\tfor (const item of arr.entries()) {\r\n\t\t\tfn(item[1], item[0]);\r\n\t\t}\r\n\r\n\t\treturn arr;\r\n\t}\r\n\r\n\tfunction cast (input) {\r\n\t\tlet result;\r\n\r\n\t\tswitch (true) {\r\n\t\t\tcase input instanceof Map:\r\n\t\t\t\tresult = {};\r\n\t\t\t\tinput.forEach((value, key) => {\r\n\t\t\t\t\tresult[key] = cast(value);\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase input instanceof Set:\r\n\t\t\t\tresult = Array.from(input);\r\n\t\t\t\tbreak;\r\n\t\t\tcase Array.isArray(input):\r\n\t\t\t\tresult = new Set(input);\r\n\t\t\t\tbreak;\r\n\t\t\tcase input instanceof Object:\r\n\t\t\t\tresult = new Map(Object.keys(input).map(i => [i, cast(input[i])]));\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tresult = input;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfunction blob (arg) {\r\n\t\treturn new Blob([arg], {type: \"application/javascript\"});\r\n\t}\r\n\r\n\tfunction clone (arg) {\r\n\t\treturn JSON.parse(JSON.stringify(arg, null, 0));\r\n\t}\r\n\r\n\tfunction concatURI (left, right) {\r\n\t\treturn left.replace(regex.querystring, \"\").replace(regex.endslash, \"\") + (right ? \"/\" + right : \"\");\r\n\t}\r\n\r\n\tfunction keyIndex (key, data, delimiter, pattern) {\r\n\t\tlet result;\r\n\r\n\t\tif (key.indexOf(delimiter) > -1) {\r\n\t\t\tresult = key.split(delimiter).sort((a, b) => a.localeCompare(b)).map(i => data[i].toString().replace(new RegExp(pattern, \"g\"), \"\").toLowerCase()).join(delimiter);\r\n\t\t} else {\r\n\t\t\tresult = data[key];\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfunction delIndex (index, indexes, delimiter, key, data, pattern) {\r\n\t\tindex.forEach(i => {\r\n\t\t\tconst idx = indexes.get(i),\r\n\t\t\t\tvalue = keyIndex(i, data, delimiter, pattern);\r\n\r\n\t\t\tif (idx.has(value)) {\r\n\t\t\t\tconst o = idx.get(value);\r\n\r\n\t\t\t\to.delete(key);\r\n\r\n\t\t\t\tif (o.size === 0) {\r\n\t\t\t\t\tidx.delete(value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction createIndexes (records, indexes, key, delimiter, pattern) {\r\n\t\tconst result = {};\r\n\r\n\t\teach(indexes, i => {\r\n\t\t\tresult[i] = {};\r\n\t\t});\r\n\r\n\t\teach(records, i => {\r\n\t\t\tconst lkey = i[key];\r\n\r\n\t\t\tif (lkey !== void 0) {\r\n\t\t\t\tindexes.forEach(index => {\r\n\t\t\t\t\tconst lindex = keyIndex(index, i, delimiter, pattern);\r\n\r\n\t\t\t\t\tif (!has(result[index], lindex)) {\r\n\t\t\t\t\t\tresult[index][lindex] = [];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tresult[index][lindex].push(lkey);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfunction iterate (obj, fn) {\r\n\t\tif (obj instanceof Object) {\r\n\t\t\teach(Object.keys(obj), i => fn.call(obj, obj[i], i));\r\n\t\t} else {\r\n\t\t\teach(obj, fn);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction merge (a, b) {\r\n\t\tif (a instanceof Object && b instanceof Object) {\r\n\t\t\teach(Object.keys(b), i => {\r\n\t\t\t\tif (a[i] instanceof Object && b[i] instanceof Object) {\r\n\t\t\t\t\ta[i] = merge(a[i], b[i]);\r\n\t\t\t\t} else if (Array.isArray(a[i]) && Array.isArray(b[i])) {\r\n\t\t\t\t\ta[i] = a[i].concat(b[i]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ta[i] = b[i];\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else if (Array.isArray(a) && Array.isArray(b)) {\r\n\t\t\ta = a.concat(b);\r\n\t\t} else {\r\n\t\t\ta = b;\r\n\t\t}\r\n\r\n\t\treturn a;\r\n\t}\r\n\r\n\tfunction joinData (id, a, b, key, on, type = \"inner\") {\r\n\t\tconst result = [];\r\n\t\tlet errorMsg = \"More than one record found on \";\r\n\r\n\t\tlet error = false;\r\n\r\n\t\tfunction join (left, right, ids, include = false, reverse = false) {\r\n\t\t\tconst keys = Object.keys(right[0]),\r\n\t\t\t\tfn = !reverse ? (x, i) => x[on] === i[key] : (x, i) => x[key] === i[on];\r\n\r\n\t\t\teach(left, i => {\r\n\t\t\t\tconst comp = {},\r\n\t\t\t\t\tc = right.filter(x => fn(x, i));\r\n\r\n\t\t\t\tlet valid = true;\r\n\r\n\t\t\t\tif (c.length > 1) {\r\n\t\t\t\t\terror = true;\r\n\t\t\t\t\terrorMsg += i[on];\r\n\t\t\t\t\tvalid = false;\r\n\t\t\t\t} else if (c.length === 1) {\r\n\t\t\t\t\teach([i, c[0]], (x, idx) => iterate(x, (v, k) => {\r\n\t\t\t\t\t\tcomp[ids[idx] + \"_\" + k] = v;\r\n\t\t\t\t\t}));\r\n\t\t\t\t} else if (include) {\r\n\t\t\t\t\titerate(i, (v, k) => {\r\n\t\t\t\t\t\tcomp[ids[0] + \"_\" + k] = v;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\teach(keys, k => {\r\n\t\t\t\t\t\tcomp[ids[1] + \"_\" + k] = null;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (valid && Object.keys(comp).length > 0) {\r\n\t\t\t\t\tresult.push(comp);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn valid;\r\n\t\t\t}, true);\r\n\t\t}\r\n\r\n\t\tif (type === \"inner\") {\r\n\t\t\tjoin(a, b, id);\r\n\t\t}\r\n\r\n\t\tif (type === \"left\") {\r\n\t\t\tjoin(a, b, id, true);\r\n\t\t}\r\n\r\n\t\tif (type === \"right\") {\r\n\t\t\tjoin(b, a, clone(id).reverse(), true, true);\r\n\t\t}\r\n\r\n\t\treturn !error ? result : errorMsg;\r\n\t}\r\n\r\n\tfunction onmessage (ev) {\r\n\t\tconst data = JSON.parse(ev.data),\r\n\t\t\tcmd = data.cmd;\r\n\r\n\t\tlet result;\r\n\r\n\t\tif (cmd === \"index\") {\r\n\t\t\tresult = createIndexes(data.records, data.index, data.key, data.delimiter, data.pattern);\r\n\t\t}\r\n\r\n\t\tif (cmd === \"join\") {\r\n\t\t\tresult = joinData(data.ids, data.records[0], data.records[1], data.key, data.on, data.type);\r\n\t\t}\r\n\r\n\t\tpostMessage(JSON.stringify(result));\r\n\t}\r\n\r\n\tfunction createPatch (ogdata = {}, data = {}, key = \"\", overwrite = false) {\r\n\t\tconst result = [];\r\n\r\n\t\tif (overwrite) {\r\n\t\t\titerate(ogdata, (v, k) => {\r\n\t\t\t\tif (k !== key && data[k] === void 0) {\r\n\t\t\t\t\tresult.push({op: \"remove\", path: \"/\" + k});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\titerate(data, (v, k) => {\r\n\t\t\tif (k !== key && ogdata[k] === void 0) {\r\n\t\t\t\tresult.push({op: \"add\", path: \"/\" + k, value: v});\r\n\t\t\t} else if (JSON.stringify(ogdata[k]) !== JSON.stringify(v)) {\r\n\t\t\t\tresult.push({op: \"replace\", path: \"/\" + k, value: v});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfunction s () {\r\n\t\treturn ((Math.random() + 1) * 0x10000 | 0).toString(16).substring(1);\r\n\t}\r\n\r\n\tfunction setIndex (index, indexes, delimiter, key, data, indice, pattern) {\r\n\t\teach(!indice ? index : [indice], i => {\r\n\t\t\tconst lindex = indexes.get(i);\r\n\r\n\t\t\tif (Array.isArray(data[i]) && !i.includes(delimiter)) {\r\n\t\t\t\teach(data[i], d => {\r\n\t\t\t\t\tif (!lindex.has(d)) {\r\n\t\t\t\t\t\tlindex.set(d, new Set());\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlindex.get(d).add(key);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tconst lidx = keyIndex(i, data, delimiter, pattern);\r\n\r\n\t\t\t\tif (lidx !== void 0 && lidx !== null) {\r\n\t\t\t\t\tif (!lindex.has(lidx)) {\r\n\t\t\t\t\t\tlindex.set(lidx, new Set());\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlindex.get(lidx).add(key);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction toObjekt (arg, frozen = true) {\r\n\t\tconst result = {};\r\n\r\n\t\targ.forEach((value, key) => {\r\n\t\t\tconst obj = value;\r\n\r\n\t\t\tif (frozen) {\r\n\t\t\t\tObject.freeze(obj);\r\n\t\t\t}\r\n\r\n\t\t\tresult[clone(key)] = obj;\r\n\t\t});\r\n\r\n\t\tif (frozen) {\r\n\t\t\tObject.freeze(result);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfunction uuid () {\r\n\t\treturn s() + s() + \"-\" + s() + \"-4\" + s().substr(0, 3) + \"-\" + r[Math.floor(Math.random() * 4)] + s().substr(0, 3) + \"-\" + s() + s() + s();\r\n\t}\r\n\r\n\tconst functions = [\r\n\t\tcast.toString(),\r\n\t\tclone.toString(),\r\n\t\tcreateIndexes.toString(),\r\n\t\teach.toString(),\r\n\t\thas.toString(),\r\n\t\titerate.toString(),\r\n\t\tjoinData.toString(),\r\n\t\tkeyIndex.toString(),\r\n\t\tsetIndex.toString(),\r\n\t\t(node === false ? \"\" : \"self.\") + \"onmessage = \" + onmessage.toString() + \";\"\r\n\t].join(\"\\n\");\r\n\r\n\tclass Haro {\r\n\t\tconstructor ({adapters = {}, config = {}, debounce = 0, delimiter = \"|\", id = uuid(), index = [], key = \"\", logging = true, patch = false, pattern = \"\\\\s*|\\\\t*\", source = \"\", versioning = false} = {}) {\r\n\t\t\tthis.adapters = adapters;\r\n\t\t\tthis.data = new Map();\r\n\t\t\tthis.debounce = debounce;\r\n\t\t\tthis.debounced = new Map();\r\n\t\t\tthis.delimiter = delimiter;\r\n\t\t\tthis.config = {\r\n\t\t\t\tmethod: \"get\",\r\n\t\t\t\tcredentials: \"include\",\r\n\t\t\t\theaders: {\r\n\t\t\t\t\taccept: \"application/json\",\r\n\t\t\t\t\t\"content-type\": \"application/json\"\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tthis.id = id;\r\n\t\t\tthis.index = index;\r\n\t\t\tthis.indexes = new Map();\r\n\t\t\tthis.key = key;\r\n\t\t\tthis.logging = logging;\r\n\t\t\tthis.patch = patch;\r\n\t\t\tthis.pattern = pattern;\r\n\t\t\tthis.source = source;\r\n\t\t\tthis.size = this.total = 0;\r\n\t\t\tthis.uri = \"\";\r\n\t\t\tthis.worker = null;\r\n\t\t\tthis.versions = new Map();\r\n\t\t\tthis.versioning = versioning;\r\n\r\n\t\t\tObject.defineProperty(this, \"registry\", {\r\n\t\t\t\tenumerable: true,\r\n\t\t\t\tget: () => Array.from(this.data.keys())\r\n\t\t\t});\r\n\r\n\t\t\tif (Object.keys(config).length > 1) {\r\n\t\t\t\tthis.config = merge(this.config, config);\r\n\t\t\t}\r\n\r\n\t\t\treturn this.reindex();\r\n\t\t}\r\n\r\n\t\tasync batch (args, type = \"set\", lazyLoad = false) {\r\n\t\t\tlet result;\r\n\r\n\t\t\tthis.beforeBatch(args, type);\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst fn = type === \"del\" ? i => this.del(i, true, lazyLoad) : i => this.set(null, i, true, true, lazyLoad);\r\n\r\n\t\t\t\tresult = await Promise.all(args.map(fn));\r\n\t\t\t\tthis.onbatch(type, result);\r\n\t\t\t\tthis.log(`Batch successful on ${this.id}`);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tthis.onerror(\"batch\", e);\r\n\t\t\t\tthis.log(`Batch failure on ${this.id}`);\r\n\t\t\t\tthrow e;\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tbeforeBatch () {}\r\n\r\n\t\tbeforeClear () {}\r\n\r\n\t\tbeforeDelete () {}\r\n\r\n\t\tbeforeRequest () {}\r\n\r\n\t\tbeforeSet () {}\r\n\r\n\t\tbeforeSync () {}\r\n\r\n\t\tclear () {\r\n\t\t\tthis.beforeClear();\r\n\t\t\tthis.size = this.total = 0;\r\n\t\t\tthis.data.clear();\r\n\t\t\tthis.indexes.clear();\r\n\t\t\tthis.versions.clear();\r\n\t\t\tthis.reindex().onclear();\r\n\t\t\tthis.log(`Cleared ${this.id}`);\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tasync cmd (type, ...args) {\r\n\t\t\tif (this.adapters[type] === void 0 || adapter[type] === void 0) {\r\n\t\t\t\tthrow new Error(`${type} not configured for persistent storage`);\r\n\t\t\t}\r\n\r\n\t\t\treturn await adapter[type].apply(this, [this, ...args]);\r\n\t\t}\r\n\r\n\t\tcrawl (arg) {\r\n\t\t\tlet result = clone(arg);\r\n\r\n\t\t\teach((this.source || \"\").split(\".\"), i => {\r\n\t\t\t\tresult = result[i];\r\n\t\t\t});\r\n\r\n\t\t\treturn result || arg;\r\n\t\t}\r\n\r\n\t\tdel (key, batch = false, lazyLoad = false, retry = false) {\r\n\t\t\tif (this.has(key) === false) {\r\n\t\t\t\tthrow new Error(\"Record not found\");\r\n\t\t\t}\r\n\r\n\t\t\tconst og = this.get(key, true);\r\n\r\n\t\t\treturn this.exec(async () => {\r\n\t\t\t\tthis.beforeDelete(key, batch, lazyLoad, retry);\r\n\t\t\t\tdelIndex(this.index, this.indexes, this.delimiter, key, og, this.pattern);\r\n\t\t\t\tthis.data.delete(key);\r\n\t\t\t\t--this.total;\r\n\t\t\t\tthis.size = this.total;\r\n\t\t\t}, async () => {\r\n\t\t\t\tthis.ondelete(key, batch, retry, lazyLoad);\r\n\r\n\t\t\t\tif (this.versioning) {\r\n\t\t\t\t\tthis.versions.delete(key);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!lazyLoad) {\r\n\t\t\t\t\tthis.storage(\"remove\", key).then(success => {\r\n\t\t\t\t\t\tif (success) {\r\n\t\t\t\t\t\t\tthis.log(`Deleted ${key} from persistent storage`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, e => this.log(`Error deleting ${key} from persistent storage: ${e.message || e.stack || e}`, \"error\"));\r\n\r\n\t\t\t\t\tif (!batch && !retry && this.uri) {\r\n\t\t\t\t\t\tif (this.debounced.has(key)) {\r\n\t\t\t\t\t\t\tclearTimeout(this.debounced.get(key));\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tthis.debounced.set(key, setTimeout(async () => {\r\n\t\t\t\t\t\t\tthis.debounced.delete(key);\r\n\r\n\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\tawait this.transmit(key, null, og, false, \"delete\");\r\n\t\t\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\t\t\tthis.log(err.stack || err.message || err, \"error\");\r\n\r\n\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\tawait this.set(key, og, true, true);\r\n\t\t\t\t\t\t\t\t\tthis.log(`Reverted ${key}`);\r\n\t\t\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\t\t\tthis.log(`Failed to revert ${key}`);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}, this.debounce));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, err => {\r\n\t\t\t\tthis.onerror(\"delete\", err);\r\n\t\t\t\tthrow err;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tdump (type = \"records\") {\r\n\t\t\treturn type === \"records\" ? this.toArray(null, false) : this.transform(this.indexes);\r\n\t\t}\r\n\r\n\t\tentries () {\r\n\t\t\treturn this.data.entries();\r\n\t\t}\r\n\r\n\t\tasync exec (first, second, handler) {\r\n\t\t\tlet result;\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst arg = await first();\r\n\t\t\t\tresult = await second(arg);\r\n\t\t\t} catch (err) {\r\n\t\t\t\thandler(err);\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tfind (where, raw = false) {\r\n\t\t\tconst key = Object.keys(where).sort((a, b) => a.localeCompare(b)).join(this.delimiter),\r\n\t\t\t\tvalue = keyIndex(key, where, this.delimiter, this.pattern),\r\n\t\t\t\tresult = [];\r\n\r\n\t\t\tif (this.indexes.has(key)) {\r\n\t\t\t\t(this.indexes.get(key).get(value) || new Set()).forEach(i => result.push(this.get(i, raw)));\r\n\t\t\t}\r\n\r\n\t\t\treturn raw ? result : this.list(...result);\r\n\t\t}\r\n\r\n\t\tfilter (fn, raw = false) {\r\n\t\t\tconst result = this.reduce((a, v, k, ctx) => {\r\n\t\t\t\tif (fn.call(ctx, v) === true) {\r\n\t\t\t\t\ta.push(this.get(k, raw));\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn a;\r\n\t\t\t}, []);\r\n\r\n\t\t\treturn raw ? result : this.list(...result);\r\n\t\t}\r\n\r\n\t\tforEach (fn, ctx) {\r\n\t\t\tthis.data.forEach((value, key) => fn(clone(value), clone(key)), ctx || this.data);\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tget (key, raw = false) {\r\n\t\t\tconst result = clone(this.data.get(key) || null);\r\n\r\n\t\t\treturn result && !raw ? this.list(key, result) : result;\r\n\t\t}\r\n\r\n\t\thas (key, map) {\r\n\t\t\treturn (map || this.data).has(key);\r\n\t\t}\r\n\r\n\t\tasync join (other, on, type = \"inner\", where = []) {\r\n\t\t\tlet result;\r\n\r\n\t\t\tif (other.total > 0) {\r\n\t\t\t\tif (where.length > 0) {\r\n\t\t\t\t\tresult = await this.offload([[this.id, other.id], this.find(where[0], true), !where[1] ? other.toArray(null, true) : other.find(where[1], true), this.key, on || this.key, type], \"join\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult = await this.offload([[this.id, other.id], this.toArray(null, true), other.toArray(null, true), this.key, on || this.key, type], \"join\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (typeof arg === \"string\") {\r\n\t\t\t\t\tthrow new Error(result);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tresult = [];\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tkeys () {\r\n\t\t\treturn this.data.keys();\r\n\t\t}\r\n\r\n\t\tlimit (offset = 0, max = 0, raw = false) {\r\n\t\t\tconst result = this.registry.slice(offset, offset + max).map(i => this.get(i, raw));\r\n\r\n\t\t\treturn raw ? result : this.list(...result);\r\n\t\t}\r\n\r\n\t\tlist (...args) {\r\n\t\t\treturn Object.freeze(args.map(i => Object.freeze(i)));\r\n\t\t}\r\n\r\n\t\tasync load (type = \"mongo\", key = void 0) {\r\n\t\t\tconst batch = key === void 0,\r\n\t\t\t\tid = !batch ? key : this.id;\r\n\t\t\tlet result;\r\n\r\n\t\t\tif (batch) {\r\n\t\t\t\tthis.clear();\r\n\t\t\t}\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst data = await this.cmd(type, \"get\", key);\r\n\r\n\t\t\t\tresult = batch ? this.batch(data, \"set\", true) : this.set(key, data, true, true, true);\r\n\t\t\t\tthis.log(`Loaded ${id} from ${type} persistent storage`);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tthis.log(`Error loading ${id} from ${type} persistent storage: ${e.message || e.stack || e}`, \"error\");\r\n\t\t\t\tthrow e;\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tlog (arg = \"\", type = \"log\") {\r\n\t\t\tif (this.logging) {\r\n\t\t\t\tconsole[type](`haro: ${arg}`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tmap (fn, raw = false) {\r\n\t\t\tconst result = [];\r\n\r\n\t\t\tthis.forEach((value, key) => result.push(fn(value, key)));\r\n\r\n\t\t\treturn raw ? result : this.list(...result);\r\n\t\t}\r\n\r\n\t\tasync offload (data, cmd = \"index\", index = this.index) {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tif (this.worker) {\r\n\t\t\t\t\tconst obj = this.useWorker(resolve, reject);\r\n\t\t\t\t\tlet payload;\r\n\r\n\t\t\t\t\tif (cmd === \"index\") {\r\n\t\t\t\t\t\tpayload = {\r\n\t\t\t\t\t\t\tcmd: cmd,\r\n\t\t\t\t\t\t\tindex: index,\r\n\t\t\t\t\t\t\trecords: data,\r\n\t\t\t\t\t\t\tkey: this.key,\r\n\t\t\t\t\t\t\tdelimiter: this.delimiter,\r\n\t\t\t\t\t\t\tpattern: this.pattern\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t} else if (cmd === \"join\") {\r\n\t\t\t\t\t\tpayload = {\r\n\t\t\t\t\t\t\tcmd: cmd,\r\n\t\t\t\t\t\t\tids: data[0],\r\n\t\t\t\t\t\t\trecords: [data[1], data[2]],\r\n\t\t\t\t\t\t\tkey: data[3],\r\n\t\t\t\t\t\t\ton: data[4],\r\n\t\t\t\t\t\t\ttype: data[5]\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tobj.postMessage(JSON.stringify(payload, null, 0));\r\n\t\t\t\t} else {\r\n\t\t\t\t\treject(new Error(webWorkerError));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tonbatch () {}\r\n\r\n\t\tonclear () {}\r\n\r\n\t\tondelete () {}\r\n\r\n\t\tonerror () {}\r\n\r\n\t\tonrequest (arg) {\r\n\t\t\treturn arg;\r\n\t\t}\r\n\r\n\t\tonset () {}\r\n\r\n\t\tonsync () {}\r\n\r\n\t\tasync override (data, type = \"records\", fn = void 0) {\r\n\t\t\tconst result = true;\r\n\r\n\t\t\tif (type === \"indexes\") {\r\n\t\t\t\tthis.indexes = this.transform(data, fn);\r\n\t\t\t} else if (type === \"records\") {\r\n\t\t\t\tconst key = this.key !== \"\" ? arg => arg[this.key] || uuid() : () => uuid();\r\n\t\t\t\tthis.indexes.clear();\r\n\t\t\t\tthis.data = new Map(data.map(datum => [key(datum), datum]));\r\n\t\t\t\tthis.size = this.total = this.data.size;\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(\"Invalid type\");\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\treduce (fn, accumulator, raw = false) {\r\n\t\t\tlet a = accumulator || this.data.keys().next().value;\r\n\r\n\t\t\tthis.forEach((v, k) => {\r\n\t\t\t\ta = fn(a, v, k, this, raw);\r\n\t\t\t}, this);\r\n\r\n\t\t\treturn a;\r\n\t\t}\r\n\r\n\t\tregister (key, fn) {\r\n\t\t\tadapter[key] = fn;\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\treindex (index) {\r\n\t\t\tconst indices = index ? [index] : this.index;\r\n\r\n\t\t\tif (index && this.index.includes(index) === false) {\r\n\t\t\t\tthis.index.push(index);\r\n\t\t\t}\r\n\r\n\t\t\teach(indices, i => this.indexes.set(i, new Map()));\r\n\t\t\tthis.forEach((data, key) => each(indices, i => setIndex(this.index, this.indexes, this.delimiter, key, data, i, this.pattern)));\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tasync request (input, config = {}) {\r\n\t\t\treturn new Promise(async (resolve, reject) => {\r\n\t\t\t\tconst cfg = merge(clone(this.config), config),\r\n\t\t\t\t\tref = [input, cfg],\r\n\t\t\t\t\theaders = {};\r\n\r\n\t\t\t\tcfg.method = cfg.method.toUpperCase();\r\n\r\n\t\t\t\tif (cfg.method === \"DELETE\") {\r\n\t\t\t\t\tdelete cfg.body;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.beforeRequest(...ref);\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst res = await fetch(input, cfg),\r\n\t\t\t\t\t\tok = res.ok,\r\n\t\t\t\t\t\tstatus = res.status;\r\n\r\n\t\t\t\t\tif (res.headers._headers) {\r\n\t\t\t\t\t\teach(Object.keys(res.headers._headers), i => {\r\n\t\t\t\t\t\t\theaders[i] = res.headers._headers[i].join(\", \");\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfor (const pair of res.headers.entries()) {\r\n\t\t\t\t\t\t\theaders[pair[0]] = pair[1];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst arg = await res[regex.json.test(headers[\"content-type\"] || \"\") ? \"json\" : \"text\"](),\r\n\t\t\t\t\t\tnext = ok ? resolve : reject;\r\n\r\n\t\t\t\t\tnext(this.list(this.onrequest(arg, status, headers), status, headers));\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\treject(this.list(e.message, 0, {}));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tasync save (type = \"mongo\") {\r\n\t\t\tlet result;\r\n\r\n\t\t\ttry {\r\n\t\t\t\tresult = await this.cmd(type, \"set\");\r\n\t\t\t\tthis.log(`Saved ${this.id} to ${type} persistent storage`);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tthis.log(`Error saving ${this.id} to ${type} persistent storage: ${e.message || e.stack || e}`, \"error\");\r\n\t\t\t\tthrow e;\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tsearch (value, index, raw = false) {\r\n\t\t\tconst result = new Map(),\r\n\t\t\t\tfn = typeof value === \"function\",\r\n\t\t\t\trgex = value && typeof value.test === \"function\";\r\n\r\n\t\t\tif (value) {\r\n\t\t\t\teach(index ? Array.isArray(index) ? index : [index] : this.index, i => {\r\n\t\t\t\t\tlet idx = this.indexes.get(i);\r\n\r\n\t\t\t\t\tif (idx) {\r\n\t\t\t\t\t\tidx.forEach((lset, lkey) => {\r\n\t\t\t\t\t\t\tswitch (true) {\r\n\t\t\t\t\t\t\t\tcase fn && value(lkey, i):\r\n\t\t\t\t\t\t\t\tcase rgex && value.test(Array.isArray(lkey) ? lkey.join(\", \") : lkey):\r\n\t\t\t\t\t\t\t\tcase lkey === value:\r\n\t\t\t\t\t\t\t\t\tlset.forEach(key => {\r\n\t\t\t\t\t\t\t\t\t\tif (!result.has(key) && this.has(key)) {\r\n\t\t\t\t\t\t\t\t\t\t\tresult.set(key, this.get(key, raw));\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\tvoid 0;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn raw ? Array.from(result.values()) : this.list(...Array.from(result.values()));\r\n\t\t}\r\n\r\n\t\tasync set (key, data, batch = false, override = false, lazyLoad = false, retry = false) {\r\n\t\t\tlet x = clone(data),\r\n\t\t\t\tmethod, og;\r\n\r\n\t\t\treturn this.exec(async () => {\r\n\t\t\t\tif (key === void 0 || key === null) {\r\n\t\t\t\t\tkey = this.key && x[this.key] !== void 0 ? x[this.key] : uuid();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.beforeSet(key, data, batch, override, lazyLoad, retry);\r\n\r\n\t\t\t\tif (!this.data.has(key)) {\r\n\t\t\t\t\t++this.total;\r\n\t\t\t\t\tthis.size = this.total;\r\n\t\t\t\t\tmethod = \"post\";\r\n\r\n\t\t\t\t\tif (this.versioning) {\r\n\t\t\t\t\t\tthis.versions.set(key, new Set());\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tog = this.get(key, true);\r\n\t\t\t\t\tdelIndex(this.index, this.indexes, this.delimiter, key, og, this.pattern);\r\n\t\t\t\t\tmethod = \"put\";\r\n\r\n\t\t\t\t\tif (this.versioning) {\r\n\t\t\t\t\t\tthis.versions.get(key).add(Object.freeze(clone(og)));\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (override === false) {\r\n\t\t\t\t\t\tx = merge(clone(og), x);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.data.set(key, x);\r\n\t\t\t\tsetIndex(this.index, this.indexes, this.delimiter, key, x, null, this.pattern);\r\n\r\n\t\t\t\treturn this.get(key);\r\n\t\t\t}, async arg => {\r\n\t\t\t\tthis.onset(arg, batch, retry, lazyLoad);\r\n\r\n\t\t\t\tif (!lazyLoad) {\r\n\t\t\t\t\tthis.storage(\"set\", key, x).then(success => {\r\n\t\t\t\t\t\tif (success) {\r\n\t\t\t\t\t\t\tthis.log(`Saved ${key} to persistent storage`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, e => this.log(`Error saving ${key} to persistent storage: ${e.message || e.stack || e}`, \"error\"));\r\n\r\n\t\t\t\t\tif (!batch && !retry && this.uri) {\r\n\t\t\t\t\t\tif (this.debounced.has(key)) {\r\n\t\t\t\t\t\t\tclearTimeout(this.debounced.get(key));\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tthis.debounced.set(key, setTimeout(async () => {\r\n\t\t\t\t\t\t\tthis.debounced.delete(key);\r\n\r\n\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\tawait this.transmit(key, x, og, override, method);\r\n\r\n\t\t\t\t\t\t\t\tif (og) {\r\n\t\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\t\tawait this.set(key, og, batch, true, lazyLoad, true);\r\n\t\t\t\t\t\t\t\t\t\tthis.log(`Reverted ${key}`);\r\n\t\t\t\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\t\t\t\tthis.log(`Failed to revert ${key}`);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\t\tawait this.del(key, true);\r\n\t\t\t\t\t\t\t\t\t\tthis.log(`Reverted ${key}`);\r\n\t\t\t\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\t\t\t\tthis.log(`Failed to revert ${key}`);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\t\tthis.log(e.stack || e.message || e, \"error\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}, this.debounce));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn arg;\r\n\t\t\t}, err => {\r\n\t\t\t\tthis.onerror(\"set\", err);\r\n\t\t\t\tthrow err;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tasync setUri (uri, clear = false) {\r\n\t\t\tthis.uri = uri;\r\n\r\n\t\t\treturn this.uri !== \"\" ? await this.sync(clear) : [];\r\n\t\t}\r\n\r\n\t\tsort (fn, frozen = true) {\r\n\t\t\treturn frozen ? Object.freeze(this.limit(0, this.total, true).sort(fn).map(i => Object.freeze(i))) : this.limit(0, this.total, true).sort(fn);\r\n\t\t}\r\n\r\n\t\tsortBy (index, raw = false) {\r\n\t\t\tconst result = [],\r\n\t\t\t\tkeys = [];\r\n\r\n\t\t\tlet lindex;\r\n\r\n\t\t\tif (!this.indexes.has(index)) {\r\n\t\t\t\tthis.reindex(index);\r\n\t\t\t}\r\n\r\n\t\t\tlindex = this.indexes.get(index);\r\n\t\t\tlindex.forEach((idx, key) => keys.push(key));\r\n\t\t\teach(keys.sort(), i => lindex.get(i).forEach(key => result.push(this.get(key, raw))));\r\n\r\n\t\t\treturn raw ? result : this.list(...result);\r\n\t\t}\r\n\r\n\t\tasync storage (...args) {\r\n\t\t\tlet result;\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst deferreds = Object.keys(this.adapters).map(async i => await this.cmd.apply(this, [i, ...args]));\r\n\r\n\t\t\t\tif (deferreds.length > 0) {\r\n\t\t\t\t\tawait Promise.all(deferreds);\r\n\t\t\t\t\tresult = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult = false;\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tthis.log(e.stack || e.message || e, \"error\");\r\n\t\t\t\tthrow e;\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tasync sync (clear = false) {\r\n\t\t\tlet result;\r\n\r\n\t\t\tthis.beforeSync(this.uri, clear);\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst arg = await this.request(this.uri),\r\n\t\t\t\t\tdata = this.source ? this.crawl(arg[0]) : arg[0];\r\n\r\n\t\t\t\tthis.patch = (arg[2].Allow || arg[2].allow || \"\").includes(\"PATCH\");\r\n\r\n\t\t\t\tif (clear) {\r\n\t\t\t\t\tthis.clear();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tresult = await this.batch(data, \"set\");\r\n\t\t\t\tthis.onsync(result);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tthis.onerror(\"sync\", e[0] || e);\r\n\t\t\t\tthrow e[0] || e;\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\ttoArray (data, frozen = true) {\r\n\t\t\tlet result;\r\n\r\n\t\t\tif (data) {\r\n\t\t\t\tresult = data.map(i => frozen ? i[1] : clone(i[1]));\r\n\t\t\t} else {\r\n\t\t\t\tresult = this.limit(0, this.total, true);\r\n\r\n\t\t\t\tif (frozen) {\r\n\t\t\t\t\teach(result, i => Object.freeze(i));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn frozen ? Object.freeze(result) : result;\r\n\t\t}\r\n\r\n\t\ttoObject (data, frozen = true) {\r\n\t\t\tconst result = !data ? toObjekt(this, frozen) : data.reduce((a, b) => {\r\n\t\t\t\tconst obj = clone(b[1]);\r\n\r\n\t\t\t\tif (frozen) {\r\n\t\t\t\t\tObject.freeze(obj);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ta[b[0]] = obj;\r\n\r\n\t\t\t\treturn a;\r\n\t\t\t}, {});\r\n\r\n\t\t\treturn frozen ? Object.freeze(result) : result;\r\n\t\t}\r\n\r\n\t\ttransform (input, fn) {\r\n\t\t\treturn typeof fn === \"function\" ? fn(input) : cast(input);\r\n\t\t}\r\n\r\n\t\tasync transmit (key, data, og, override = false, method = \"post\") {\r\n\t\t\tconst uri = concatURI(this.uri, data ? key : null);\r\n\r\n\t\t\tlet body, result;\r\n\r\n\t\t\tif (this.patch) {\r\n\t\t\t\tif (data === void 0) {\r\n\t\t\t\t\tbody = [{op: \"remove\", path: \"/\", value: key}];\r\n\t\t\t\t} else if (og === void 0) {\r\n\t\t\t\t\tbody = [{op: \"add\", path: \"/\", value: data}];\r\n\t\t\t\t} else if (override) {\r\n\t\t\t\t\tbody = [{op: \"replace\", path: \"/\", value: data}];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbody = createPatch(og, data, this.key);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tresult = await this.request(uri, {method: \"patch\", headers: {\"content-type\": \"application/json-patch+json\"}, body: JSON.stringify(body, null, 0)});\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tif (e[1] === 405) {\r\n\t\t\t\t\t\tthis.patch = false;\r\n\t\t\t\t\t\tresult = await this.request(!data ? concatURI(this.uri, key) : uri, {\r\n\t\t\t\t\t\t\tmethod: method,\r\n\t\t\t\t\t\t\theaders: {\"content-type\": \"application/json\"},\r\n\t\t\t\t\t\t\tbody: JSON.stringify(data, null, 0)\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow e;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tresult = await this.request(uri, {method: method, headers: {\"content-type\": \"application/json\"}, body: JSON.stringify(data, null, 0)});\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tasync unload (type = \"mongo\", key = void 0) {\r\n\t\t\tconst id = key !== void 0 ? key : this.id;\r\n\t\t\tlet result;\r\n\r\n\t\t\ttry {\r\n\t\t\t\tresult = await this.cmd(type, \"remove\", key);\r\n\t\t\t\tthis.log(`Unloaded ${id} from ${type} persistent storage`);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tthis.log(`Error unloading ${id} from ${type} persistent storage: ${e.message || e.stack || e}`, \"error\");\r\n\t\t\t\tthrow e;\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tunregister (key) {\r\n\t\t\tdelete adapter[key];\r\n\t\t}\r\n\r\n\t\tvalues () {\r\n\t\t\treturn this.data.values();\r\n\t\t}\r\n\r\n\t\tuseWorker (resolve, reject) {\r\n\t\t\tlet obj;\r\n\r\n\t\t\tif (this.worker) {\r\n\t\t\t\tobj = new Worker(this.worker);\r\n\r\n\t\t\t\tobj.onerror = err => {\r\n\t\t\t\t\treject(err);\r\n\t\t\t\t\tobj.terminate();\r\n\t\t\t\t};\r\n\r\n\t\t\t\tobj.onmessage = ev => {\r\n\t\t\t\t\tresolve(JSON.parse(ev.data));\r\n\t\t\t\t\tobj.terminate();\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\treject(new Error(webWorkerError));\r\n\t\t\t}\r\n\r\n\t\t\treturn obj;\r\n\t\t}\r\n\r\n\t\twhere (predicate, raw = false) {\r\n\t\t\tconst keys = this.index.filter(i => i in predicate);\r\n\r\n\t\t\treturn keys.length > 0 ? this.filter(new Function(\"a\", `return (${keys.map(i => {\r\n\t\t\t\tlet result;\r\n\r\n\t\t\t\tif (Array.isArray(predicate[i])) {\r\n\t\t\t\t\tresult = `Array.isArray(a['${i}']) ? ${predicate[i].map(arg => `a['${i}'].includes(${typeof arg === \"string\" ? `'${arg}'` : arg})`).join(\" || \")} : a['${i}'] === '${predicate[i].join(\",\")}'`;\r\n\t\t\t\t} else if (predicate[i] instanceof RegExp) {\r\n\t\t\t\t\tresult = `Array.isArray(a['${i}']) ? a['${i}'].filter(i => ${predicate[i]}.test(a['${i}']) === true).length > 0 : ${predicate[i]}.test(a['${i}']) === true`;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst arg = typeof predicate[i] === \"string\" ? `'${predicate[i]}'` : predicate[i];\r\n\r\n\t\t\t\t\tresult = `Array.isArray(a['${i}']) ? a['${i}'].includes(${arg}) : a['${i}'] === ${arg}`;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn result;\r\n\t\t\t}).join(\") && (\")});`), raw) : [];\r\n\t\t}\r\n\t}\r\n\r\n\tfunction factory (data = null, config = {}) {\r\n\t\tconst obj = new Haro(config);\r\n\r\n\t\tif (webWorker) {\r\n\t\t\tobj.worker = node === false ? global.URL.createObjectURL(blob(functions)) : new Function(functions);\r\n\t\t}\r\n\r\n\t\tif (Array.isArray(data)) {\r\n\t\t\tobj.batch(data, \"set\");\r\n\t\t}\r\n\r\n\t\treturn obj;\r\n\t}\r\n\r\n\tfactory.transform = cast;\r\n\tfactory.version = \"4.6.1\";\r\n\r\n\t// Node, AMD & window supported\r\n\tif (typeof exports !== \"undefined\") {\r\n\t\tmodule.exports = factory;\r\n\t} else if (typeof define === \"function\" && define.amd !== void 0) {\r\n\t\tdefine(() => factory);\r\n\t} else {\r\n\t\tglobal.haro = factory;\r\n\t}\r\n}(typeof window !== \"undefined\" ? window : global));\r\n"]}