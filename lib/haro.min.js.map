{"version":3,"sources":["haro.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","global","cast","input","result","Map","forEach","value","Set","push","Array","isArray","add","keys","set","blob","arg","obj","Blob","type","e","BlobBuilder","MSBlobBuilder","WebKitBlobBuilder","MozBlobBuilder","append","getBlob","clone","JSON","parse","stringify","concatURI","left","right","replace","regex","querystring","endslash","keyIndex","data","delimiter","pattern","indexOf","split","sort","a","b","localeCompare","map","toString","RegExp","toLowerCase","join","delIndex","index","indexes","idx","get","o","has","delete","size","createIndexes","records","lkey","undefined","lindex","each","fn","nth","iterate","call","merge","concat","joinData","id","on","ids","include","arguments","reverse","x","comp","valid","c","filter","error","errorMsg","v","k","onmessage","ev","cmd","postMessage","patch","ogdata","overwrite","op","path","s","Math","random","substring","setIndexValue","setIndex","indice","lidx","toObjekt","frozen","freeze","uuid","substr","r","floor","factory","config","Haro","functions","webWorker","server","worker","Function","URL","createObjectURL","process","nextTick","Promise","fetch","require","deferred","tuple","Worker","webWorkerError","adapter","_this","this","adapters","method","credentials","headers","accept","content-type","loading","logging","registry","source","total","uri","versions","versioning","reindex","batch","args","next","all","then","defer","resolve","reject","_this2","lload","del","hash","limit","toObject","request","body","promise","larg","apply","onbatch","console","log","onerror","clear","onclear","_len","_key","Error","_this3","shift","pop","splice","storage","success","message","stack","ondelete","toArray","transform","entries","where","_this4","raw","lfn","ctx","output","other","offload","find","offset","_this5","max","slice","_this6","payload","useWorker","_this7","datum","_this8","cfg","toUpperCase","res","status","_headers","_this9","_this10","rgex","test","seen","lset","_this11","override","ldata","luri","xdata","onset","sync","_this12","_this13","_len2","_key2","deferreds","_this14","Allow","allow","onsync","reduce","_this15","values","err","terminate","version","exports","module","define","amd","haro","window"],"mappings":"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","file":"haro.min.js","sourcesContent":["/**\n * Har≈ç is a modern immutable DataStore using Maps, Sets, Promises, & Tuples\n *\n * @author Jason Mulligan <jason.mulligan@avoidwork.com>\n * @copyright 2016\n * @license BSD-3-Clause\n * @link https://github.com/avoidwork/haro\n * @version 3.0.5\n */\n\"use strict\";\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n(function (global) {\n\tvar server = typeof process !== \"undefined\" && typeof process.nextTick === \"function\";\n\tvar Promise = global.Promise;\n\tvar Map = global.Map;\n\tvar Set = global.Set;\n\tvar fetch = global.fetch || require(\"node-fetch\");\n\tvar deferred = global.deferred || require(\"tiny-defer\");\n\tvar tuple = global.tuple || require(\"tiny-tuple\");\n\tvar Blob = global.Blob || require(\"Blob\");\n\tvar Worker = global.Worker || require(\"tiny-worker\");\n\tvar r = [8, 9, \"a\", \"b\"];\n\tvar regex = {\n\t\tquerystring: /\\?.*/,\n\t\tendslash: /\\/$/\n\t};\n\tvar webWorker = typeof Blob !== \"undefined\" && typeof Worker !== \"undefined\";\n\tvar webWorkerError = \"Web Worker not supported\";\n\tvar adapter = {};\n\n\tfunction cast(input) {\n\t\tvar result = void 0;\n\n\t\tswitch (true) {\n\t\t\tcase input instanceof Map:\n\t\t\t\tresult = {};\n\t\t\t\tinput.forEach(function (value, key) {\n\t\t\t\t\tresult[key] = cast(value);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase input instanceof Set:\n\t\t\t\tresult = [];\n\t\t\t\tinput.forEach(function (i) {\n\t\t\t\t\tresult.push(cast(i));\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase Array.isArray(input):\n\t\t\t\tresult = new Set();\n\t\t\t\tinput.forEach(function (i) {\n\t\t\t\t\tresult.add(cast(i));\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase input instanceof Object:\n\t\t\t\tresult = new Map();\n\t\t\t\tObject.keys(input).forEach(function (i) {\n\t\t\t\t\tresult.set(i, cast(input[i]));\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tresult = input;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tfunction blob(arg) {\n\t\tvar obj = void 0;\n\n\t\ttry {\n\t\t\tobj = new Blob([arg], { type: \"application/javascript\" });\n\t\t} catch (e) {\n\t\t\tif (!global.BlobBuilder) {\n\t\t\t\tglobal.BlobBuilder = global.MSBlobBuilder || global.WebKitBlobBuilder || global.MozBlobBuilder;\n\t\t\t}\n\n\t\t\tobj = new global.BlobBuilder().append(arg).getBlob();\n\t\t}\n\n\t\treturn obj;\n\t}\n\n\tfunction clone(arg) {\n\t\treturn JSON.parse(JSON.stringify(arg));\n\t}\n\n\tfunction concatURI(left, right) {\n\t\treturn left.replace(regex.querystring, \"\").replace(regex.endslash, \"\") + (right ? \"/\" + right : \"\");\n\t}\n\n\tfunction keyIndex(key, data, delimiter, pattern) {\n\t\tvar result = void 0;\n\n\t\tif (key.indexOf(delimiter) > -1) {\n\t\t\tresult = key.split(delimiter).sort(function (a, b) {\n\t\t\t\treturn a.localeCompare(b);\n\t\t\t}).map(function (i) {\n\t\t\t\treturn data[i].toString().replace(new RegExp(pattern, \"g\"), \"\").toLowerCase();\n\t\t\t}).join(delimiter);\n\t\t} else {\n\t\t\tresult = data[key];\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tfunction delIndex(index, indexes, delimiter, key, data, pattern) {\n\t\tindex.forEach(function (i) {\n\t\t\tvar idx = indexes.get(i),\n\t\t\t    value = keyIndex(i, data, delimiter, pattern),\n\t\t\t    o = void 0;\n\n\t\t\tif (idx.has(value)) {\n\t\t\t\to = idx.get(value);\n\t\t\t\to.delete(key);\n\n\t\t\t\tif (o.size === 0) {\n\t\t\t\t\to = null;\n\t\t\t\t\tidx.delete(value);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction createIndexes(records, indexes, key, delimiter, pattern) {\n\t\tvar result = {};\n\n\t\tindexes.forEach(function (i) {\n\t\t\tresult[i] = {};\n\t\t});\n\n\t\trecords.forEach(function (i) {\n\t\t\tvar lkey = i[key];\n\n\t\t\tif (lkey !== undefined) {\n\t\t\t\tindexes.forEach(function (index) {\n\t\t\t\t\tvar lindex = keyIndex(index, i, delimiter, pattern);\n\n\t\t\t\t\tif (result[index][lindex] === undefined) {\n\t\t\t\t\t\tresult[index][lindex] = [];\n\t\t\t\t\t}\n\n\t\t\t\t\tresult[index][lindex].push(lkey);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tfunction each(arg, fn) {\n\t\tvar i = -1,\n\t\t    nth = arg.length;\n\n\t\twhile (++i < nth) {\n\t\t\tif (fn(arg[i]) === false) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction iterate(obj, fn) {\n\t\tif (obj instanceof Object) {\n\t\t\tObject.keys(obj).forEach(function (i) {\n\t\t\t\tfn.call(obj, obj[i], i);\n\t\t\t});\n\t\t} else {\n\t\t\tobj.forEach(fn);\n\t\t}\n\t}\n\n\tfunction merge(a, b) {\n\t\tif (a instanceof Object && b instanceof Object) {\n\t\t\tObject.keys(b).forEach(function (i) {\n\t\t\t\tif (a[i] instanceof Object && b[i] instanceof Object) {\n\t\t\t\t\ta[i] = merge(a[i], b[i]);\n\t\t\t\t} else if (Array.isArray(a[i]) && Array.isArray(b[i])) {\n\t\t\t\t\ta[i] = a[i].concat(b[i]);\n\t\t\t\t} else {\n\t\t\t\t\ta[i] = b[i];\n\t\t\t\t}\n\t\t\t});\n\t\t} else if (Array.isArray(a) && Array.isArray(b)) {\n\t\t\ta = a.concat(b);\n\t\t} else {\n\t\t\ta = b;\n\t\t}\n\n\t\treturn a;\n\t}\n\n\tfunction joinData(id, a, b, key, on) {\n\t\tvar type = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : \"inner\";\n\n\t\tvar error = false,\n\t\t    result = [],\n\t\t    errorMsg = void 0;\n\n\t\tfunction join(left, right, ids) {\n\t\t\tvar include = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n\t\t\tvar reverse = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n\n\t\t\tvar keys = Object.keys(right[0]),\n\t\t\t    fn = !reverse ? function (x, i) {\n\t\t\t\treturn x[on] === i[key];\n\t\t\t} : function (x, i) {\n\t\t\t\treturn x[key] === i[on];\n\t\t\t};\n\n\t\t\teach(left, function (i) {\n\t\t\t\tvar comp = {},\n\t\t\t\t    valid = true,\n\t\t\t\t    c = right.filter(function (x) {\n\t\t\t\t\treturn fn(x, i);\n\t\t\t\t});\n\n\t\t\t\tif (c.length > 1) {\n\t\t\t\t\terror = true;\n\t\t\t\t\terrorMsg = \"More than one record found on \" + i[on];\n\t\t\t\t\tvalid = false;\n\t\t\t\t} else if (c.length === 1) {\n\t\t\t\t\t[i, c[0]].forEach(function (x, idx) {\n\t\t\t\t\t\titerate(x, function (v, k) {\n\t\t\t\t\t\t\tcomp[ids[idx] + \"_\" + k] = v;\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t} else if (include) {\n\t\t\t\t\titerate(i, function (v, k) {\n\t\t\t\t\t\tcomp[ids[0] + \"_\" + k] = v;\n\t\t\t\t\t});\n\n\t\t\t\t\tkeys.forEach(function (k) {\n\t\t\t\t\t\tcomp[ids[1] + \"_\" + k] = null;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (valid && Object.keys(comp).length > 0) {\n\t\t\t\t\tresult.push(comp);\n\t\t\t\t}\n\n\t\t\t\treturn valid;\n\t\t\t});\n\t\t}\n\n\t\tif (type === \"inner\") {\n\t\t\tjoin(a, b, id);\n\t\t}\n\n\t\tif (type === \"left\") {\n\t\t\tjoin(a, b, id, true);\n\t\t}\n\n\t\tif (type === \"right\") {\n\t\t\tjoin(b, a, clone(id).reverse(), true, true);\n\t\t}\n\n\t\treturn !error ? result : errorMsg;\n\t}\n\n\tfunction onmessage(ev) {\n\t\tvar data = JSON.parse(ev.data),\n\t\t    cmd = data.cmd,\n\t\t    result = void 0;\n\n\t\tif (cmd === \"index\") {\n\t\t\tresult = createIndexes(data.records, data.index, data.key, data.delimiter, data.pattern);\n\t\t}\n\n\t\tif (cmd === \"join\") {\n\t\t\tresult = joinData(data.ids, data.records[0], data.records[1], data.key, data.on, data.type);\n\t\t}\n\n\t\tpostMessage(JSON.stringify(result));\n\t}\n\n\tfunction patch() {\n\t\tvar ogdata = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\t\tvar data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\t\tvar key = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : \"\";\n\t\tvar overwrite = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n\n\t\tvar result = [];\n\n\t\tif (overwrite) {\n\t\t\titerate(ogdata, function (v, k) {\n\t\t\t\tif (k !== key && data[k] === undefined) {\n\t\t\t\t\tresult.push({ op: \"remove\", path: \"/\" + k });\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\titerate(data, function (v, k) {\n\t\t\tif (k !== key && ogdata[k] === undefined) {\n\t\t\t\tresult.push({ op: \"add\", path: \"/\" + k, value: v });\n\t\t\t} else if (JSON.stringify(ogdata[k]) !== JSON.stringify(v)) {\n\t\t\t\tresult.push({ op: \"replace\", path: \"/\" + k, value: v });\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tfunction s() {\n\t\treturn ((Math.random() + 1) * 0x10000 | 0).toString(16).substring(1);\n\t}\n\n\tfunction setIndexValue(index, key, value) {\n\t\tif (!index.has(key)) {\n\t\t\tindex.set(key, new Set());\n\t\t}\n\n\t\tindex.get(key).add(value);\n\t}\n\n\tfunction setIndex(index, indexes, delimiter, key, data, indice, pattern) {\n\t\tvar idx = void 0;\n\n\t\tif (!indice) {\n\t\t\tindex.forEach(function (i) {\n\t\t\t\tvar lidx = keyIndex(i, data, delimiter, pattern);\n\n\t\t\t\tif (lidx !== undefined && lidx !== null) {\n\t\t\t\t\tsetIndexValue(indexes.get(i), lidx, key);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tidx = keyIndex(indice, data, delimiter, pattern);\n\n\t\t\tif (idx !== undefined && idx !== null) {\n\t\t\t\tsetIndexValue(indexes.get(indice), idx, key);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction toObjekt(arg) {\n\t\tvar frozen = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n\n\t\tvar result = {};\n\n\t\targ.forEach(function (value, key) {\n\t\t\tvar obj = clone(value);\n\n\t\t\tif (frozen) {\n\t\t\t\tObject.freeze(obj);\n\t\t\t}\n\n\t\t\tresult[clone(key)] = obj;\n\t\t});\n\n\t\tif (frozen) {\n\t\t\tObject.freeze(result);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tfunction uuid() {\n\t\treturn s() + s() + \"-\" + s() + \"-4\" + s().substr(0, 3) + \"-\" + r[Math.floor(Math.random() * 4)] + s().substr(0, 3) + \"-\" + s() + s() + s();\n\t}\n\n\tvar Haro = function () {\n\t\tfunction Haro(data) {\n\t\t\tvar _this = this;\n\n\t\t\tvar config = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n\t\t\t_classCallCheck(this, Haro);\n\n\t\t\tthis.adapters = {};\n\t\t\tthis.data = new Map();\n\t\t\tthis.delimiter = \"|\";\n\t\t\tthis.config = {\n\t\t\t\tmethod: \"get\",\n\t\t\t\tcredentials: false,\n\t\t\t\theaders: {\n\t\t\t\t\taccept: \"application/json\",\n\t\t\t\t\t\"content-type\": \"application/json\"\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.id = uuid();\n\t\t\tthis.index = [];\n\t\t\tthis.indexes = new Map();\n\t\t\tthis.key = \"\";\n\t\t\tthis.loading = false;\n\t\t\tthis.logging = true;\n\t\t\tthis.patch = false;\n\t\t\tthis.pattern = \"\\\\s*|\\\\t*\";\n\t\t\tthis.registry = [];\n\t\t\tthis.source = \"\";\n\t\t\tthis.total = 0;\n\t\t\tthis.uri = \"\";\n\t\t\tthis.worker = null;\n\t\t\tthis.versions = new Map();\n\t\t\tthis.versioning = true;\n\n\t\t\tObject.keys(config).forEach(function (i) {\n\t\t\t\t_this[i] = merge(_this[i], config[i]);\n\t\t\t});\n\n\t\t\tthis.reindex();\n\n\t\t\tif (data) {\n\t\t\t\tthis.batch(data, \"set\");\n\t\t\t}\n\t\t}\n\n\t\t_createClass(Haro, [{\n\t\t\tkey: \"batch\",\n\t\t\tvalue: function batch(args, type) {\n\t\t\t\tvar _this2 = this;\n\n\t\t\t\tvar lload = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n\t\t\t\tvar defer = deferred(),\n\t\t\t\t    del = type === \"del\",\n\t\t\t\t    data = void 0,\n\t\t\t\t    fn = void 0,\n\t\t\t\t    hash = void 0;\n\n\t\t\t\tfunction next() {\n\t\t\t\t\tPromise.all(args.map(fn)).then(defer.resolve, defer.reject);\n\t\t\t\t}\n\n\t\t\t\tthis.loading = true;\n\n\t\t\t\tif (del) {\n\t\t\t\t\tfn = function fn(i) {\n\t\t\t\t\t\treturn _this2.del(i, true);\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tfn = function fn(i) {\n\t\t\t\t\t\treturn _this2.set(null, i, true, true, lload);\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (this.patch) {\n\t\t\t\t\tif (del) {\n\t\t\t\t\t\tdata = patch(this.limit(0, this.total, true).map(function (i) {\n\t\t\t\t\t\t\treturn i[_this2.key];\n\t\t\t\t\t\t}), args, this.key, true);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata = [];\n\t\t\t\t\t\thash = {};\n\t\t\t\t\t\targs.forEach(function (i) {\n\t\t\t\t\t\t\tvar key = i[_this2.key];\n\n\t\t\t\t\t\t\tif (key) {\n\t\t\t\t\t\t\t\thash[key] = i;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdata.push({ op: \"add\", path: \"/\", value: i });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tdata = data.concat(patch(this.toObject(undefined, false), hash, this.key, true));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data.length > 0) {\n\t\t\t\t\t\tthis.request(concatURI(this.uri, null), {\n\t\t\t\t\t\t\tmethod: \"patch\",\n\t\t\t\t\t\t\tbody: JSON.stringify(data)\n\t\t\t\t\t\t}).then(function () {\n\t\t\t\t\t\t\tnext();\n\t\t\t\t\t\t}, defer.reject);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdefer.resolve();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tnext();\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise.then(function (arg) {\n\t\t\t\t\tvar larg = tuple.apply(tuple, arg);\n\n\t\t\t\t\t_this2.loading = false;\n\t\t\t\t\t_this2.onbatch(type, larg);\n\n\t\t\t\t\tif (_this2.logging) {\n\t\t\t\t\t\tconsole.log(\"Batch inserted data into\", _this2.id);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn larg;\n\t\t\t\t}, function (e) {\n\t\t\t\t\t_this2.loading = false;\n\t\t\t\t\t_this2.onerror(\"batch\", e);\n\t\t\t\t\tthrow e;\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"clear\",\n\t\t\tvalue: function clear() {\n\t\t\t\tthis.total = 0;\n\t\t\t\tthis.registry.length = 0;\n\t\t\t\tthis.data.clear();\n\t\t\t\tthis.indexes.clear();\n\t\t\t\tthis.versions.clear();\n\t\t\t\tthis.reindex().onclear();\n\n\t\t\t\tif (this.logging) {\n\t\t\t\t\tconsole.log(\"Cleared\", this.id);\n\t\t\t\t}\n\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"cmd\",\n\t\t\tvalue: function cmd(type) {\n\t\t\t\tvar defer = deferred();\n\n\t\t\t\tif (!this.adapters[type] || !adapter[type]) {\n\t\t\t\t\tdefer.reject(new Error(type + \" not configured for persistent storage\"));\n\t\t\t\t} else {\n\t\t\t\t\tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n\t\t\t\t\t\targs[_key - 1] = arguments[_key];\n\t\t\t\t\t}\n\n\t\t\t\t\tadapter[type].apply(this, [this].concat(args)).then(defer.resolve, defer.reject);\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"del\",\n\t\t\tvalue: function del(key) {\n\t\t\t\tvar _this3 = this;\n\n\t\t\t\tvar batch = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n\t\t\t\tvar defer = deferred(),\n\t\t\t\t    next = void 0;\n\n\t\t\t\tnext = function next() {\n\t\t\t\t\tvar index = _this3.registry.indexOf(key);\n\n\t\t\t\t\tif (index > -1) {\n\t\t\t\t\t\tif (index === 0) {\n\t\t\t\t\t\t\t_this3.registry.shift();\n\t\t\t\t\t\t} else if (index === _this3.registry.length - 1) {\n\t\t\t\t\t\t\t_this3.registry.pop();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t_this3.registry.splice(index, 1);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdelIndex(_this3.index, _this3.indexes, _this3.delimiter, key, _this3.data.get(key), _this3.pattern);\n\t\t\t\t\t\t_this3.data.delete(key);\n\t\t\t\t\t\t--_this3.total;\n\n\t\t\t\t\t\tif (_this3.versioning) {\n\t\t\t\t\t\t\t_this3.versions.delete(key);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_this3.storage(\"remove\", key).then(function (success) {\n\t\t\t\t\t\t\tif (success && _this3.logging) {\n\t\t\t\t\t\t\t\tconsole.log(\"Deleted\", key, \"from persistent storage\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\tif (_this3.logging) {\n\t\t\t\t\t\t\t\tconsole.error(\"Error deleting\", key, \"from persistent storage:\", e.message || e.stack || e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tdefer.resolve(key);\n\t\t\t\t};\n\n\t\t\t\tif (this.data.has(key)) {\n\t\t\t\t\tif (!batch) {\n\t\t\t\t\t\tthis.loading = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!batch && this.uri) {\n\t\t\t\t\t\tif (this.patch) {\n\t\t\t\t\t\t\tthis.request(concatURI(this.uri, null), {\n\t\t\t\t\t\t\t\tmethod: \"patch\",\n\t\t\t\t\t\t\t\tbody: JSON.stringify([{ op: \"remove\", path: \"/\" + key }])\n\t\t\t\t\t\t\t}).then(next, function (e) {\n\t\t\t\t\t\t\t\tif (e[1] === 405) {\n\t\t\t\t\t\t\t\t\t_this3.patch = false;\n\t\t\t\t\t\t\t\t\t_this3.request(concatURI(_this3.uri, key), {\n\t\t\t\t\t\t\t\t\t\tmethod: \"delete\"\n\t\t\t\t\t\t\t\t\t}).then(next, defer.reject);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.request(concatURI(this.uri, key), {\n\t\t\t\t\t\t\t\tmethod: \"delete\"\n\t\t\t\t\t\t\t}).then(next, defer.reject);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnext();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdefer.reject(new Error(\"Record not found\"));\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise.then(function (arg) {\n\t\t\t\t\tif (!batch) {\n\t\t\t\t\t\t_this3.loading = false;\n\t\t\t\t\t}\n\n\t\t\t\t\t_this3.ondelete(arg);\n\n\t\t\t\t\treturn arg;\n\t\t\t\t}, function (e) {\n\t\t\t\t\tif (!batch) {\n\t\t\t\t\t\t_this3.loading = false;\n\t\t\t\t\t}\n\n\t\t\t\t\t_this3.onerror(\"delete\", e);\n\t\t\t\t\tthrow e;\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"dump\",\n\t\t\tvalue: function dump() {\n\t\t\t\tvar type = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"records\";\n\n\t\t\t\tvar result = void 0;\n\n\t\t\t\tif (type === \"records\") {\n\t\t\t\t\tresult = this.toArray(null, false);\n\t\t\t\t} else {\n\t\t\t\t\tresult = this.transform(this.indexes);\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"entries\",\n\t\t\tvalue: function entries() {\n\t\t\t\treturn this.data.entries();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"find\",\n\t\t\tvalue: function find(where) {\n\t\t\t\tvar _this4 = this;\n\n\t\t\t\tvar raw = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n\t\t\t\tvar key = Object.keys(where).sort().join(this.delimiter),\n\t\t\t\t    value = keyIndex(key, where, this.delimiter),\n\t\t\t\t    result = [];\n\n\t\t\t\tif (this.indexes.has(key)) {\n\t\t\t\t\t(this.indexes.get(key).get(value) || new Set()).forEach(function (i) {\n\t\t\t\t\t\tresult.push(_this4.get(i, raw));\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn !raw ? tuple.apply(tuple, result) : clone(result);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"filter\",\n\t\t\tvalue: function filter(fn) {\n\t\t\t\tvar raw = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n\t\t\t\tvar result = [],\n\t\t\t\t    lfn = void 0;\n\n\t\t\t\tif (!raw) {\n\t\t\t\t\tlfn = function lfn(value, key) {\n\t\t\t\t\t\tif (fn(value, key) === true) {\n\t\t\t\t\t\t\tresult.push(tuple(key, value));\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tlfn = function lfn(value, key) {\n\t\t\t\t\t\tif (fn(value, key) === true) {\n\t\t\t\t\t\t\tresult.push(value);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tthis.forEach(lfn);\n\n\t\t\t\treturn !raw ? tuple.apply(tuple, result) : result;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"forEach\",\n\t\t\tvalue: function forEach(fn, ctx) {\n\t\t\t\tthis.data.forEach(function (value, key) {\n\t\t\t\t\tfn(clone(value), clone(key));\n\t\t\t\t}, ctx);\n\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"get\",\n\t\t\tvalue: function get(key) {\n\t\t\t\tvar raw = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n\t\t\t\tvar output = void 0;\n\n\t\t\t\tif (this.data.has(key)) {\n\t\t\t\t\toutput = !raw ? tuple(key, this.data.get(key)) : clone(this.data.get(key));\n\t\t\t\t}\n\n\t\t\t\treturn output;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"has\",\n\t\t\tvalue: function has(key) {\n\t\t\t\treturn this.data.has(key);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"join\",\n\t\t\tvalue: function join(other) {\n\t\t\t\tvar on = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.key;\n\t\t\t\tvar type = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : \"inner\";\n\t\t\t\tvar where = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : [];\n\n\t\t\t\tvar defer = deferred(),\n\t\t\t\t    promise = void 0;\n\n\t\t\t\tif (other.total > 0) {\n\t\t\t\t\tif (where.length > 0) {\n\t\t\t\t\t\tpromise = this.offload([[this.id, other.id], this.find(where[0], true), !where[1] ? other.toArray(null, true) : other.find(where[1], true), this.key, on, type], \"join\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpromise = this.offload([[this.id, other.id], this.toArray(null, true), other.toArray(null, true), this.key, on, type], \"join\");\n\t\t\t\t\t}\n\n\t\t\t\t\tpromise.then(function (result) {\n\t\t\t\t\t\tif (typeof result === \"string\") {\n\t\t\t\t\t\t\tdefer.reject(new Error(result));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdefer.resolve(result);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, defer.reject);\n\t\t\t\t} else {\n\t\t\t\t\tdefer.resolve([]);\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"keys\",\n\t\t\tvalue: function keys() {\n\t\t\t\treturn this.data.keys();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"limit\",\n\t\t\tvalue: function limit() {\n\t\t\t\tvar offset = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n\n\t\t\t\tvar _this5 = this;\n\n\t\t\t\tvar max = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n\t\t\t\tvar raw = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n\t\t\t\tvar result = this.registry.slice(offset, offset + max).map(function (i) {\n\t\t\t\t\treturn _this5.get(i, raw);\n\t\t\t\t});\n\n\t\t\t\treturn !raw ? tuple.apply(tuple, result) : result;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"load\",\n\t\t\tvalue: function load() {\n\t\t\t\tvar _this6 = this;\n\n\t\t\t\tvar type = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"mongo\";\n\t\t\t\tvar key = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : undefined;\n\n\t\t\t\tvar batch = key === undefined,\n\t\t\t\t    id = !batch ? key : this.id;\n\n\t\t\t\tif (batch) {\n\t\t\t\t\tthis.clear();\n\t\t\t\t}\n\n\t\t\t\treturn this.cmd(type, \"get\", key).then(function (arg) {\n\t\t\t\t\tif (_this6.logging) {\n\t\t\t\t\t\tconsole.log(\"Loaded\", id, \"from\", type, \"persistent storage\");\n\t\t\t\t\t}\n\n\t\t\t\t\treturn batch ? _this6.batch(arg, \"set\", true) : _this6.set(key, arg, true, true, true);\n\t\t\t\t}, function (e) {\n\t\t\t\t\tif (_this6.logging) {\n\t\t\t\t\t\tconsole.error(\"Error loading\", id, \"from\", type, \"persistent storage:\", e.message || e.stack || e);\n\t\t\t\t\t}\n\n\t\t\t\t\tthrow e;\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"map\",\n\t\t\tvalue: function map(fn) {\n\t\t\t\tvar raw = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n\t\t\t\tvar result = [];\n\n\t\t\t\tthis.forEach(function (value, key) {\n\t\t\t\t\tresult.push(fn(value, key));\n\t\t\t\t});\n\n\t\t\t\treturn !raw ? tuple.apply(tuple, result) : result;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"offload\",\n\t\t\tvalue: function offload(data) {\n\t\t\t\tvar cmd = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"index\";\n\t\t\t\tvar index = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.index;\n\n\t\t\t\tvar defer = deferred(),\n\t\t\t\t    payload = void 0,\n\t\t\t\t    obj = void 0;\n\n\t\t\t\tif (this.worker) {\n\t\t\t\t\tobj = this.useWorker(defer);\n\n\t\t\t\t\tif (obj) {\n\t\t\t\t\t\tif (cmd === \"index\") {\n\t\t\t\t\t\t\tpayload = {\n\t\t\t\t\t\t\t\tcmd: cmd,\n\t\t\t\t\t\t\t\tindex: index,\n\t\t\t\t\t\t\t\trecords: data,\n\t\t\t\t\t\t\t\tkey: this.key,\n\t\t\t\t\t\t\t\tdelimiter: this.delimiter,\n\t\t\t\t\t\t\t\tpattern: this.pattern\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (cmd === \"join\") {\n\t\t\t\t\t\t\tpayload = {\n\t\t\t\t\t\t\t\tcmd: cmd,\n\t\t\t\t\t\t\t\tids: data[0],\n\t\t\t\t\t\t\t\trecords: [data[1], data[2]],\n\t\t\t\t\t\t\t\tkey: data[3],\n\t\t\t\t\t\t\t\ton: data[4],\n\t\t\t\t\t\t\t\ttype: data[5]\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tobj.postMessage(JSON.stringify(payload));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdefer.reject(new Error(webWorkerError));\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"onbatch\",\n\t\t\tvalue: function onbatch() {}\n\t\t}, {\n\t\t\tkey: \"onclear\",\n\t\t\tvalue: function onclear() {}\n\t\t}, {\n\t\t\tkey: \"ondelete\",\n\t\t\tvalue: function ondelete() {}\n\t\t}, {\n\t\t\tkey: \"onerror\",\n\t\t\tvalue: function onerror() {}\n\t\t}, {\n\t\t\tkey: \"onset\",\n\t\t\tvalue: function onset() {}\n\t\t}, {\n\t\t\tkey: \"onsync\",\n\t\t\tvalue: function onsync() {}\n\t\t}, {\n\t\t\tkey: \"override\",\n\t\t\tvalue: function override(data) {\n\t\t\t\tvar _this7 = this;\n\n\t\t\t\tvar type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"records\";\n\t\t\t\tvar fn = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : undefined;\n\n\t\t\t\tvar defer = deferred();\n\n\t\t\t\tif (type === \"indexes\") {\n\t\t\t\t\tthis.indexes = this.transform(data, fn);\n\t\t\t\t\tdefer.resolve(true);\n\t\t\t\t} else if (type === \"records\") {\n\t\t\t\t\tthis.data.clear();\n\t\t\t\t\tthis.registry.length = 0;\n\t\t\t\t\tdata.forEach(function (datum) {\n\t\t\t\t\t\tvar key = datum[_this7.key] || uuid();\n\n\t\t\t\t\t\t_this7.data.set(key, datum);\n\t\t\t\t\t\t_this7.registry.push(key);\n\t\t\t\t\t});\n\t\t\t\t\tthis.total = this.data.size;\n\t\t\t\t\tdefer.resolve(true);\n\t\t\t\t} else {\n\t\t\t\t\tdefer.reject(new Error(\"Invalid type\"));\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"register\",\n\t\t\tvalue: function register(key, fn) {\n\t\t\t\tadapter[key] = fn;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"reindex\",\n\t\t\tvalue: function reindex(index) {\n\t\t\t\tvar _this8 = this;\n\n\t\t\t\tif (!index) {\n\t\t\t\t\tthis.indexes.clear();\n\t\t\t\t\tthis.index.forEach(function (i) {\n\t\t\t\t\t\t_this8.indexes.set(i, new Map());\n\t\t\t\t\t});\n\t\t\t\t\tthis.forEach(function (data, key) {\n\t\t\t\t\t\t_this8.index.forEach(function (i) {\n\t\t\t\t\t\t\tsetIndex(_this8.index, _this8.indexes, _this8.delimiter, key, data, i, _this8.pattern);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.indexes.set(index, new Map());\n\t\t\t\t\tthis.forEach(function (data, key) {\n\t\t\t\t\t\tsetIndex(_this8.index, _this8.indexes, _this8.delimiter, key, data, index, _this8.pattern);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"request\",\n\t\t\tvalue: function request(input) {\n\t\t\t\tvar config = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n\t\t\t\tvar defer = deferred(),\n\t\t\t\t    cfg = merge(this.config, config);\n\n\t\t\t\tcfg.method = cfg.method.toUpperCase();\n\n\t\t\t\tfetch(input, cfg).then(function (res) {\n\t\t\t\t\tvar status = res.status,\n\t\t\t\t\t    headers = void 0;\n\n\t\t\t\t\tif (res.headers._headers) {\n\t\t\t\t\t\theaders = {};\n\t\t\t\t\t\tObject.keys(res.headers._headers).forEach(function (i) {\n\t\t\t\t\t\t\theaders[i] = res.headers._headers[i].join(\", \");\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\theaders = toObjekt(res.headers);\n\t\t\t\t\t}\n\n\t\t\t\t\tres[res.headers.get(\"content-type\").indexOf(\"application/json\") > -1 ? \"json\" : \"text\"]().then(function (arg) {\n\t\t\t\t\t\tdefer[status < 200 || status >= 400 ? \"reject\" : \"resolve\"](tuple(arg, status, headers));\n\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\tdefer.reject(tuple(e.message, status, headers));\n\t\t\t\t\t});\n\t\t\t\t}, function (e) {\n\t\t\t\t\tdefer.reject(tuple(e.message, 0, {}));\n\t\t\t\t});\n\n\t\t\t\treturn defer.promise;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"save\",\n\t\t\tvalue: function save() {\n\t\t\t\tvar _this9 = this;\n\n\t\t\t\tvar type = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"mongo\";\n\n\t\t\t\treturn this.cmd(type, \"set\").then(function (arg) {\n\t\t\t\t\tif (_this9.logging) {\n\t\t\t\t\t\tconsole.log(\"Saved\", _this9.id, \"to\", type, \"persistent storage\");\n\t\t\t\t\t}\n\n\t\t\t\t\treturn arg;\n\t\t\t\t}, function (e) {\n\t\t\t\t\tif (_this9.logging) {\n\t\t\t\t\t\tconsole.error(\"Error saving \", _this9.id, \"to\", type, \"persistent storage:\", e.message || e.stack || e);\n\t\t\t\t\t}\n\n\t\t\t\t\tthrow e;\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"search\",\n\t\t\tvalue: function search(value, index) {\n\t\t\t\tvar _this10 = this;\n\n\t\t\t\tvar raw = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n\t\t\t\tvar result = [],\n\t\t\t\t    fn = typeof value === \"function\",\n\t\t\t\t    rgex = value && typeof value.test === \"function\",\n\t\t\t\t    seen = new Set(),\n\t\t\t\t    indexes = void 0;\n\n\t\t\t\tif (value) {\n\t\t\t\t\tif (index) {\n\t\t\t\t\t\tindexes = Array.isArray(index) ? index : [index];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tindexes = this.index;\n\t\t\t\t\t}\n\n\t\t\t\t\tindexes.forEach(function (i) {\n\t\t\t\t\t\tvar idx = _this10.indexes.get(i);\n\n\t\t\t\t\t\tif (idx) {\n\t\t\t\t\t\t\tidx.forEach(function (lset, lkey) {\n\t\t\t\t\t\t\t\tswitch (true) {\n\t\t\t\t\t\t\t\t\tcase fn && value(lkey, i):\n\t\t\t\t\t\t\t\t\tcase rgex && value.test(Array.isArray(lkey) ? lkey.join(\", \") : lkey):\n\t\t\t\t\t\t\t\t\tcase lkey === value:\n\t\t\t\t\t\t\t\t\t\tlset.forEach(function (key) {\n\t\t\t\t\t\t\t\t\t\t\tif (!seen.has(key)) {\n\t\t\t\t\t\t\t\t\t\t\t\tseen.add(key);\n\t\t\t\t\t\t\t\t\t\t\t\tresult.push(_this10.get(key, raw));\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\tvoid 0;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn !raw ? tuple.apply(tuple, result) : clone(result);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"set\",\n\t\t\tvalue: function set(key, data) {\n\t\t\t\tvar batch = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n\t\t\t\tvar _this11 = this;\n\n\t\t\t\tvar override = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n\t\t\t\tvar lload = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n\n\t\t\t\tvar defer = deferred(),\n\t\t\t\t    method = \"post\",\n\t\t\t\t    ldata = clone(data),\n\t\t\t\t    lkey = key,\n\t\t\t\t    body = void 0,\n\t\t\t\t    ogdata = void 0,\n\t\t\t\t    luri = void 0;\n\n\t\t\t\tvar next = function next(arg) {\n\t\t\t\t\tvar xdata = arg ? arg[0] : {};\n\n\t\t\t\t\tif (lkey === null) {\n\t\t\t\t\t\tif (_this11.key) {\n\t\t\t\t\t\t\tif (_this11.source) {\n\t\t\t\t\t\t\t\t_this11.source.split(\".\").forEach(function (i) {\n\t\t\t\t\t\t\t\t\txdata = xdata[i] || {};\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlkey = xdata[_this11.key] || ldata[_this11.key] || uuid();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlkey = uuid();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (method === \"post\") {\n\t\t\t\t\t\t_this11.registry[_this11.total] = lkey;\n\t\t\t\t\t\t++_this11.total;\n\n\t\t\t\t\t\tif (_this11.versioning) {\n\t\t\t\t\t\t\t_this11.versions.set(lkey, new Set());\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (_this11.versioning) {\n\t\t\t\t\t\t\t_this11.versions.get(lkey).add(tuple(ogdata));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdelIndex(_this11.index, _this11.indexes, _this11.delimiter, lkey, ogdata, _this11.pattern);\n\t\t\t\t\t}\n\n\t\t\t\t\t_this11.data.set(lkey, ldata);\n\t\t\t\t\tsetIndex(_this11.index, _this11.indexes, _this11.delimiter, lkey, ldata, null, _this11.pattern);\n\t\t\t\t\tdefer.resolve(_this11.get(lkey));\n\n\t\t\t\t\tif (!lload) {\n\t\t\t\t\t\t_this11.storage(\"set\", lkey, ldata).then(function (success) {\n\t\t\t\t\t\t\tif (success && _this11.logging) {\n\t\t\t\t\t\t\t\tconsole.log(\"Saved\", lkey, \"to persistent storage\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\tif (_this11.logging) {\n\t\t\t\t\t\t\t\tconsole.error(\"Error saving\", lkey, \"to persistent storage:\", e.message || e.stack || e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tif (lkey === undefined || lkey === null) {\n\t\t\t\t\tlkey = ldata[this.key] || null;\n\t\t\t\t}\n\n\t\t\t\tif (lkey && this.data.has(lkey)) {\n\t\t\t\t\tmethod = \"put\";\n\t\t\t\t\togdata = this.data.get(lkey);\n\n\t\t\t\t\tif (!override) {\n\t\t\t\t\t\tldata = merge(ogdata, ldata);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!batch) {\n\t\t\t\t\tthis.loading = true;\n\t\t\t\t}\n\n\t\t\t\tif (!batch && this.uri) {\n\t\t\t\t\tluri = concatURI(this.uri, lkey);\n\n\t\t\t\t\tif (this.patch) {\n\t\t\t\t\t\tif (method === \"post\") {\n\t\t\t\t\t\t\tbody = [{ op: \"add\", path: \"/\", value: ldata }];\n\t\t\t\t\t\t} else if (override) {\n\t\t\t\t\t\t\tbody = [{ op: \"replace\", path: \"/\", value: ldata }];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbody = patch(ogdata, ldata, this.key);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.request(luri, {\n\t\t\t\t\t\t\tmethod: \"patch\",\n\t\t\t\t\t\t\tbody: JSON.stringify(body)\n\t\t\t\t\t\t}).then(next, function (e) {\n\t\t\t\t\t\t\tif (e[1] === 405) {\n\t\t\t\t\t\t\t\t_this11.patch = false;\n\t\t\t\t\t\t\t\t_this11.request(luri, {\n\t\t\t\t\t\t\t\t\tmethod: method,\n\t\t\t\t\t\t\t\t\tbody: JSON.stringify(ldata)\n\t\t\t\t\t\t\t\t}).then(next, defer.reject);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.request(luri, {\n\t\t\t\t\t\t\tmethod: method,\n\t\t\t\t\t\t\tbody: JSON.stringify(ldata)\n\t\t\t\t\t\t}).then(next, defer.reject);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tnext();\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise.then(function (arg) {\n\t\t\t\t\tif (!batch) {\n\t\t\t\t\t\t_this11.loading = false;\n\t\t\t\t\t}\n\n\t\t\t\t\t_this11.onset(arg);\n\n\t\t\t\t\treturn arg;\n\t\t\t\t}, function (e) {\n\t\t\t\t\tif (!batch) {\n\t\t\t\t\t\t_this11.loading = false;\n\t\t\t\t\t}\n\n\t\t\t\t\t_this11.onerror(\"set\", e);\n\t\t\t\t\tthrow e;\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"setUri\",\n\t\t\tvalue: function setUri(uri) {\n\t\t\t\tvar clear = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n\t\t\t\tvar defer = deferred();\n\n\t\t\t\tthis.uri = uri;\n\n\t\t\t\tif (this.uri) {\n\t\t\t\t\tthis.sync(clear).then(defer.resolve, defer.reject);\n\t\t\t\t} else {\n\t\t\t\t\tdefer.resolve([]);\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"sort\",\n\t\t\tvalue: function sort(fn) {\n\t\t\t\tvar frozen = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n\n\t\t\t\tvar result = void 0;\n\n\t\t\t\tif (frozen) {\n\t\t\t\t\tresult = Object.freeze(this.limit(0, this.total, true).sort(fn).map(function (i) {\n\t\t\t\t\t\treturn Object.freeze(i);\n\t\t\t\t\t}));\n\t\t\t\t} else {\n\t\t\t\t\tresult = this.limit(0, this.total, true).sort(fn);\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"sortBy\",\n\t\t\tvalue: function sortBy(index) {\n\t\t\t\tvar _this12 = this;\n\n\t\t\t\tvar result = [],\n\t\t\t\t    keys = [],\n\t\t\t\t    lindex = void 0;\n\n\t\t\t\tif (!this.indexes.has(index)) {\n\t\t\t\t\tthis.index.push(index);\n\t\t\t\t\tthis.reindex(index);\n\t\t\t\t}\n\n\t\t\t\tlindex = this.indexes.get(index);\n\t\t\t\tlindex.forEach(function (idx, key) {\n\t\t\t\t\tkeys.push(key);\n\t\t\t\t});\n\n\t\t\t\tkeys.sort().forEach(function (i) {\n\t\t\t\t\tlindex.get(i).forEach(function (key) {\n\t\t\t\t\t\tresult.push(_this12.get(key));\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\treturn tuple.apply(tuple, result);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"storage\",\n\t\t\tvalue: function storage() {\n\t\t\t\tvar _this13 = this;\n\n\t\t\t\tfor (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n\t\t\t\t\targs[_key2] = arguments[_key2];\n\t\t\t\t}\n\n\t\t\t\tvar defer = deferred(),\n\t\t\t\t    deferreds = [];\n\n\t\t\t\tObject.keys(this.adapters).forEach(function (i) {\n\t\t\t\t\tdeferreds.push(_this13.cmd.apply(_this13, [i].concat(args)));\n\t\t\t\t});\n\n\t\t\t\tif (deferreds.length > 0) {\n\t\t\t\t\tPromise.all(deferreds).then(function () {\n\t\t\t\t\t\tdefer.resolve(true);\n\t\t\t\t\t}, defer.reject);\n\t\t\t\t} else {\n\t\t\t\t\tdefer.resolve(false);\n\t\t\t\t}\n\n\t\t\t\treturn defer.promise;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"sync\",\n\t\t\tvalue: function sync() {\n\t\t\t\tvar _this14 = this;\n\n\t\t\t\tvar clear = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n\t\t\t\tvar defer = deferred(),\n\t\t\t\t    valid = true;\n\n\t\t\t\tthis.request(this.uri).then(function (arg) {\n\t\t\t\t\tvar data = arg[0];\n\n\t\t\t\t\t_this14.patch = (arg[2].Allow || arg[2].allow || \"\").indexOf(\"PATCH\") > -1;\n\n\t\t\t\t\tif (_this14.source) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t_this14.source.split(\".\").forEach(function (i) {\n\t\t\t\t\t\t\t\tdata = data[i];\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tvalid = false;\n\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (valid) {\n\t\t\t\t\t\tif (clear) {\n\t\t\t\t\t\t\t_this14.clear();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_this14.batch(data, \"set\").then(defer.resolve, defer.reject);\n\t\t\t\t\t}\n\t\t\t\t}, function (e) {\n\t\t\t\t\tdefer.reject(e[0] || e);\n\t\t\t\t});\n\n\t\t\t\treturn defer.promise.then(function (arg) {\n\t\t\t\t\tvar larg = tuple.apply(tuple, arg);\n\n\t\t\t\t\t_this14.onsync(larg);\n\n\t\t\t\t\treturn larg;\n\t\t\t\t}, function (e) {\n\t\t\t\t\t_this14.onerror(\"sync\", e);\n\t\t\t\t\tthrow e;\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"toArray\",\n\t\t\tvalue: function toArray(data) {\n\t\t\t\tvar frozen = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n\n\t\t\t\tvar result = void 0;\n\n\t\t\t\tif (data) {\n\t\t\t\t\tresult = data.map(function (i) {\n\t\t\t\t\t\treturn frozen ? i[1] : clone(i[1]);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tresult = this.limit(0, this.total, true);\n\n\t\t\t\t\tif (frozen) {\n\t\t\t\t\t\tresult.forEach(function (i) {\n\t\t\t\t\t\t\tObject.freeze(i);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn frozen ? Object.freeze(result) : result;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"toObject\",\n\t\t\tvalue: function toObject(data) {\n\t\t\t\tvar frozen = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n\n\t\t\t\tvar result = void 0;\n\n\t\t\t\tresult = !data ? toObjekt(this, frozen) : data.reduce(function (a, b) {\n\t\t\t\t\tvar obj = clone(b[1]);\n\n\t\t\t\t\tif (frozen) {\n\t\t\t\t\t\tObject.freeze(obj);\n\t\t\t\t\t}\n\n\t\t\t\t\ta[b[0]] = obj;\n\n\t\t\t\t\treturn a;\n\t\t\t\t}, {});\n\n\t\t\t\tif (frozen) {\n\t\t\t\t\tObject.freeze(result);\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"transform\",\n\t\t\tvalue: function transform(input, fn) {\n\t\t\t\treturn typeof fn === \"function\" ? fn(input) : cast(input);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"unload\",\n\t\t\tvalue: function unload() {\n\t\t\t\tvar _this15 = this;\n\n\t\t\t\tvar type = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"mongo\";\n\t\t\t\tvar key = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : undefined;\n\n\t\t\t\tvar id = key !== undefined ? key : this.id;\n\n\t\t\t\treturn this.cmd(type, \"remove\", key).then(function (arg) {\n\t\t\t\t\tif (_this15.logging) {\n\t\t\t\t\t\tconsole.log(\"Unloaded\", id, \"from\", type, \"persistent storage\");\n\t\t\t\t\t}\n\n\t\t\t\t\treturn arg;\n\t\t\t\t}, function (e) {\n\t\t\t\t\tif (_this15.logging) {\n\t\t\t\t\t\tconsole.error(\"Error unloading\", id, \"from\", type, \"persistent storage:\", e.message || e.stack || e);\n\t\t\t\t\t}\n\n\t\t\t\t\tthrow e;\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"unregister\",\n\t\t\tvalue: function unregister(key) {\n\t\t\t\tdelete adapter[key];\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"values\",\n\t\t\tvalue: function values() {\n\t\t\t\treturn this.data.values();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"useWorker\",\n\t\t\tvalue: function useWorker(defer) {\n\t\t\t\tvar obj = void 0;\n\n\t\t\t\tif (this.worker) {\n\t\t\t\t\tobj = new Worker(this.worker);\n\t\t\t\t\tobj.onerror = function (err) {\n\t\t\t\t\t\tdefer.reject(err);\n\t\t\t\t\t\tobj.terminate();\n\t\t\t\t\t};\n\n\t\t\t\t\tobj.onmessage = function (ev) {\n\t\t\t\t\t\tdefer.resolve(JSON.parse(ev.data));\n\t\t\t\t\t\tobj.terminate();\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tdefer.reject(new Error(webWorkerError));\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t}\n\t\t}]);\n\n\t\treturn Haro;\n\t}();\n\n\tfunction factory() {\n\t\tvar data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n\t\tvar config = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\t\tvar indexes = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n\n\t\tvar obj = new Haro(data, config, indexes),\n\t\t    functions = void 0;\n\n\t\tif (webWorker) {\n\t\t\tfunctions = [cast.toString(), clone.toString(), createIndexes.toString(), each.toString(), iterate.toString(), joinData.toString(), keyIndex.toString(), setIndexValue.toString(), setIndex.toString(), (!server ? \"\" : \"self.\") + \"onmessage = \" + onmessage.toString() + \";\"];\n\n\t\t\ttry {\n\t\t\t\tobj.worker = !server ? global.URL.createObjectURL(blob(functions.join(\"\\n\"))) : new Function(functions.join(\"\\n\"));\n\t\t\t} catch (e) {\n\t\t\t\tobj.worker = null;\n\t\t\t}\n\t\t}\n\n\t\treturn obj;\n\t}\n\n\tfactory.transform = cast;\n\tfactory.version = \"3.0.5\";\n\n\t// Node, AMD & window supported\n\tif (typeof exports !== \"undefined\") {\n\t\tmodule.exports = factory;\n\t} else if (typeof define === \"function\" && define.amd) {\n\t\tdefine(function () {\n\t\t\treturn factory;\n\t\t});\n\t} else {\n\t\tglobal.haro = factory;\n\t}\n})(typeof window !== \"undefined\" ? window : global);\n"]}