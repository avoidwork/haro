/* 2015 Jason Mulligan <jason.mulligan@avoidwork.com> */

"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(a){function b(a){return JSON.parse(JSON.stringify(a))}function c(){var a=void 0,b=void 0,c=void 0;return a=new h(function(a,d){b=a,c=d}),{resolve:b,reject:c,promise:a}}function d(a,c){var d=b(a),e=b(c);return Object.keys(e).forEach(function(a){d[a]=e[a]}),d}function e(){function a(){return(65536*(1+Math.random())|0).toString(16).substring(1)}var b=[8,9,"a","b"];return a()+a()+"-"+a()+"-4"+a().substr(0,3)+"-"+b[Math.floor(4*Math.random())]+a().substr(0,3)+"-"+a()+a()+a()}function f(){var a=void 0===arguments[0]?null:arguments[0],b=void 0===arguments[1]?{}:arguments[1];return new i(a,b)}var g=a.tuple||require("tuple"),h=a.Promise||require("es6-promise").Promise,i=function(){function a(b){_classCallCheck(this,a),this.data=new Map,this.config={method:"get",credentials:!1,headers:{accept:"application/json","content-type":"application/json"}},this.key="",this.source="",this.total=0,this.uri="",b&&this.batch(b,"set")}return _createClass(a,[{key:"batch",value:function(a,d){var f=this,g=c(),i=[];return"del"===d?a.forEach(function(a){i.push(f.del(a,!0))}):a.forEach(function(a){var c=b(a),d=f.key?c[f.key]||e():e();i.push(f.set(d,c,!0))}),h.all(i).then(function(a){g.resolve(a)},function(a){g.reject(a.message||a)}),g.promise}},{key:"del",value:function(a){var b=void 0===arguments[1]?!1:arguments[1],d=c();return this.data.has(a)?!b&&this.uri?this.request(this.uri+"/"+a,{method:"delete"}).then(function(){this.data.has(a)&&(this.data["delete"](a),--this.total),d.resolve()},function(a){d.reject(a.message||a)}):(this.data["delete"](a),--this.total,d.resolve()):d.reject("Record not found"),d.promise}},{key:"get",value:function(a){var b=void 0;return this.data.has(a)&&(b=g(a,this.data.get(a))),b}},{key:"range",value:function(){var a=void 0===arguments[0]?0:arguments[0],b=void 0===arguments[1]?0:arguments[1],c=void 0,d=void 0,e=void 0;if(a===b||b>a)throw new Error("Invalid range");c=a-1,d=[];do d.push(this.data[c]);while(++c<=b&&c<this.total);return e=g.apply(g,d)}},{key:"request",value:function(a){var b=void 0===arguments[1]?{}:arguments[1],c=d(this.config,b);return fetch(a,c).then(function(a){return a["application/json"===c.headers.accept?"json":"text"]().then(function(a){return a},function(a){throw a})},function(a){throw a})}},{key:"set",value:function(a,f){var g=this,h=void 0===arguments[2]?!1:arguments[2],i=c(),j="post",k=b(f);return void 0===a||null===a?a=e():this.data.has(a)&&(j="put",k=d(this.get(a)[1],f)),!h&&this.uri?this.request(this.uri+"/"+a,{method:j,body:JSON.stringify(k)}).then(function(){g.data.set(a,k),++g.total,i.resolve(g.get(a))},function(a){i.reject(a.message||a)}):(this.data.set(a,k),++this.total,i.resolve(this.get(a))),i.promise}},{key:"setUri",value:function(a){var b=this,d=c();return this.uri=a,this.uri?this.request(this.uri).then(function(a){var c=b.source?a[b.source]:a;b.batch(c,"set").then(function(a){d.resolve(a)},function(a){d.reject(a.message||a)})},function(a){d.reject(a.message||a)}):d.resolve(),d.promise}}]),a}();"undefined"!=typeof exports?module.exports=f:"function"==typeof define?define(function(){return f}):a.haro=f}("undefined"!=typeof global?global:window);
//# sourceMappingURL=haro.min.js.map