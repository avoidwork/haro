{"version":3,"file":"haro.umd.min.js","sources":["../src/constants.js","../src/uuid.js","../src/haro.js"],"sourcesContent":["export const STRING_COMMA = \",\";\r\nexport const STRING_EMPTY = \"\";\r\nexport const STRING_PIPE = \"|\";\r\nexport const STRING_DOUBLE_PIPE = \"||\";\r\nexport const STRING_A = \"a\";\r\nexport const STRING_B = \"b\";\r\nexport const STRING_DEL = \"del\";\r\nexport const STRING_FUNCTION = \"function\";\r\nexport const STRING_INDEXES = \"indexes\";\r\nexport const STRING_INVALID_FIELD = \"Invalid field\";\r\nexport const STRING_INVALID_FUNCTION = \"Invalid function\";\r\nexport const STRING_INVALID_TYPE = \"Invalid type\";\r\nexport const STRING_OBJECT = \"object\";\r\nexport const STRING_RECORD_NOT_FOUND = \"Record not found\";\r\nexport const STRING_RECORDS = \"records\";\r\nexport const STRING_REGISTRY = \"registry\";\r\nexport const STRING_SET = \"set\";\r\nexport const STRING_SIZE = \"size\";\r\nexport const INT_0 = 0;\r\nexport const INT_1 = 1;\r\nexport const INT_3 = 3;\r\nexport const INT_4 = 4;\r\nexport const INT_8 = 8;\r\nexport const INT_9 = 9;\r\nexport const INT_16 = 16;","import {INT_0, INT_1, INT_16, INT_3, INT_4, INT_8, INT_9, STRING_A, STRING_B, STRING_OBJECT} from \"./constants.js\";\r\n\r\n/* istanbul ignore next */\r\nconst r = [INT_8, INT_9, STRING_A, STRING_B];\r\n\r\n/* istanbul ignore next */\r\nfunction s () {\r\n\treturn ((Math.random() + INT_1) * 0x10000 | INT_0).toString(INT_16).substring(INT_1);\r\n}\r\n\r\n/* istanbul ignore next */\r\nfunction randomUUID () {\r\n\treturn `${s()}${s()}-${s()}-4${s().slice(INT_0, INT_3)}-${r[Math.floor(Math.random() * INT_4)]}${s().slice(INT_0, INT_3)}-${s()}${s()}${s()}`;\r\n}\r\n\r\nexport const uuid = typeof crypto === STRING_OBJECT ? crypto.randomUUID.bind(crypto) : randomUUID;\r\n","import {uuid} from \"./uuid.js\";\r\nimport {\r\n\tINT_0,\r\n\tSTRING_A,\r\n\tSTRING_COMMA,\r\n\tSTRING_DEL,\r\n\tSTRING_DOUBLE_PIPE,\r\n\tSTRING_EMPTY,\r\n\tSTRING_FUNCTION,\r\n\tSTRING_INDEXES,\r\n\tSTRING_INVALID_FIELD,\r\n\tSTRING_INVALID_FUNCTION,\r\n\tSTRING_INVALID_TYPE,\r\n\tSTRING_PIPE,\r\n\tSTRING_RECORD_NOT_FOUND,\r\n\tSTRING_RECORDS,\r\n\tSTRING_REGISTRY,\r\n\tSTRING_SET,\r\n\tSTRING_SIZE\r\n} from \"./constants.js\";\r\n\r\nexport class Haro {\r\n\tconstructor ({delimiter = STRING_PIPE, id = this.uuid(), index = [], key = STRING_EMPTY, versioning = false} = {}) {\r\n\t\tthis.data = new Map();\r\n\t\tthis.delimiter = delimiter;\r\n\t\tthis.id = id;\r\n\t\tthis.index = index;\r\n\t\tthis.indexes = new Map();\r\n\t\tthis.key = key;\r\n\t\tthis.versions = new Map();\r\n\t\tthis.versioning = versioning;\r\n\r\n\t\tObject.defineProperty(this, STRING_REGISTRY, {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: () => Array.from(this.data.keys())\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(this, STRING_SIZE, {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: () => this.data.size\r\n\t\t});\r\n\r\n\t\treturn this.reindex();\r\n\t}\r\n\r\n\tbatch (args, type = STRING_SET) {\r\n\t\tconst fn = type === STRING_DEL ? i => this.del(i, true) : i => this.set(null, i, true, true);\r\n\r\n\t\treturn this.onbatch(this.beforeBatch(args, type).map(fn), type);\r\n\t}\r\n\r\n\tbeforeBatch (arg) {\r\n\t\treturn arg;\r\n\t}\r\n\r\n\tbeforeClear () {\r\n\t}\r\n\r\n\tbeforeDelete () {\r\n\t}\r\n\r\n\tbeforeSet () {\r\n\t}\r\n\r\n\tclear () {\r\n\t\tthis.beforeClear();\r\n\t\tthis.data.clear();\r\n\t\tthis.indexes.clear();\r\n\t\tthis.versions.clear();\r\n\t\tthis.reindex().onclear();\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tclone (arg) {\r\n\t\treturn JSON.parse(JSON.stringify(arg, null, INT_0));\r\n\t}\r\n\r\n\tdel (key = STRING_EMPTY, batch = false) {\r\n\t\tif (this.data.has(key) === false) {\r\n\t\t\tthrow new Error(STRING_RECORD_NOT_FOUND);\r\n\t\t}\r\n\r\n\t\tconst og = this.get(key, true);\r\n\r\n\t\tthis.beforeDelete(key, batch);\r\n\t\tthis.delIndex(this.index, this.indexes, this.delimiter, key, og);\r\n\t\tthis.data.delete(key);\r\n\t\tthis.ondelete(key, batch);\r\n\r\n\t\tif (this.versioning) {\r\n\t\t\tthis.versions.delete(key);\r\n\t\t}\r\n\t}\r\n\r\n\tdelIndex (index, indexes, delimiter, key, data) {\r\n\t\tindex.forEach(i => {\r\n\t\t\tconst idx = indexes.get(i);\r\n\r\n\t\t\tthis.each(i.includes(delimiter) ? this.indexKeys(i, delimiter, data) : Array.isArray(data[i]) ? data[i] : [data[i]], value => {\r\n\t\t\t\tif (idx.has(value)) {\r\n\t\t\t\t\tconst o = idx.get(value);\r\n\r\n\t\t\t\t\to.delete(key);\r\n\r\n\t\t\t\t\tif (o.size === INT_0) {\r\n\t\t\t\t\t\tidx.delete(value);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tdump (type = STRING_RECORDS) {\r\n\t\tlet result;\r\n\r\n\t\tif (type === STRING_RECORDS) {\r\n\t\t\tresult = Array.from(this.entries());\r\n\t\t} else {\r\n\t\t\tresult = Array.from(this.indexes).map(i => {\r\n\t\t\t\ti[1] = Array.from(i[1]).map(ii => {\r\n\t\t\t\t\tii[1] = Array.from(ii[1]);\r\n\r\n\t\t\t\t\treturn ii;\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn i;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\teach (arr = [], fn) {\r\n\t\tfor (const [idx, value] of arr.entries()) {\r\n\t\t\tfn(value, idx);\r\n\t\t}\r\n\r\n\t\treturn arr;\r\n\t}\r\n\r\n\tentries () {\r\n\t\treturn this.data.entries();\r\n\t}\r\n\r\n\tfind (where = {}, raw = false) {\r\n\t\tconst key = Object.keys(where).sort((a, b) => a.localeCompare(b)).join(this.delimiter),\r\n\t\t\tindex = this.indexes.get(key) ?? new Map();\r\n\t\tlet result = [];\r\n\r\n\t\tif (index.size > 0) {\r\n\t\t\tconst keys = this.indexKeys(key, this.delimiter, where);\r\n\r\n\t\t\tresult = Array.from(keys.reduce((a, v) => {\r\n\t\t\t\tif (index.has(v)) {\r\n\t\t\t\t\tindex.get(v).forEach(k => a.add(k));\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn a;\r\n\t\t\t}, new Set())).map(i => this.get(i, raw));\r\n\t\t}\r\n\r\n\t\treturn raw ? result : this.list(...result);\r\n\t}\r\n\r\n\tfilter (fn, raw = false) {\r\n\t\tif (typeof fn !== STRING_FUNCTION) {\r\n\t\t\tthrow new Error(STRING_INVALID_FUNCTION);\r\n\t\t}\r\n\r\n\t\tconst x = raw ? (k, v) => v : (k, v) => Object.freeze([k, Object.freeze(v)]),\r\n\t\t\tresult = this.reduce((a, v, k, ctx) => {\r\n\t\t\t\tif (fn.call(ctx, v)) {\r\n\t\t\t\t\ta.push(x(k, v));\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn a;\r\n\t\t\t}, []);\r\n\r\n\t\treturn raw ? result : Object.freeze(result);\r\n\t}\r\n\r\n\tforEach (fn, ctx) {\r\n\t\tthis.data.forEach((value, key) => fn(this.clone(value), this.clone(key)), ctx ?? this.data);\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tget (key, raw = false) {\r\n\t\tconst result = this.clone(this.data.get(key) ?? null);\r\n\r\n\t\treturn raw ? result : this.list(key, result);\r\n\t}\r\n\r\n\thas (key) {\r\n\t\treturn this.data.has(key);\r\n\t}\r\n\r\n\tindexKeys (arg = STRING_EMPTY, delimiter = STRING_PIPE, data = {}) {\r\n\t\treturn arg.split(delimiter).reduce((a, li, lidx) => {\r\n\t\t\tconst result = [];\r\n\r\n\t\t\t(Array.isArray(data[li]) ? data[li] : [data[li]]).forEach(lli => lidx === INT_0 ? result.push(lli) : a.forEach(x => result.push(`${x}${delimiter}${lli}`)));\r\n\r\n\t\t\treturn result;\r\n\t\t}, []);\r\n\t}\r\n\r\n\tkeys () {\r\n\t\treturn this.data.keys();\r\n\t}\r\n\r\n\tlimit (offset = INT_0, max = INT_0, raw = false) {\r\n\t\tconst result = this.registry.slice(offset, offset + max).map(i => this.get(i, raw));\r\n\r\n\t\treturn raw ? result : this.list(...result);\r\n\t}\r\n\r\n\tlist (...args) {\r\n\t\treturn Object.freeze(args.map(i => Object.freeze(i)));\r\n\t}\r\n\r\n\tmap (fn, raw = false) {\r\n\t\tif (typeof fn !== STRING_FUNCTION) {\r\n\t\t\tthrow new Error(STRING_INVALID_FUNCTION);\r\n\t\t}\r\n\r\n\t\tconst result = [];\r\n\r\n\t\tthis.forEach((value, key) => result.push(fn(value, key)));\r\n\r\n\t\treturn raw ? result : this.list(...result);\r\n\t}\r\n\r\n\tmerge (a = {}, b = {}, override = false) {\r\n\t\tif (Array.isArray(a) && Array.isArray(b)) {\r\n\t\t\ta = override ? b : a.concat(b);\r\n\t\t} else if (a instanceof Object && b instanceof Object) {\r\n\t\t\tthis.each(Object.keys(b), i => {\r\n\t\t\t\tif (Array.isArray(a[i]) && Array.isArray(b[i])) {\r\n\t\t\t\t\ta[i] = override ? b[i] : a[i].concat(b[i]);\r\n\t\t\t\t} else if (a[i] instanceof Object && b[i] instanceof Object) {\r\n\t\t\t\t\ta[i] = this.merge(a[i], b[i], override);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ta[i] = b[i];\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\ta = b;\r\n\t\t}\r\n\r\n\t\treturn a;\r\n\t}\r\n\r\n\tonbatch (arg) {\r\n\t\treturn arg;\r\n\t}\r\n\r\n\tonclear () {\r\n\t}\r\n\r\n\tondelete () {\r\n\t}\r\n\r\n\tonoverride () {\r\n\t}\r\n\r\n\tonset () {\r\n\t}\r\n\r\n\toverride (data, type = STRING_RECORDS) {\r\n\t\tconst result = true;\r\n\r\n\t\tif (type === STRING_INDEXES) {\r\n\t\t\tthis.indexes = new Map(data.map(i => [i[0], new Map(i[1].map(ii => [ii[0], new Set(ii[1])]))]));\r\n\t\t} else if (type === STRING_RECORDS) {\r\n\t\t\tthis.indexes.clear();\r\n\t\t\tthis.data = new Map(data);\r\n\t\t} else {\r\n\t\t\tthrow new Error(STRING_INVALID_TYPE);\r\n\t\t}\r\n\r\n\t\tthis.onoverride(type);\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\treduce (fn, accumulator, raw = false) {\r\n\t\tlet a = accumulator ?? this.data.keys().next().value;\r\n\r\n\t\tthis.forEach((v, k) => {\r\n\t\t\ta = fn(a, v, k, this, raw);\r\n\t\t}, this);\r\n\r\n\t\treturn a;\r\n\t}\r\n\r\n\treindex (index) {\r\n\t\tconst indices = index ? [index] : this.index;\r\n\r\n\t\tif (index && this.index.includes(index) === false) {\r\n\t\t\tthis.index.push(index);\r\n\t\t}\r\n\r\n\t\tthis.each(indices, i => this.indexes.set(i, new Map()));\r\n\t\tthis.forEach((data, key) => this.each(indices, i => this.setIndex(this.index, this.indexes, this.delimiter, key, data, i)));\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsearch (value, index, raw = false) {\r\n\t\tconst result = new Map(),\r\n\t\t\tfn = typeof value === STRING_FUNCTION,\r\n\t\t\trgex = value && typeof value.test === STRING_FUNCTION;\r\n\r\n\t\tif (value) {\r\n\t\t\tthis.each(index ? Array.isArray(index) ? index : [index] : this.index, i => {\r\n\t\t\t\tlet idx = this.indexes.get(i);\r\n\r\n\t\t\t\tif (idx) {\r\n\t\t\t\t\tidx.forEach((lset, lkey) => {\r\n\t\t\t\t\t\tswitch (true) {\r\n\t\t\t\t\t\t\tcase fn && value(lkey, i):\r\n\t\t\t\t\t\t\tcase rgex && value.test(Array.isArray(lkey) ? lkey.join(STRING_COMMA) : lkey):\r\n\t\t\t\t\t\t\tcase lkey === value:\r\n\t\t\t\t\t\t\t\tlset.forEach(key => {\r\n\t\t\t\t\t\t\t\t\tif (result.has(key) === false && this.data.has(key)) {\r\n\t\t\t\t\t\t\t\t\t\tresult.set(key, this.get(key, raw));\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\tvoid 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn raw ? Array.from(result.values()) : this.list(...Array.from(result.values()));\r\n\t}\r\n\r\n\tset (key = null, data = {}, batch = false, override = false) {\r\n\t\tif (key === null) {\r\n\t\t\tkey = data[this.key] ?? this.uuid();\r\n\t\t}\r\n\r\n\t\tlet x = {...data, [this.key]: key};\r\n\r\n\t\tthis.beforeSet(key, x, batch, override);\r\n\r\n\t\tif (this.data.has(key) === false) {\r\n\t\t\tif (this.versioning) {\r\n\t\t\t\tthis.versions.set(key, new Set());\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlet og = this.get(key, true);\r\n\t\t\tthis.delIndex(this.index, this.indexes, this.delimiter, key, og);\r\n\r\n\t\t\tif (this.versioning) {\r\n\t\t\t\tthis.versions.get(key).add(Object.freeze(this.clone(og)));\r\n\t\t\t}\r\n\r\n\t\t\tif (override === false) {\r\n\t\t\t\tx = this.merge(this.clone(og), x);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.data.set(key, x);\r\n\t\tthis.setIndex(this.index, this.indexes, this.delimiter, key, x, null);\r\n\t\tlet result = this.get(key);\r\n\t\tthis.onset(result, batch);\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tsetIndex (index, indexes, delimiter, key, data, indice) {\r\n\t\tthis.each(indice === null ? index : [indice], i => {\r\n\t\t\tconst lindex = indexes.get(i);\r\n\r\n\t\t\tif (i.includes(delimiter)) {\r\n\t\t\t\tthis.each(this.indexKeys(i, delimiter, data), c => {\r\n\t\t\t\t\tif (lindex.has(c) === false) {\r\n\t\t\t\t\t\tlindex.set(c, new Set());\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlindex.get(c).add(key);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tthis.each(Array.isArray(data[i]) ? data[i] : [data[i]], d => {\r\n\t\t\t\t\tif (lindex.has(d) === false) {\r\n\t\t\t\t\t\tlindex.set(d, new Set());\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlindex.get(d).add(key);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tsort (fn, frozen = true) {\r\n\t\treturn frozen ? Object.freeze(this.limit(INT_0, this.data.size, true).sort(fn).map(i => Object.freeze(i))) : this.limit(INT_0, this.data.size, true).sort(fn);\r\n\t}\r\n\r\n\tsortBy (index = STRING_EMPTY, raw = false) {\r\n\t\tif (index === STRING_EMPTY) {\r\n\t\t\tthrow new Error(STRING_INVALID_FIELD)\r\n\t\t}\r\n\r\n\t\tconst result = [],\r\n\t\t\tkeys = [];\r\n\r\n\t\tif (this.indexes.has(index) === false) {\r\n\t\t\tthis.reindex(index);\r\n\t\t}\r\n\r\n\t\tconst lindex = this.indexes.get(index);\r\n\r\n\t\tlindex.forEach((idx, key) => keys.push(key));\r\n\t\tthis.each(keys.sort(), i => lindex.get(i).forEach(key => result.push(this.get(key, raw))));\r\n\r\n\t\treturn raw ? result : this.list(...result);\r\n\t}\r\n\r\n\ttoArray (frozen = true) {\r\n\t\tconst result = Array.from(this.data.values());\r\n\r\n\t\tif (frozen) {\r\n\t\t\tthis.each(result, i => Object.freeze(i));\r\n\t\t\tObject.freeze(result);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tuuid () {\r\n\t\treturn uuid();\r\n\t}\r\n\r\n\tvalues () {\r\n\t\treturn this.data.values();\r\n\t}\r\n\r\n\twhere (predicate = {}, raw = false, op = STRING_DOUBLE_PIPE) {\r\n\t\tconst keys = this.index.filter(i => i in predicate);\r\n\r\n\t\treturn keys.length > INT_0 ? this.filter(new Function(STRING_A, `return (${keys.map(i => {\r\n\t\t\tlet result;\r\n\r\n\t\t\tif (Array.isArray(predicate[i])) {\r\n\t\t\t\tresult = `Array.isArray(a['${i}']) ? ${predicate[i].map(arg => `a['${i}'].includes(${typeof arg === \"string\" ? `'${arg}'` : arg})`).join(` ${op} `)} : (${predicate[i].map(arg => `a['${i}'] === ${typeof arg === \"string\" ? `'${arg}'` : arg}`).join(` ${op} `)})`;\r\n\t\t\t} else if (predicate[i] instanceof RegExp) {\r\n\t\t\t\tresult = `Array.isArray(a['${i}']) ? a['${i}'].filter(i => ${predicate[i]}.test(a['${i}'])).length > 0 : ${predicate[i]}.test(a['${i}'])`;\r\n\t\t\t} else {\r\n\t\t\t\tconst arg = typeof predicate[i] === \"string\" ? `'${predicate[i]}'` : predicate[i];\r\n\r\n\t\t\t\tresult = `Array.isArray(a['${i}']) ? a['${i}'].includes(${arg}) : a['${i}'] === ${arg}`;\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}).join(\") && (\")});`), raw) : [];\r\n\t}\r\n}\r\n\r\nexport function haro (data = null, config = {}) {\r\n\tconst obj = new Haro(config);\r\n\r\n\tif (Array.isArray(data)) {\r\n\t\tobj.batch(data, STRING_SET);\r\n\t}\r\n\r\n\treturn obj;\r\n}\r\n"],"names":["STRING_FUNCTION","STRING_INVALID_FUNCTION","STRING_RECORDS","INT_0","INT_1","INT_16","r","s","Math","random","toString","substring","uuid","crypto","randomUUID","bind","slice","floor","Haro","constructor","delimiter","id","this","index","key","versioning","data","Map","indexes","versions","Object","defineProperty","enumerable","get","Array","from","keys","size","reindex","batch","args","type","fn","i","del","set","onbatch","beforeBatch","map","arg","beforeClear","beforeDelete","beforeSet","clear","onclear","clone","JSON","parse","stringify","has","Error","og","delIndex","delete","ondelete","forEach","idx","each","includes","indexKeys","isArray","value","o","dump","result","entries","ii","arr","find","where","raw","sort","a","b","localeCompare","join","reduce","v","k","add","Set","list","filter","x","freeze","ctx","call","push","split","li","lidx","lli","limit","offset","max","registry","merge","override","concat","onoverride","onset","accumulator","next","indices","setIndex","search","rgex","test","lset","lkey","values","indice","lindex","c","d","frozen","sortBy","toArray","predicate","op","length","Function","RegExp","exports","haro","config","obj"],"mappings":"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"}